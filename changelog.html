<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Change history &mdash; Celery v2.4.0rc1 documentation</title>
    <link rel="stylesheet" href="_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/issuetracker.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '2.4.0rc1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Celery v2.4.0rc1 documentation" href="index.html" />
    <link rel="next" title="API Reference" href="reference/index.html" />
    <link rel="prev" title="Frequently Asked Questions" href="faq.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="reference/index.html" title="API Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="faq.html" title="Frequently Asked Questions"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Celery v2.4.0rc1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
<div class="deck">

    
        <p class="developmentversion">
        This document is for Celery's development version, which can be
        significantly different from previous releases. Get old docs here:

        <a href="http://docs.celeryproject.org/en/latest/changelog.html">2.1</a>.
        </p>
        

</div>
    <div class="section" id="change-history">
<h1>Change history<a class="headerlink" href="#change-history" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#version-2-4-0" id="id98">2.4.0</a><ul>
<li><a class="reference internal" href="#important-notes" id="id99">Important Notes</a></li>
<li><a class="reference internal" href="#news" id="id100">News</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-3-2" id="id101">2.3.2</a><ul>
<li><a class="reference internal" href="#v232-news" id="id102">News</a></li>
<li><a class="reference internal" href="#fixes" id="id103">Fixes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-3-1" id="id104">2.3.1</a><ul>
<li><a class="reference internal" href="#id7" id="id105">Fixes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-3-0" id="id106">2.3.0</a><ul>
<li><a class="reference internal" href="#v230-important" id="id107">Important Notes</a></li>
<li><a class="reference internal" href="#v230-news" id="id108">News</a></li>
<li><a class="reference internal" href="#v230-fixes" id="id109">Fixes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-2-7" id="id110">2.2.7</a></li>
<li><a class="reference internal" href="#version-2-2-6" id="id111">2.2.6</a><ul>
<li><a class="reference internal" href="#v226-important" id="id112">Important Notes</a></li>
<li><a class="reference internal" href="#v226-fixes" id="id113">Fixes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-2-5" id="id114">2.2.5</a><ul>
<li><a class="reference internal" href="#v225-important" id="id115">Important Notes</a></li>
<li><a class="reference internal" href="#v225-news" id="id116">News</a></li>
<li><a class="reference internal" href="#v225-fixes" id="id117">Fixes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-2-4" id="id118">2.2.4</a><ul>
<li><a class="reference internal" href="#v224-fixes" id="id119">Fixes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-2-3" id="id120">2.2.3</a><ul>
<li><a class="reference internal" href="#v223-fixes" id="id121">Fixes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-2-2" id="id122">2.2.2</a><ul>
<li><a class="reference internal" href="#v222-fixes" id="id123">Fixes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-2-1" id="id124">2.2.1</a><ul>
<li><a class="reference internal" href="#v221-fixes" id="id125">Fixes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-2-0" id="id126">2.2.0</a><ul>
<li><a class="reference internal" href="#v220-important" id="id127">Important Notes</a></li>
<li><a class="reference internal" href="#v220-news" id="id128">News</a></li>
<li><a class="reference internal" href="#v220-fixes" id="id129">Fixes</a></li>
<li><a class="reference internal" href="#experimental" id="id130">Experimental</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-1-4" id="id131">2.1.4</a><ul>
<li><a class="reference internal" href="#v214-fixes" id="id132">Fixes</a></li>
<li><a class="reference internal" href="#documentation" id="id133">Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-1-3" id="id134">2.1.3</a></li>
<li><a class="reference internal" href="#version-2-1-2" id="id135">2.1.2</a><ul>
<li><a class="reference internal" href="#v212-fixes" id="id136">Fixes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-1-1" id="id137">2.1.1</a><ul>
<li><a class="reference internal" href="#v211-fixes" id="id138">Fixes</a></li>
<li><a class="reference internal" href="#v211-news" id="id139">News</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-1-0" id="id140">2.1.0</a><ul>
<li><a class="reference internal" href="#v210-important" id="id141">Important Notes</a></li>
<li><a class="reference internal" href="#v210-news" id="id142">News</a></li>
<li><a class="reference internal" href="#v210-fixes" id="id143">Fixes</a></li>
<li><a class="reference internal" href="#v210-experimental" id="id144">Experimental</a></li>
<li><a class="reference internal" href="#v210-documentation" id="id145">Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-0-3" id="id146">2.0.3</a><ul>
<li><a class="reference internal" href="#v203-fixes" id="id147">Fixes</a></li>
<li><a class="reference internal" href="#v203-documentation" id="id148">Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2-0-2" id="id149">2.0.2</a></li>
<li><a class="reference internal" href="#version-2-0-1" id="id150">2.0.1</a></li>
<li><a class="reference internal" href="#version-2-0-0" id="id151">2.0.0</a><ul>
<li><a class="reference internal" href="#foreword" id="id152">Foreword</a></li>
<li><a class="reference internal" href="#upgrading-for-django-users" id="id153">Upgrading for Django-users</a></li>
<li><a class="reference internal" href="#upgrading-for-others" id="id154">Upgrading for others</a><ul>
<li><a class="reference internal" href="#database-result-backend" id="id155">Database result backend</a></li>
<li><a class="reference internal" href="#cache-result-backend" id="id156">Cache result backend</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backward-incompatible-changes" id="id157">Backward incompatible changes</a></li>
<li><a class="reference internal" href="#v200-news" id="id158">News</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-1-0-6" id="id159">1.0.6</a></li>
<li><a class="reference internal" href="#version-1-0-5" id="id160">1.0.5</a><ul>
<li><a class="reference internal" href="#critical" id="id161">Critical</a></li>
<li><a class="reference internal" href="#changes" id="id162">Changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-1-0-4" id="id163">1.0.4</a></li>
<li><a class="reference internal" href="#version-1-0-3" id="id164">1.0.3</a><ul>
<li><a class="reference internal" href="#v103-important" id="id165">Important notes</a></li>
<li><a class="reference internal" href="#v103-news" id="id166">News</a></li>
<li><a class="reference internal" href="#remote-control-commands" id="id167">Remote control commands</a></li>
<li><a class="reference internal" href="#v103-fixes" id="id168">Fixes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-1-0-2" id="id169">1.0.2</a></li>
<li><a class="reference internal" href="#version-1-0-1" id="id170">1.0.1</a></li>
<li><a class="reference internal" href="#version-1-0-0" id="id171">1.0.0</a><ul>
<li><a class="reference internal" href="#v100-incompatible" id="id172">Backward incompatible changes</a></li>
<li><a class="reference internal" href="#deprecations" id="id173">Deprecations</a></li>
<li><a class="reference internal" href="#id64" id="id174">News</a></li>
<li><a class="reference internal" href="#v100-changes" id="id175">Changes</a></li>
<li><a class="reference internal" href="#bugs" id="id176">Bugs</a></li>
<li><a class="reference internal" href="#v100-documentation" id="id177">Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-0-8-4" id="id178">0.8.4</a></li>
<li><a class="reference internal" href="#version-0-8-3" id="id179">0.8.3</a></li>
<li><a class="reference internal" href="#version-0-8-2" id="id180">0.8.2</a></li>
<li><a class="reference internal" href="#version-0-8-1" id="id181">0.8.1</a><ul>
<li><a class="reference internal" href="#very-important-note" id="id182">Very important note</a></li>
<li><a class="reference internal" href="#important-changes" id="id183">Important changes</a></li>
<li><a class="reference internal" href="#v081-changes" id="id184">Changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-0-8-0" id="id185">0.8.0</a><ul>
<li><a class="reference internal" href="#v080-incompatible" id="id186">Backward incompatible changes</a></li>
<li><a class="reference internal" href="#v080-important" id="id187">Important changes</a></li>
<li><a class="reference internal" href="#v080-news" id="id188">News</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-0-6-0" id="id189">0.6.0</a><ul>
<li><a class="reference internal" href="#v060-important" id="id190">Important changes</a></li>
<li><a class="reference internal" href="#v060-news" id="id191">News</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-0-4-1" id="id192">0.4.1</a></li>
<li><a class="reference internal" href="#version-0-4-0" id="id193">0.4.0</a></li>
<li><a class="reference internal" href="#version-0-3-20" id="id194">0.3.20</a></li>
<li><a class="reference internal" href="#version-0-3-7" id="id195">0.3.7</a></li>
<li><a class="reference internal" href="#version-0-3-3" id="id196">0.3.3</a></li>
<li><a class="reference internal" href="#version-0-3-2" id="id197">0.3.2</a></li>
<li><a class="reference internal" href="#version-0-3-1" id="id198">0.3.1</a></li>
<li><a class="reference internal" href="#version-0-3-0" id="id199">0.3.0</a></li>
<li><a class="reference internal" href="#version-0-2-0" id="id200">0.2.0</a></li>
<li><a class="reference internal" href="#pre3" id="id201">0.2.0-pre3</a></li>
<li><a class="reference internal" href="#pre2" id="id202">0.2.0-pre2</a></li>
<li><a class="reference internal" href="#pre1" id="id203">0.2.0-pre1</a></li>
<li><a class="reference internal" href="#version-0-1-15" id="id204">0.1.15</a></li>
<li><a class="reference internal" href="#version-0-1-14" id="id205">0.1.14</a></li>
<li><a class="reference internal" href="#version-0-1-13" id="id206">0.1.13</a></li>
<li><a class="reference internal" href="#version-0-1-12" id="id207">0.1.12</a></li>
<li><a class="reference internal" href="#version-0-1-11" id="id208">0.1.11</a></li>
<li><a class="reference internal" href="#version-0-1-10" id="id209">0.1.10</a></li>
<li><a class="reference internal" href="#version-0-1-8" id="id210">0.1.8</a></li>
<li><a class="reference internal" href="#version-0-1-7" id="id211">0.1.7</a></li>
<li><a class="reference internal" href="#version-0-1-6" id="id212">0.1.6</a></li>
<li><a class="reference internal" href="#version-0-1-0" id="id213">0.1.0</a></li>
</ul>
</div>
<div class="section" id="version-2-4-0">
<span id="id1"></span><h2><a class="toc-backref" href="#id98">2.4.0</a><a class="headerlink" href="#version-2-4-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2011-10-28 04:00 P.M BST</td>
</tr>
<tr class="field"><th class="field-name">status:</th><td class="field-body">FROZEN</td>
</tr>
<tr class="field"><th class="field-name">branch:</th><td class="field-body">master</td>
</tr>
</tbody>
</table>
<div class="section" id="important-notes">
<span id="v240-important"></span><h3><a class="toc-backref" href="#id99">Important Notes</a><a class="headerlink" href="#important-notes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Now supports Python 3.</p>
</li>
<li><p class="first">Fixed deadlock in worker process handling (<a class="reference external" href="https://github.com/ask/celery/issues/496" title="Deadlock in worker process handling"><span class="xref issue closed">Issue #496</span></a>).</p>
<blockquote>
<div><p>A deadlock could occur after spawning new child processes because
the logging library&#8217;s mutex was not properly reset after fork.</p>
<p>The symptoms of this bug affecting would be that the worker simply
stops processing tasks, as none of the workers child processes
are functioning.  There was a greater chance of this bug occurring
with <tt class="docutils literal"><span class="pre">maxtasksperchild</span></tt> or a time-limit enabled.</p>
<p>This is a workaround for <a class="reference external" href="http://bugs.python.org/issue6721#msg140215">http://bugs.python.org/issue6721#msg140215</a>.</p>
<p>Fix contributed by Harm Verhagen.</p>
</div></blockquote>
</li>
<li><p class="first">AMQP Result backend: Now expires results by default.</p>
<blockquote>
<div><p>The default expiration value is now taken from the
<a class="reference internal" href="configuration.html#std:setting-CELERY_TASK_RESULT_EXPIRES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_RESULT_EXPIRES</span></tt></a> setting.</p>
<p>The old <a class="reference internal" href="configuration.html#std:setting-CELERY_AMQP_TASK_RESULT_EXPIRES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_AMQP_TASK_RESULT_EXPIRES</span></tt></a> setting has been
deprecated and will be removed in version 3.0.</p>
<p>Note that this means that the result backend requires RabbitMQ 1.1.0 or
higher, and that you have to disable expiration if you are running
with an older version.  You can do so by disabling the
<a class="reference internal" href="configuration.html#std:setting-CELERY_TASK_RESULT_EXPIRES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_RESULT_EXPIRES</span></tt></a> setting:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_TASK_RESULT_EXPIRES</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Broker transports can be now be specified using URLs</p>
<blockquote>
<div><blockquote>
<div><p>The broker hostname can now be given as an URL instead, of the format:</p>
<div class="highlight-python"><pre>transport://user:password@hostname:port/virtual_host</pre>
</div>
<p>for example the default broker is written as:</p>
<div class="highlight-python"><pre>amqp://guest:guest@localhost:5672//</pre>
</div>
<p>Transport defaults to amqp, and is not required.
user, password, port and virtual_host is also not mandatory and
will default to the corresponding transport default.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Note that the path component (virtual_host) always starts with a
forward-slash.  This is necessary to distinguish between the virtual
host &#8216;&#8217; (empty) and &#8216;/&#8217;, which are both acceptable virtual host names.</p>
<p>A virtual host of &#8216;/&#8217; becomes:</p>
<blockquote>
<div><p>amqp://guest:guest&#64;localhost:5672//</p>
</div></blockquote>
<p>and a virtual host of &#8216;&#8217; (empty) becomes:</p>
<div class="highlight-python"><pre>amqp://guest:guest@localhost:5672/</pre>
</div>
<p class="last">So the leading slash in the path component is <strong>always required</strong>.</p>
</div>
</div></blockquote>
<p>In addition the <a class="reference internal" href="configuration.html#std:setting-BROKER_URL"><tt class="xref std std-setting docutils literal"><span class="pre">BROKER_URL</span></tt></a> setting has been added as an alias
to <tt class="docutils literal"><span class="pre">BROKER_HOST</span></tt>.  Any broker setting specified in both the URL and in
the configuration will be ignored, if a setting is not provided in the URL
then the value from the configuration will be used as default.</p>
<p>Also, programs now support the <em class="xref std std-option">-b|--broker</em> option to specify
a broker URL on the command line:</p>
<div class="highlight-python"><pre>    $ celeryd -b redis://localhost

    $ celeryctl -b amqp://guest:guest@localhost//e

The environment variable :envvar:`CELERY_BROKER_URL` can also be used to
easily override the default broker used.</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">The deprecated <tt class="xref py py-func docutils literal"><span class="pre">celery.loaders.setup_loader()</span></tt> function has been removed.</p>
</li>
<li><p class="first">The <a class="reference internal" href="configuration.html#std:setting-CELERY_TASK_ERROR_WHITELIST"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_ERROR_WHITELIST</span></tt></a> setting has been replaced
by a more flexible approach (<a class="reference external" href="https://github.com/ask/celery/issues/447" title="need a CELERY_TASK_ERROR_BLACKLIST setting"><span class="xref issue closed">Issue #447</span></a>).</p>
<p>The Mail sending logic is now available as <tt class="docutils literal"><span class="pre">Task.ErrorMail</span></tt>.
The actual implementation is in <a href="#id2"><span class="problematic" id="id3">:module:`celery.utils.mail`</span></a>.</p>
<p>The error mail class can be sub-classed to gain complete control
of when error messages are sent, thus removing the need for a separate
white-list setting.</p>
<p>The <a class="reference internal" href="configuration.html#std:setting-CELERY_TASK_ERROR_WHITELIST"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_ERROR_WHITELIST</span></tt></a> setting has been deprecated,
and will be removed completely in version 3.0.</p>
</li>
<li><p class="first">Additional Deprecations</p>
<blockquote>
<div><p>The following functions has been deprecated and is scheduled for removal in
version 3.0:</p>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><p class="first last"><strong>Old function</strong></p>
</th>
<th class="head"><p class="first last"><strong>Alternative</strong></p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><p class="first last"><cite>celery.loaders.current_loader</cite></p>
</td>
<td><p class="first last"><cite>celery.current_app.loader</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>celery.loaders.load_settings</cite></p>
</td>
<td><p class="first last"><cite>celery.current_app.conf</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>celery.execute.apply</cite></p>
</td>
<td><p class="first last"><cite>Task.apply</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>celery.execute.apply_async</cite></p>
</td>
<td><p class="first last"><cite>Task.apply_async</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>celery.execute.delay_task</cite></p>
</td>
<td><p class="first last"><cite>celery.execute.send_task</cite></p>
</td>
</tr>
</tbody>
</table>
<p>The following settings has been deprecated and is scheduled for removal
in version 3.0:</p>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><p class="first last"><strong>Old setting</strong></p>
</th>
<th class="head"><p class="first last"><strong>Alternative</strong></p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><p class="first last"><cite>CELERYD_LOG_LEVEL</cite></p>
</td>
<td><p class="first last"><tt class="docutils literal"><span class="pre">celeryd</span> <span class="pre">--loglevel=</span></tt></p>
</td>
</tr>
<tr><td><p class="first last"><cite>CELERYD_LOG_FILE</cite></p>
</td>
<td><p class="first last"><tt class="docutils literal"><span class="pre">celeryd</span> <span class="pre">--logfile=</span></tt></p>
</td>
</tr>
<tr><td><p class="first last"><cite>CELERYBEAT_LOG_LEVEL</cite></p>
</td>
<td><p class="first last"><tt class="docutils literal"><span class="pre">celerybeat</span> <span class="pre">--loglevel=</span></tt></p>
</td>
</tr>
<tr><td><p class="first last"><cite>CELERYBEAT_LOG_FILE</cite></p>
</td>
<td><p class="first last"><tt class="docutils literal"><span class="pre">celerybeat</span> <span class="pre">--logfile=</span></tt></p>
</td>
</tr>
<tr><td><p class="first last"><cite>CELERYMON_LOG_LEVEL</cite></p>
</td>
<td><p class="first last"><tt class="docutils literal"><span class="pre">celerymon</span> <span class="pre">--loglevel=</span></tt></p>
</td>
</tr>
<tr><td><p class="first last"><cite>CELERYMON_LOG_FILE</cite></p>
</td>
<td><p class="first last"><tt class="docutils literal"><span class="pre">celerymon</span> <span class="pre">--logfile=</span></tt></p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="news">
<span id="v240-news"></span><h3><a class="toc-backref" href="#id100">News</a><a class="headerlink" href="#news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">No longer depends on <tt class="xref py py-mod docutils literal"><span class="pre">pyparsing</span></tt>.</p>
</li>
<li><p class="first">CELERY_IMPORTS can now be a scalar value (<a class="reference external" href="https://github.com/ask/celery/issues/485" title="Noob problems with celeryconfig.py and CELERY_IMPORTS fix suggestion"><span class="xref issue closed">Issue #485</span></a>).</p>
<blockquote>
<div><p>It is too easy to forget to add the comma after the sole element of a
tuple, and this is something that often affects newcomers.</p>
<p>The docs should probably use a list in examples, as using a tuple
for this doesn&#8217;t even make sense.  Nonetheless, there are many
tutorials out there using a tuple, and this change should be a help
to new users.</p>
<p>Suggested by jsaxon-cars.</p>
</div></blockquote>
</li>
<li><p class="first">Fixed a memory leak when using the thread pool (<a class="reference external" href="https://github.com/ask/celery/issues/486" title="memory leak in concurrency.threads"><span class="xref issue closed">Issue #486</span></a>).</p>
<blockquote>
<div><p>Contributed by Kornelijus Survila.</p>
</div></blockquote>
</li>
<li><p class="first">The statedb was not saved at exit.</p>
<blockquote>
<div><p>This has now been fixed and it should again remember previously
revoked tasks when a <tt class="docutils literal"><span class="pre">--statedb</span></tt> is enabled.</p>
</div></blockquote>
</li>
<li><p class="first">Adds <a class="reference internal" href="configuration.html#std:setting-EMAIL_USE_TLS"><tt class="xref std std-setting docutils literal"><span class="pre">EMAIL_USE_TLS</span></tt></a> to enable secure SMTP connections
(<a class="reference external" href="https://github.com/ask/celery/issues/418" title="Gmail TLS support"><span class="xref issue closed">Issue #418</span></a>).</p>
<blockquote>
<div><p>Contributed by Stefan Kjartansson.</p>
</div></blockquote>
</li>
<li><p class="first">Now handles missing fields in task messages as documented in the message
format documentation.</p>
<blockquote>
<div><ul class="simple">
<li>Missing required field throws <tt class="xref py py-exc docutils literal"><span class="pre">InvalidTaskError</span></tt></li>
<li>Missing args/kwargs is assumed empty.</li>
</ul>
<p>Contributed by Chris Chamberlin.</p>
</div></blockquote>
</li>
<li><p class="first">The Cache, Cassandra, MongoDB, Redis and Tyrant backends now respects
the <a class="reference internal" href="configuration.html#std:setting-CELERY_RESULT_SERIALIZER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_RESULT_SERIALIZER</span></tt></a> setting (<a class="reference external" href="https://github.com/ask/celery/issues/435" title="Result backends fixes"><span class="xref issue closed">Issue #435</span></a>).</p>
<blockquote>
<div><p>This means that only the database (django/sqlalchemy) backends
currently does not support using custom serializers.</p>
<p>Contributed by Steeve Morin</p>
</div></blockquote>
</li>
<li><p class="first">Logging calls no longer manually formats messages, but delegates
that to the logging system, so tools like Sentry can easier
work with the messages (<a class="reference external" href="https://github.com/ask/celery/issues/445" title="Logging: don't force string interpolation"><span class="xref issue closed">Issue #445</span></a>).</p>
<blockquote>
<div><p>Contributed by Chris Adams.</p>
</div></blockquote>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">celeryd_multi</span></tt> now supports a <tt class="docutils literal"><span class="pre">stop_verify</span></tt> command to wait for
processes to shutdown.</p>
</li>
<li><p class="first">New setting <tt class="xref std std-setting docutils literal"><span class="pre">CELERY_RESULT_DB_SHORT_LIVED_SESSIONS</span></tt> added,
which if enabled will disable the caching of SQLAlchemy sessions
(<a class="reference external" href="https://github.com/ask/celery/issues/449" title="Option not to cache DB sessions"><span class="xref issue closed">Issue #449</span></a>).</p>
<blockquote>
<div><p>Contributed by Leo Dirac.</p>
</div></blockquote>
</li>
<li><p class="first">All result backends now implements <tt class="docutils literal"><span class="pre">__reduce__</span></tt> so that they can
be pickled (<a class="reference external" href="https://github.com/ask/celery/issues/441" title="Pickleability of backends"><span class="xref issue closed">Issue #441</span></a>).</p>
<blockquote>
<div><p>Fix contributed by Remy Noel</p>
</div></blockquote>
</li>
<li><p class="first">New-style <tt class="docutils literal"><span class="pre">CELERY_REDIS_*</span></tt> settings now takes precedence over
the old <tt class="docutils literal"><span class="pre">REDIS_*</span></tt> configuration keys (<a class="reference external" href="https://github.com/ask/celery/issues/508" title="New style CELERY_REDIS_* configuration should take precedence over old st"><span class="xref issue closed">Issue #508</span></a>).</p>
<blockquote>
<div><p>Fix contributed by Joshua Ginsberg</p>
</div></blockquote>
</li>
<li><p class="first">Generic celerybeat init script no longer sets <cite>bash -e</cite> (<a class="reference external" href="https://github.com/ask/celery/issues/510" title="remove set -e / bash -e, make code friendlier to use with fabric"><span class="xref issue closed">Issue #510</span></a>).</p>
<blockquote>
<div><p>Fix contributed by Roger Hu.</p>
</div></blockquote>
</li>
<li><p class="first">Documented that Chords do not work well with redis-server versions
before 2.2.</p>
<blockquote>
<div><p>Contributed by Dan McGee.</p>
</div></blockquote>
</li>
<li><p class="first">The <a class="reference internal" href="configuration.html#std:setting-CELERYBEAT_MAX_LOOP_INTERVAL"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYBEAT_MAX_LOOP_INTERVAL</span></tt></a> setting was not respected.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">inspect.registered_tasks</span></tt> renamed to <tt class="docutils literal"><span class="pre">inspect.tasks</span></tt> for naming
consistency.</p>
<blockquote>
<div><p>The previous name is still available as an alias.</p>
<p>Contributed by Mher Movsisyan</p>
</div></blockquote>
</li>
<li><p class="first">RHEL init script: Changed celeryd startup priority.</p>
<blockquote>
<div><p>The default start / stop priorities for MySQL on RHEL are</p>
<blockquote>
<div><p># chkconfig: - 64 36</p>
</div></blockquote>
<p>Therefore, if Celery is using a database as a broker / message store, it
should be started after the database is up and running, otherwise errors
will ensue. This commit changes the priority in the init script to</p>
<blockquote>
<div><p># chkconfig: - 85 15</p>
</div></blockquote>
<p>which are the default recommended settings for 3-rd party applications
and assure that Celery will be started after the database service &amp; shut
down before it terminates.</p>
<p>Contributed by Yury V. Zaytsev.</p>
</div></blockquote>
</li>
<li><p class="first">After deprecating 2.4 support we can now name modules correctly, since we
can take use of absolute imports.</p>
<blockquote>
<div><p>Therefore the following internal modules have been renamed:</p>
<blockquote>
<div><p>celery.concurrency.evlet    -&gt; celery.concurrency.eventlet
celery.concurrency.evg      -&gt; celery.concurrency.gevent</p>
</div></blockquote>
</div></blockquote>
</li>
<li><p class="first">AUTHORS file is now sorted alphabetically.</p>
<blockquote>
<div><p>Also, as you may have noticed the contributors of new features/fixes are
now mentioned in the Changelog.</p>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="version-2-3-2">
<span id="id4"></span><h2><a class="toc-backref" href="#id101">2.3.2</a><a class="headerlink" href="#version-2-3-2" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2011-10-07 05:00 P.M BST</td>
</tr>
</tbody>
</table>
<div class="section" id="v232-news">
<span id="id5"></span><h3><a class="toc-backref" href="#id102">News</a><a class="headerlink" href="#v232-news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Improved Contributing guide.</p>
<blockquote>
<div><p>If you&#8217;d like to contribute to Celery you should read this
guide: <a class="reference external" href="http://ask.github.com/celery/contributing.html">http://ask.github.com/celery/contributing.html</a></p>
<p>We are looking for contributors of all skill levels, so don&#8217;t
hesitate!</p>
</div></blockquote>
</li>
<li><p class="first">Now depends on Kombu 1.3.1</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Task.request</span></tt> now contains the current worker host name (<a class="reference external" href="https://github.com/ask/celery/issues/460" title="Get hostname of a worker from task"><span class="xref issue closed">Issue #460</span></a>).</p>
<blockquote>
<div><p>Available as <tt class="docutils literal"><span class="pre">task.request.hostname</span></tt>.</p>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>It is now easier for app subclasses to extend how they are pickled.</dt>
<dd><p class="first last">(see <tt class="xref py py-class docutils literal"><span class="pre">celery.app.AppPickler</span></tt>).</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="fixes">
<span id="v232-fixes"></span><h3><a class="toc-backref" href="#id103">Fixes</a><a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><cite>purge/discard_all</cite> was not working correctly (<a class="reference external" href="https://github.com/ask/celery/issues/455" title="celeryctl purge doesn't purge everything"><span class="xref issue closed">Issue #455</span></a>).</p>
</li>
<li><p class="first">The coloring of log messages didn&#8217;t handle non-ASCII data well
(<a class="reference external" href="https://github.com/ask/celery/issues/427" title="UnicodeEncodeErrors with celery built-in console logging"><span class="xref issue closed">Issue #427</span></a>).</p>
</li>
<li><p class="first">[Windows] the multiprocessing pool tried to import <tt class="docutils literal"><span class="pre">os.kill</span></tt>
even though this is not available there (<a class="reference external" href="https://github.com/ask/celery/issues/450" title="os.kill is not available in windows before python 2.7"><span class="xref issue closed">Issue #450</span></a>).</p>
</li>
<li><p class="first">Fixes case where the worker could become unresponsive because of tasks
exceeding the hard time limit.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">task-sent</span></tt> event was missing from the event reference.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">ResultSet.iterate</span></tt> now returns results as they finish (<a class="reference external" href="https://github.com/ask/celery/issues/459" title="TaskSet.iterate() doesn't iterate as tasks complete *when task set is large and tasks are slow*"><span class="xref issue closed">Issue #459</span></a>).</p>
<blockquote>
<div><p>This was not the case previously, even though the documentation
states this was the expected behavior.</p>
</div></blockquote>
</li>
<li><p class="first">Retries will no longer be performed when tasks are called directly
(using <tt class="docutils literal"><span class="pre">__call__</span></tt>).</p>
<blockquote>
<div><p>Instead the exception passed to <tt class="docutils literal"><span class="pre">retry</span></tt> will be re-raised.</p>
</div></blockquote>
</li>
<li><p class="first">Eventlet no longer crashes if autoscale is enabled.</p>
<blockquote>
<div><p>growing and shrinking eventlet pools is still not supported.</p>
</div></blockquote>
</li>
<li><p class="first">py24 target removed from <tt class="file docutils literal"><span class="pre">tox.ini</span></tt>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="version-2-3-1">
<span id="id6"></span><h2><a class="toc-backref" href="#id104">2.3.1</a><a class="headerlink" href="#version-2-3-1" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2011-08-07 08:00 P.M BST</td>
</tr>
</tbody>
</table>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id105">Fixes</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The <a class="reference internal" href="configuration.html#std:setting-CELERY_AMQP_TASK_RESULT_EXPIRES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_AMQP_TASK_RESULT_EXPIRES</span></tt></a> setting did not work,
resulting in an AMQP related error about not being able to serialize
floats while trying to publish task states (<a class="reference external" href="https://github.com/ask/celery/issues/446" title="Specifying CELERY_AMQP_TASK_RESULT_EXPIRES raises a ValueError"><span class="xref issue closed">Issue #446</span></a>).</li>
</ul>
</div>
</div>
<div class="section" id="version-2-3-0">
<span id="id8"></span><h2><a class="toc-backref" href="#id106">2.3.0</a><a class="headerlink" href="#version-2-3-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2011-08-05 12:00 P.M BST</td>
</tr>
<tr class="field"><th class="field-name">tested:</th><td class="field-body">cPython: 2.5, 2.6, 2.7; PyPy: 1.5; Jython: 2.5.2</td>
</tr>
</tbody>
</table>
<div class="section" id="v230-important">
<span id="id9"></span><h3><a class="toc-backref" href="#id107">Important Notes</a><a class="headerlink" href="#v230-important" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Now requires Kombu 1.2.1</p>
</li>
<li><p class="first">Results are now disabled by default.</p>
<blockquote>
<div><p>The AMQP backend was not a good default because often the users were
not consuming the results, resulting in thousands of queues.</p>
<p>While the queues can be configured to expire if left unused, it was not
possible to enable this by default because this was only available in
recent RabbitMQ versions (2.1.1+)</p>
<p>With this change enabling a result backend will be a conscious choice,
which will hopefully lead the user to read the documentation and be aware
of any common pitfalls with the particular backend.</p>
<p>The default backend is now a dummy backend
(<a class="reference internal" href="internals/reference/celery.backends.base.html#celery.backends.base.DisabledBackend" title="celery.backends.base.DisabledBackend"><tt class="xref py py-class docutils literal"><span class="pre">celery.backends.base.DisabledBackend</span></tt></a>).  Saving state is simply an
noop operation, and AsyncResult.wait(), .result, .state, etc. will raise
a <tt class="xref py py-exc docutils literal"><span class="pre">NotImplementedError</span></tt> telling the user to configure the result backend.</p>
<p>For help choosing a backend please see <a class="reference internal" href="userguide/tasks.html#task-result-backends"><em>Result Backends</em></a>.</p>
<p>If you depend on the previous default which was the AMQP backend, then
you have to set this explicitly before upgrading:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_RESULT_BACKEND</span> <span class="o">=</span> <span class="s">&quot;amqp&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For django-celery users the default backend is still <tt class="docutils literal"><span class="pre">database</span></tt>,
and results are not disabled by default.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">The Debian init scripts have been deprecated in favor of the generic-init.d
init scripts.</p>
<blockquote>
<div><p>In addition generic init scripts for celerybeat and celeryev has been
added.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="v230-news">
<span id="id10"></span><h3><a class="toc-backref" href="#id108">News</a><a class="headerlink" href="#v230-news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Automatic connection pool support.</p>
<blockquote>
<div><p>The pool is used by everything that requires a broker connection.  For
example applying tasks, sending broadcast commands, retrieving results
with the AMQP result backend, and so on.</p>
<p>The pool is disabled by default, but you can enable it by configuring the
<a class="reference internal" href="configuration.html#std:setting-BROKER_POOL_LIMIT"><tt class="xref std std-setting docutils literal"><span class="pre">BROKER_POOL_LIMIT</span></tt></a> setting:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">BROKER_POOL_LIMIT</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<p>A limit of 10 means a maximum of 10 simultaneous connections can co-exist.
Only a single connection will ever be used in a single-thread
environment, but in a concurrent environment (threads, greenlets, etc., but
not processes) when the limit has been exceeded, any try to acquire a
connection will block the thread and wait for a connection to be released.
This is something to take into consideration when choosing a limit.</p>
<p>A limit of <tt class="xref py py-const xref docutils literal"><span class="pre">None</span></tt> or 0 means no limit, and connections will be
established and closed every time.</p>
</div></blockquote>
</li>
<li><p class="first">Introducing Chords (taskset callbacks).</p>
<blockquote>
<div><p>A chord is a task that only executes after all of the tasks in a taskset
has finished executing.  It&#8217;s a fancy term for &#8220;taskset callbacks&#8221;
adopted from
<a class="reference external" href="http://research.microsoft.com/en-us/um/cambridge/projects/comega/">Cω</a>).</p>
<p>It works with all result backends, but the best implementation is
currently provided by the Redis result backend.</p>
<p>Here&#8217;s an example chord:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">chord</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">subtask</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
<span class="gp">... </span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">100</span><span class="p">))(</span><span class="n">tsum</span><span class="o">.</span><span class="n">subtask</span><span class="p">())</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">9900</span>
</pre></div>
</div>
<p>Please read the <a class="reference internal" href="userguide/tasksets.html#chords"><em>Chords section in the user guide</em></a>, if you
want to know more.</p>
</div></blockquote>
</li>
<li><p class="first">Time limits can now be set for individual tasks.</p>
<blockquote>
<div><p>To set the soft and hard time limits for a task use the <tt class="docutils literal"><span class="pre">time_limit</span></tt>
and <tt class="docutils literal"><span class="pre">soft_time_limit</span></tt> attributes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">time</span>

<span class="nd">@task</span><span class="p">(</span><span class="n">time_limit</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">soft_time_limit</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sleeptask</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
</pre></div>
</div>
<p>If the attributes are not set, then the workers default time limits
will be used.</p>
<p>New in this version you can also change the time limits for a task
at runtime using the <tt class="xref py py-func docutils literal"><span class="pre">time_limit()</span></tt> remote control command:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task</span> <span class="kn">import</span> <span class="n">control</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">control</span><span class="o">.</span><span class="n">time_limit</span><span class="p">(</span><span class="s">&quot;tasks.sleeptask&quot;</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">soft</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">hard</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">[{&#39;worker1.example.com&#39;: {&#39;ok&#39;: &#39;time limits set successfully&#39;}}]</span>
</pre></div>
</div>
<p>Only tasks that starts executing after the time limit change will be affected.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Soft time limits will still not work on Windows or other platforms
that do not have the <tt class="docutils literal"><span class="pre">SIGUSR1</span></tt> signal.</p>
</div>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>Redis backend configuration directive names changed to include the</dt>
<dd><p class="first"><tt class="docutils literal"><span class="pre">CELERY_</span></tt> prefix.</p>
<blockquote class="last">
<div><table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><p class="first last"><strong>Old setting name</strong></p>
</th>
<th class="head"><p class="first last"><strong>Replace with</strong></p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><p class="first last"><cite>REDIS_HOST</cite></p>
</td>
<td><p class="first last"><cite>CELERY_REDIS_HOST</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>REDIS_PORT</cite></p>
</td>
<td><p class="first last"><cite>CELERY_REDIS_PORT</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>REDIS_DB</cite></p>
</td>
<td><p class="first last"><cite>CELERY_REDIS_DB</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>REDIS_PASSWORD</cite></p>
</td>
<td><p class="first last"><cite>CELERY_REDIS_PASSWORD</cite></p>
</td>
</tr>
</tbody>
</table>
<p>The old names are still supported but pending deprecation.</p>
</div></blockquote>
</dd>
</dl>
</li>
<li><p class="first">PyPy: The default pool implementation used is now multiprocessing
if running on PyPy 1.5.</p>
</li>
<li><p class="first">celeryd-multi: now supports &#8220;pass through&#8221; options.</p>
<blockquote>
<div><p>Pass through options makes it easier to use celery without a
configuration file, or just add last-minute options on the command
line.</p>
<p>Example use:</p>
<blockquote>
<div><dl class="docutils">
<dt>$ celeryd-multi start 4  -c 2  &#8211; broker.host=amqp.example.com </dt>
<dd><p class="first last">broker.vhost=/               celery.disable_rate_limits=yes</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
</li>
<li><p class="first">celerybeat: Now retries establishing the connection (<a class="reference external" href="https://github.com/ask/celery/issues/419" title="celerybeat does not retry broker connection like celeryd"><span class="xref issue closed">Issue #419</span></a>).</p>
</li>
<li><p class="first">celeryctl: New <tt class="docutils literal"><span class="pre">list</span> <span class="pre">bindings</span></tt> command.</p>
<blockquote>
<div><p>Lists the current or all available bindings, depending on the
broker transport used.</p>
</div></blockquote>
</li>
<li><p class="first">Heartbeat is now sent every 30 seconds (previously every 2 minutes).</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">ResultSet.join_native()</span></tt> and <tt class="docutils literal"><span class="pre">iter_native()</span></tt> is now supported by
the Redis and Cache result backends.</p>
<blockquote>
<div><p>This is an optimized version of <tt class="docutils literal"><span class="pre">join()</span></tt> using the underlying
backends ability to fetch multiple results at once.</p>
</div></blockquote>
</li>
<li><p class="first">Can now use SSL when sending error e-mails by enabling the
<a class="reference internal" href="configuration.html#std:setting-EMAIL_USE_SSL"><tt class="xref std std-setting docutils literal"><span class="pre">EMAIL_USE_SSL</span></tt></a> setting.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">events.default_dispatcher()</span></tt>: Context manager to easily obtain
an event dispatcher instance using the connection pool.</p>
</li>
<li><p class="first">Import errors in the configuration module will not be silenced anymore.</p>
</li>
<li><p class="first">ResultSet.iterate:  Now supports the <tt class="docutils literal"><span class="pre">timeout</span></tt>, <tt class="docutils literal"><span class="pre">propagate</span></tt> and
<tt class="docutils literal"><span class="pre">interval</span></tt> arguments.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">with_default_connection</span></tt> -&gt;  <tt class="docutils literal"><span class="pre">with</span> <span class="pre">default_connection</span></tt></p>
</li>
<li><p class="first">TaskPool.apply_async:  Keyword arguments <tt class="docutils literal"><span class="pre">callbacks</span></tt> and <tt class="docutils literal"><span class="pre">errbacks</span></tt>
has been renamed to <tt class="docutils literal"><span class="pre">callback</span></tt> and <tt class="docutils literal"><span class="pre">errback</span></tt> and take a single scalar
value instead of a list.</p>
</li>
<li><p class="first">No longer propagates errors occurring during process cleanup (<a class="reference external" href="https://github.com/ask/celery/issues/365" title="Task exception masked by cleanup code exception"><span class="xref issue closed">Issue #365</span></a>)</p>
</li>
<li><p class="first">Added <tt class="docutils literal"><span class="pre">TaskSetResult.delete()</span></tt>, which will delete a previously
saved taskset result.</p>
</li>
<li><p class="first">Celerybeat now syncs every 3 minutes instead of only at
shutdown (<a class="reference external" href="https://github.com/ask/celery/issues/382" title="Invalid parsing of crontab schedules"><span class="xref issue closed">Issue #382</span></a>).</p>
</li>
<li><p class="first">Monitors now properly handles unknown events, so user-defined events
are displayed.</p>
</li>
<li><p class="first">Terminating a task on Windows now also terminates all of the tasks child
processes (<a class="reference external" href="https://github.com/ask/celery/issues/384" title="Kill full process tree of a worker by default in Windows platforms"><span class="xref issue closed">Issue #384</span></a>).</p>
</li>
<li><p class="first">celeryd: <tt class="docutils literal"><span class="pre">-I|--include</span></tt> option now always searches the current directory
to import the specified modules.</p>
</li>
<li><p class="first">Cassandra backend: Now expires results by using TTLs.</p>
</li>
<li><p class="first">Functional test suite in <tt class="docutils literal"><span class="pre">funtests</span></tt> is now actually working properly, and
passing tests.</p>
</li>
</ul>
</div>
<div class="section" id="v230-fixes">
<span id="id11"></span><h3><a class="toc-backref" href="#id109">Fixes</a><a class="headerlink" href="#v230-fixes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>celeryev was trying to create the pidfile twice.</li>
<li>celery.contrib.batches: Fixed problem where tasks failed
silently (<a class="reference external" href="https://github.com/ask/celery/issues/393" title="Batches silently failing"><span class="xref issue closed">Issue #393</span></a>).</li>
<li>Fixed an issue where logging objects would give &#8220;&lt;Unrepresentable&#8221;,
even though the objects were.</li>
<li><tt class="docutils literal"><span class="pre">CELERY_TASK_ERROR_WHITE_LIST</span></tt> is now properly initialized
in all loaders.</li>
<li>celeryd_detach now passes through command-line configuration.</li>
<li>Remote control command <tt class="docutils literal"><span class="pre">add_consumer</span></tt> now does nothing if the
queue is already being consumed from.</li>
</ul>
</div>
</div>
<div class="section" id="version-2-2-7">
<span id="id12"></span><h2><a class="toc-backref" href="#id110">2.2.7</a><a class="headerlink" href="#version-2-2-7" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2011-06-13 16:00 P.M BST</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">New signals: <a class="reference internal" href="reference/celery.signals.html#std:signal-after_setup_logger"><tt class="xref std std-signal docutils literal"><span class="pre">after_setup_logger</span></tt></a> and
<a class="reference internal" href="reference/celery.signals.html#std:signal-after_setup_task_logger"><tt class="xref std std-signal docutils literal"><span class="pre">after_setup_task_logger</span></tt></a></p>
<blockquote>
<div><p>These signals can be used to augment logging configuration
after Celery has set up logging.</p>
</div></blockquote>
</li>
<li><p class="first">Redis result backend now works with Redis 2.4.4.</p>
</li>
<li><p class="first">celeryd_multi: The <em class="xref std std-option">--gid</em> option now works correctly.</p>
</li>
<li><p class="first">celeryd: Retry wrongfully used the repr of the traceback instead
of the string representation.</p>
</li>
<li><p class="first">App.config_from_object: Now loads module, not attribute of module.</p>
</li>
<li><p class="first">Fixed issue where logging of objects would give &#8220;&lt;Unrepresentable: ...&gt;&#8221;</p>
</li>
</ul>
</div>
<div class="section" id="version-2-2-6">
<span id="id13"></span><h2><a class="toc-backref" href="#id111">2.2.6</a><a class="headerlink" href="#version-2-2-6" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2011-04-15 16:00 P.M CEST</td>
</tr>
</tbody>
</table>
<div class="section" id="v226-important">
<span id="id14"></span><h3><a class="toc-backref" href="#id112">Important Notes</a><a class="headerlink" href="#v226-important" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Now depends on Kombu 1.1.2.</p>
</li>
<li><p class="first">Dependency lists now explicitly specifies that we don&#8217;t want python-dateutil
2.x, as this version only supports py3k.</p>
<blockquote>
<div><p>If you have installed dateutil 2.0 by accident you should downgrade
to the 1.5.0 version:</p>
<div class="highlight-python"><pre>pip install -U python-dateutil==1.5.0</pre>
</div>
<p>or by easy_install:</p>
<div class="highlight-python"><pre>easy_install -U python-dateutil==1.5.0</pre>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="v226-fixes">
<span id="id15"></span><h3><a class="toc-backref" href="#id113">Fixes</a><a class="headerlink" href="#v226-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">The new <tt class="docutils literal"><span class="pre">WatchedFileHandler</span></tt> broke Python 2.5 support (<a class="reference external" href="https://github.com/ask/celery/issues/367" title="celeryd_multi dies on python 2.5"><span class="xref issue closed">Issue #367</span></a>).</p>
</li>
<li><p class="first">Task: Don&#8217;t use <tt class="docutils literal"><span class="pre">app.main</span></tt> if the task name is set explicitly.</p>
</li>
<li><p class="first">Sending emails did not work on Python 2.5, due to a bug in
the version detection code (<a class="reference external" href="https://github.com/ask/celery/issues/378" title="celery.utils.mail incompatible with Python 2.5"><span class="xref issue closed">Issue #378</span></a>).</p>
</li>
<li><p class="first">Beat: Adds method <tt class="docutils literal"><span class="pre">ScheduleEntry._default_now</span></tt></p>
<blockquote>
<div><p>This method can be overridden to change the default value
of <tt class="docutils literal"><span class="pre">last_run_at</span></tt>.</p>
</div></blockquote>
</li>
<li><p class="first">An error occurring in process cleanup could mask task errors.</p>
<p>We no longer propagate errors happening at process cleanup,
but log them instead.  This way they will not interfere with publishing
the task result (<a class="reference external" href="https://github.com/ask/celery/issues/365" title="Task exception masked by cleanup code exception"><span class="xref issue closed">Issue #365</span></a>).</p>
</li>
<li><p class="first">Defining tasks did not work properly when using the Django
<tt class="docutils literal"><span class="pre">shell_plus</span></tt> utility (<a class="reference external" href="https://github.com/ask/celery/issues/366" title="KeyError on tutorial with Python 2.6.6 and 2.7.1 but not 2.6.1"><span class="xref issue closed">Issue #366</span></a>).</p>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">AsyncResult.get</span></tt> did not accept the <tt class="docutils literal"><span class="pre">interval</span></tt> and <tt class="docutils literal"><span class="pre">propagate</span></tt></dt>
<dd><p class="first last">arguments.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>celeryd: Fixed a bug where celeryd would not shutdown if a</dt>
<dd><p class="first last"><tt class="xref py py-exc docutils literal"><span class="pre">socket.error</span></tt> was raised.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="version-2-2-5">
<span id="id16"></span><h2><a class="toc-backref" href="#id114">2.2.5</a><a class="headerlink" href="#version-2-2-5" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2011-03-28 06:00 P.M CEST</td>
</tr>
</tbody>
</table>
<div class="section" id="v225-important">
<span id="id17"></span><h3><a class="toc-backref" href="#id115">Important Notes</a><a class="headerlink" href="#v225-important" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Now depends on Kombu 1.0.7</li>
</ul>
</div>
<div class="section" id="v225-news">
<span id="id18"></span><h3><a class="toc-backref" href="#id116">News</a><a class="headerlink" href="#v225-news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Our documentation is now hosted by Read The Docs
(<a class="reference external" href="http://docs.celeryproject.org">http://docs.celeryproject.org</a>), and all links have been changed to point to
the new URL.</p>
</li>
<li><p class="first">Logging: Now supports log rotation using external tools like <a class="reference external" href="http://www.ducea.com/2006/06/06/rotating-linux-log-files-part-2-logrotate/">logrotate.d</a>
(<a class="reference external" href="https://github.com/ask/celery/issues/321" title="Provide support for rolling file logs"><span class="xref issue closed">Issue #321</span></a>)</p>
<blockquote>
<div><p>This is accomplished by using the <tt class="docutils literal"><span class="pre">WatchedFileHandler</span></tt>, which re-opens
the file if it is renamed or deleted.</p>
</div></blockquote>
</li>
</ul>
<ul>
<li><dl class="first docutils">
<dt><a class="reference internal" href="tutorials/otherqueues.html#tut-otherqueues"><em>Using Celery with Redis/Database as the messaging queue.</em></a> now documents how to configure Redis/Database result</dt>
<dd><p class="first last">backends.</p>
</dd>
</dl>
</li>
<li><p class="first">gevent: Now supports ETA tasks.</p>
<blockquote>
<div><p>But gevent still needs <tt class="docutils literal"><span class="pre">CELERY_DISABLE_RATE_LIMITS=True</span></tt> to work.</p>
</div></blockquote>
</li>
<li><p class="first">TaskSet User Guide: now contains TaskSet callback recipes.</p>
</li>
<li><p class="first">Eventlet: New signals:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">eventlet_pool_started</span></tt></li>
<li><tt class="docutils literal"><span class="pre">eventlet_pool_preshutdown</span></tt></li>
<li><tt class="docutils literal"><span class="pre">eventlet_pool_postshutdown</span></tt></li>
<li><tt class="docutils literal"><span class="pre">eventlet_pool_apply</span></tt></li>
</ul>
<p>See <a class="reference internal" href="reference/celery.signals.html#module-celery.signals" title="celery.signals"><tt class="xref py py-mod docutils literal"><span class="pre">celery.signals</span></tt></a> for more information.</p>
</div></blockquote>
</li>
<li><p class="first">New <a class="reference internal" href="configuration.html#std:setting-BROKER_TRANSPORT_OPTIONS"><tt class="xref std std-setting docutils literal"><span class="pre">BROKER_TRANSPORT_OPTIONS</span></tt></a> setting can be used to pass
additional arguments to a particular broker transport.</p>
</li>
<li><p class="first">celeryd: <tt class="docutils literal"><span class="pre">worker_pid</span></tt> is now part of the request info as returned by
broadcast commands.</p>
</li>
<li><p class="first">TaskSet.apply/Taskset.apply_async now accepts an optional <tt class="docutils literal"><span class="pre">taskset_id</span></tt>
argument.</p>
</li>
<li><p class="first">The taskset_id (if any) is now available in the Task request context.</p>
</li>
<li><p class="first">SQLAlchemy result backend: taskset_id and taskset_id columns now have a
unique constraint.  (Tables need to recreated for this to take affect).</p>
</li>
<li><p class="first">Task Userguide: Added section about choosing a result backend.</p>
</li>
<li><p class="first">Removed unused attribute <tt class="docutils literal"><span class="pre">AsyncResult.uuid</span></tt>.</p>
</li>
</ul>
</div>
<div class="section" id="v225-fixes">
<span id="id19"></span><h3><a class="toc-backref" href="#id117">Fixes</a><a class="headerlink" href="#v225-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">multiprocessing.Pool:  Fixes race condition when marking job with
<tt class="docutils literal"><span class="pre">WorkerLostError</span></tt> (<a class="reference external" href="https://github.com/ask/celery/issues/268" title="Worker Exits Prematurely with Semaphore Error when replacing worker after max tasks per child count"><span class="xref issue closed">Issue #268</span></a>).</p>
<blockquote>
<div><p>The process may have published a result before it was terminated,
but we have no reliable way to detect that this is the case.</p>
<p>So we have to wait for 10 seconds before marking the result with
WorkerLostError.  This gives the result handler a chance to retrieve the
result.</p>
</div></blockquote>
</li>
<li><p class="first">multiprocessing.Pool: Shutdown could hang if rate limits disabled.</p>
<blockquote>
<div><p>There was a race condition when the MainThread was waiting for the pool
semaphore to be released.  The ResultHandler now terminates after 5
seconds if there are unacked jobs, but no worker processes left to start
them  (it needs to timeout because there could still be an ack+result
that we haven&#8217;t consumed from the result queue. It
is unlikely we will receive any after 5 seconds with no worker processes).</p>
</div></blockquote>
</li>
<li><p class="first">celerybeat: Now creates pidfile even if the <tt class="docutils literal"><span class="pre">--detach</span></tt> option is not set.</p>
</li>
<li><p class="first">eventlet/gevent: The broadcast command consumer is now running in a separate
greenthread.</p>
<blockquote>
<div><p>This ensures broadcast commands will take priority even if there are many
active tasks.</p>
</div></blockquote>
</li>
<li><p class="first">Internal module <tt class="docutils literal"><span class="pre">celery.worker.controllers</span></tt> renamed to
<tt class="docutils literal"><span class="pre">celery.worker.mediator</span></tt>.</p>
</li>
<li><p class="first">celeryd: Threads now terminates the program by calling <tt class="docutils literal"><span class="pre">os._exit</span></tt>, as it
is the only way to ensure exit in the case of syntax errors, or other
unrecoverable errors.</p>
</li>
<li><p class="first">Fixed typo in <tt class="docutils literal"><span class="pre">maybe_timedelta</span></tt> (<a class="reference external" href="https://github.com/ask/celery/issues/352" title="maybe_timedelta tries to return a tiemdelta passing int type."><span class="xref issue closed">Issue #352</span></a>).</p>
</li>
<li><p class="first">celeryd: Broadcast commands now logs with loglevel debug instead of warning.</p>
</li>
<li><p class="first">AMQP Result Backend: Now resets cached channel if the connection is lost.</p>
</li>
<li><p class="first">Polling results with the AMQP result backend was not working properly.</p>
</li>
<li><p class="first">Rate limits: No longer sleeps if there are no tasks, but rather waits for
the task received condition (Performance improvement).</p>
</li>
<li><p class="first">ConfigurationView: <tt class="docutils literal"><span class="pre">iter(dict)</span></tt> should return keys, not items (<a class="reference external" href="https://github.com/ask/celery/issues/362" title="celery.datastructures.DictAttribute iteritems() relies on vars() which doesn't work nicely with settings."><span class="xref issue">Issue #362</span></a>).</p>
</li>
<li><p class="first">celerybeat:  PersistentScheduler now automatically removes a corrupted
schedule file (<a class="reference external" href="https://github.com/ask/celery/issues/346" title="Celerybeat stops working if PersistentStorage is corrupted"><span class="xref issue closed">Issue #346</span></a>).</p>
</li>
<li><p class="first">Programs that doesn&#8217;t support positional command line arguments now provides
a user friendly error message.</p>
</li>
<li><p class="first">Programs no longer tries to load the configuration file when showing
<tt class="docutils literal"><span class="pre">--version</span></tt> (<a class="reference external" href="https://github.com/ask/celery/issues/347" title="errors when checking version"><span class="xref issue closed">Issue #347</span></a>).</p>
</li>
<li><p class="first">Autoscaler: The &#8220;all processes busy&#8221; log message is now severity debug
instead of error.</p>
</li>
<li><p class="first">celeryd: If the message body can&#8217;t be decoded, it is now passed through
<tt class="docutils literal"><span class="pre">safe_str</span></tt> when logging.</p>
<blockquote>
<div><p>This to ensure we don&#8217;t get additional decoding errors when trying to log
the failure.</p>
</div></blockquote>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">app.config_from_object</span></tt>/<tt class="docutils literal"><span class="pre">app.config_from_envvar</span></tt> now works for all
loaders.</p>
</li>
<li><p class="first">Now emits a user-friendly error message if the result backend name is
unknown (<a class="reference external" href="https://github.com/ask/celery/issues/349" title="Nice error message when specifying wrong result backend"><span class="xref issue closed">Issue #349</span></a>).</p>
</li>
<li><p class="first"><a class="reference internal" href="reference/celery.contrib.batches.html#module-celery.contrib.batches" title="celery.contrib.batches"><tt class="xref py py-mod docutils literal"><span class="pre">celery.contrib.batches</span></tt></a>: Now sets loglevel and logfile in the task
request so <tt class="docutils literal"><span class="pre">task.get_logger</span></tt> works with batch tasks (<a class="reference external" href="https://github.com/ask/celery/issues/357" title="Log messages not appearing in batch tasks"><span class="xref issue closed">Issue #357</span></a>).</p>
</li>
<li><p class="first">celeryd: An exception was raised if using the amqp transport and the prefetch
count value exceeded 65535 (<a class="reference external" href="https://github.com/ask/celery/issues/359" title="Problem with more than 65535 scheduled tasks"><span class="xref issue closed">Issue #359</span></a>).</p>
<blockquote>
<div><p>The prefetch count is incremented for every received task with an
ETA/countdown defined.  The prefetch count is a short, so can only support
a maximum value of 65535.  If the value exceeds the maximum value we now
disable the prefetch count, it is re-enabled as soon as the value is below
the limit again.</p>
</div></blockquote>
</li>
<li><p class="first">cursesmon: Fixed unbound local error (<a class="reference external" href="https://github.com/ask/celery/issues/303" title="celeryev: race condition?"><span class="xref issue closed">Issue #303</span></a>).</p>
</li>
<li><p class="first">eventlet/gevent is now imported on demand so autodoc can import the modules
without having eventlet/gevent installed.</p>
</li>
<li><p class="first">celeryd: Ack callback now properly handles <tt class="docutils literal"><span class="pre">AttributeError</span></tt>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Task.after_return</span></tt> is now always called <em>after</em> the result has been
written.</p>
</li>
<li><p class="first">Cassandra Result Backend: Should now work with the latest <tt class="docutils literal"><span class="pre">pycassa</span></tt>
version.</p>
</li>
<li><p class="first">multiprocessing.Pool: No longer cares if the putlock semaphore is released
too many times. (this can happen if one or more worker processes are
killed).</p>
</li>
<li><p class="first">SQLAlchemy Result Backend: Now returns accidentally removed <tt class="docutils literal"><span class="pre">date_done</span></tt> again
(<a class="reference external" href="https://github.com/ask/celery/issues/325" title="date_done missing from get_task_meta result when using database result backend"><span class="xref issue closed">Issue #325</span></a>).</p>
</li>
<li><p class="first">Task.request contex is now always initialized to ensure calling the task
function directly works even if it actively uses the request context.</p>
</li>
<li><p class="first">Exception occuring when iterating over the result from <tt class="docutils literal"><span class="pre">TaskSet.apply</span></tt>
fixed.</p>
</li>
<li><p class="first">eventlet: Now properly schedules tasks with an ETA in the past.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="version-2-2-4">
<span id="id20"></span><h2><a class="toc-backref" href="#id118">2.2.4</a><a class="headerlink" href="#version-2-2-4" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2011-02-19 12:00 AM CET</td>
</tr>
</tbody>
</table>
<div class="section" id="v224-fixes">
<span id="id21"></span><h3><a class="toc-backref" href="#id119">Fixes</a><a class="headerlink" href="#v224-fixes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>celeryd: 2.2.3 broke error logging, resulting in tracebacks not being logged.</li>
<li>AMQP result backend: Polling task states did not work properly if there were
more than one result message in the queue.</li>
<li><tt class="docutils literal"><span class="pre">TaskSet.apply_async()</span></tt> and <tt class="docutils literal"><span class="pre">TaskSet.apply()</span></tt> now supports an optional
<tt class="docutils literal"><span class="pre">taskset_id</span></tt> keyword argument (<a class="reference external" href="https://github.com/ask/celery/issues/331" title="Optional taskset_id parameter for TaskSet.apply(_async)"><span class="xref issue closed">Issue #331</span></a>).</li>
<li>The current taskset id (if any) is now available in the task context as
<tt class="docutils literal"><span class="pre">request.taskset</span></tt> (<a class="reference external" href="https://github.com/ask/celery/issues/329" title="Propagate the taskset UUID from the message body to the task request"><span class="xref issue closed">Issue #329</span></a>).</li>
<li>SQLAlchemy result backend: <cite>date_done</cite> was no longer part of the results as it had
been accidentally removed.  It is now available again (<a class="reference external" href="https://github.com/ask/celery/issues/325" title="date_done missing from get_task_meta result when using database result backend"><span class="xref issue closed">Issue #325</span></a>).</li>
<li>SQLAlchemy result backend: Added unique constraint on <cite>Task.task_id</cite> and
<cite>TaskSet.taskset_id</cite>.  Tables needs to be recreated for this to take effect.</li>
<li>Fixed exception raised when iterating on the result of <tt class="docutils literal"><span class="pre">TaskSet.apply()</span></tt>.</li>
<li>Tasks Userguide: Added section on choosing a result backend.</li>
</ul>
</div>
</div>
<div class="section" id="version-2-2-3">
<span id="id22"></span><h2><a class="toc-backref" href="#id120">2.2.3</a><a class="headerlink" href="#version-2-2-3" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2011-02-12 04:00 P.M CET</td>
</tr>
</tbody>
</table>
<div class="section" id="v223-fixes">
<span id="id23"></span><h3><a class="toc-backref" href="#id121">Fixes</a><a class="headerlink" href="#v223-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Now depends on Kombu 1.0.3</p>
</li>
<li><p class="first">Task.retry now supports a <tt class="docutils literal"><span class="pre">max_retries</span></tt> argument, used to change the
default value.</p>
</li>
<li><p class="first"><cite>multiprocessing.cpu_count</cite> may raise <tt class="xref py py-exc docutils literal"><span class="pre">NotImplementedError</span></tt> on
platforms where this is not supported (<a class="reference external" href="https://github.com/ask/celery/issues/320" title="celery.apps.worker can raise NotImplementedError: cannot determine number of cpus"><span class="xref issue closed">Issue #320</span></a>).</p>
</li>
<li><p class="first">Coloring of log messages broke if the logged object was not a string.</p>
</li>
<li><p class="first">Fixed several typos in the init script documentation.</p>
</li>
<li><p class="first">A regression caused <cite>Task.exchange</cite> and <cite>Task.routing_key</cite> to no longer
have any effect.  This is now fixed.</p>
</li>
<li><p class="first">Routing Userguide: Fixes typo, routers in <a class="reference internal" href="configuration.html#std:setting-CELERY_ROUTES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_ROUTES</span></tt></a> must be
instances, not classes.</p>
</li>
<li><p class="first"><strong class="program">celeryev</strong> did not create pidfile even though the
<em class="xref std std-option">--pidfile</em> argument was set.</p>
</li>
<li><p class="first">Task logger format was no longer used. (<a class="reference external" href="https://github.com/ask/celery/issues/317" title="Correct default log format?"><span class="xref issue closed">Issue #317</span></a>).</p>
<blockquote>
<div><p>The id and name of the task is now part of the log message again.</p>
</div></blockquote>
</li>
<li><p class="first">A safe version of <tt class="docutils literal"><span class="pre">repr()</span></tt> is now used in strategic places to ensure
objects with a broken <tt class="docutils literal"><span class="pre">__repr__</span></tt> does not crash the worker, or otherwise
make errors hard to understand (<a class="reference external" href="https://github.com/ask/celery/issues/298" title="Task arg with a __repr__ bug causes hard-to-troubleshoot errors"><span class="xref issue closed">Issue #298</span></a>).</p>
</li>
<li><p class="first">Remote control command <tt class="docutils literal"><span class="pre">active_queues</span></tt>: did not account for queues added
at runtime.</p>
<blockquote>
<div><p>In addition the dictionary replied by this command now has a different
structure: the exchange key is now a dictionary containing the
exchange declaration in full.</p>
</div></blockquote>
</li>
<li><p class="first">The <em class="xref std std-option">-Q</em> option to <strong class="program">celeryd</strong> removed unused queue
declarations, so routing of tasks could fail.</p>
<blockquote>
<div><p>Queues are no longer removed, but rather <cite>app.amqp.queues.consume_from()</cite>
is used as the list of queues to consume from.</p>
<p>This ensures all queues are available for routing purposes.</p>
</div></blockquote>
</li>
<li><p class="first">celeryctl: Now supports the <cite>inspect active_queues</cite> command.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="version-2-2-2">
<span id="id24"></span><h2><a class="toc-backref" href="#id122">2.2.2</a><a class="headerlink" href="#version-2-2-2" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2011-02-03 04:00 P.M CET</td>
</tr>
</tbody>
</table>
<div class="section" id="v222-fixes">
<span id="id25"></span><h3><a class="toc-backref" href="#id123">Fixes</a><a class="headerlink" href="#v222-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Celerybeat could not read the schedule properly, so entries in
<a class="reference internal" href="configuration.html#std:setting-CELERYBEAT_SCHEDULE"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYBEAT_SCHEDULE</span></tt></a> would not be scheduled.</p>
</li>
<li><p class="first">Task error log message now includes <cite>exc_info</cite> again.</p>
</li>
<li><p class="first">The <cite>eta</cite> argument can now be used with <cite>task.retry</cite>.</p>
<blockquote>
<div><p>Previously it was overwritten by the countdown argument.</p>
</div></blockquote>
</li>
<li><p class="first">celeryd-multi/celeryd_detach: Now logs errors occuring when executing
the <cite>celeryd</cite> command.</p>
</li>
<li><p class="first">daemonizing cookbook: Fixed typo <tt class="docutils literal"><span class="pre">--time-limit</span> <span class="pre">300</span></tt> -&gt;
<tt class="docutils literal"><span class="pre">--time-limit=300</span></tt></p>
</li>
<li><p class="first">Colors in logging broke non-string objects in log messages.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">setup_task_logger</span></tt> no longer makes assumptions about magic task kwargs.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="version-2-2-1">
<span id="id26"></span><h2><a class="toc-backref" href="#id124">2.2.1</a><a class="headerlink" href="#version-2-2-1" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2011-02-02 04:00 P.M CET</td>
</tr>
</tbody>
</table>
<div class="section" id="v221-fixes">
<span id="id27"></span><h3><a class="toc-backref" href="#id125">Fixes</a><a class="headerlink" href="#v221-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Eventlet pool was leaking memory (<a class="reference external" href="https://github.com/ask/celery/issues/308" title="eventlet pool is leaking memory like crazy!"><span class="xref issue closed">Issue #308</span></a>).</p>
</li>
<li><p class="first">Deprecated function <tt class="docutils literal"><span class="pre">celery.execute.delay_task</span></tt> was accidentally removed,
now available again.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">BasePool.on_terminate</span></tt> stub did not exist</p>
</li>
<li><dl class="first docutils">
<dt>celeryd detach: Adds readable error messages if user/group name does not</dt>
<dd><p class="first last">exist.</p>
</dd>
</dl>
</li>
<li><p class="first">Smarter handling of unicode decod errors when logging errors.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="version-2-2-0">
<span id="id28"></span><h2><a class="toc-backref" href="#id126">2.2.0</a><a class="headerlink" href="#version-2-2-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2011-02-01 10:00 AM CET</td>
</tr>
</tbody>
</table>
<div class="section" id="v220-important">
<span id="id29"></span><h3><a class="toc-backref" href="#id127">Important Notes</a><a class="headerlink" href="#v220-important" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Carrot has been replaced with <a class="reference external" href="http://pypi.python.org/pypi/kombu">Kombu</a></p>
<blockquote>
<div><p>Kombu is the next generation messaging framework for Python,
fixing several flaws present in Carrot that was hard to fix
without breaking backwards compatibility.</p>
<p>Also it adds:</p>
<ul class="simple">
<li>First-class support for virtual transports; Redis, Django ORM,
SQLAlchemy, Beanstalk, MongoDB, CouchDB and in-memory.</li>
<li>Consistent error handling with introspection,</li>
<li>The ability to ensure that an operation is performed by gracefully
handling connection and channel errors,</li>
<li>Message compression (zlib, bzip2, or custom compression schemes).</li>
</ul>
<p>This means that <cite>ghettoq</cite> is no longer needed as the
functionality it provided is already available in Celery by default.
The virtual transports are also more feature complete with support
for exchanges (direct and topic).  The Redis transport even supports
fanout exchanges so it is able to perform worker remote control
commands.</p>
</div></blockquote>
</li>
</ul>
<ul>
<li><p class="first">Magic keyword arguments pending deprecation.</p>
<blockquote>
<div><p>The magic keyword arguments were responsibile for many problems
and quirks: notably issues with tasks and decorators, and name
collisions in keyword arguments for the unaware.</p>
<p>It wasn&#8217;t easy to find a way to deprecate the magic keyword arguments,
but we think this is a solution that makes sense and it will not
have any adverse effects for existing code.</p>
<p>The path to a magic keyword argument free world is:</p>
<blockquote>
<div><ul class="simple">
<li>the <cite>celery.decorators</cite> module is deprecated and the decorators
can now be found in <cite>celery.task</cite>.</li>
<li>The decorators in <cite>celery.task</cite> disables keyword arguments by
default</li>
<li>All examples in the documentation have been changed to use
<cite>celery.task</cite>.</li>
</ul>
<p>This means that the following will have magic keyword arguments
enabled (old style):</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery.decorators</span> <span class="kn">import</span> <span class="n">task</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;In task </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;task_id&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
</div></blockquote>
<p>And this will not use magic keyword arguments (new style):</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery.task</span> <span class="kn">import</span> <span class="n">task</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;In task </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">add</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p>In addition, tasks can choose not to accept magic keyword arguments by
setting the <cite>task.accept_magic_kwargs</cite> attribute.</p>
<div class="admonition-deprecation admonition">
<p class="first admonition-title">Deprecation</p>
<p>Using the decorators in <tt class="xref py py-mod docutils literal"><span class="pre">celery.decorators</span></tt> emits a
<tt class="xref py py-class docutils literal"><span class="pre">PendingDeprecationWarning</span></tt> with a helpful message urging
you to change your code, in version 2.4 this will be replaced with
a <tt class="xref py py-class docutils literal"><span class="pre">DeprecationWarning</span></tt>, and in version 3.0 the
<tt class="xref py py-mod docutils literal"><span class="pre">celery.decorators</span></tt> module will be removed and no longer exist.</p>
<p class="last">Similarly, the <cite>task.accept_magic_kwargs</cite> attribute will no
longer have any effect starting from version 3.0.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">The magic keyword arguments are now available as <cite>task.request</cite></p>
<blockquote>
<div><p>This is called <em>the context</em>.  Using thread-local storage the
context contains state that is related to the current request.</p>
<p>It is mutable and you can add custom attributes that will only be seen
by the current task request.</p>
<p>The following context attributes are always available:</p>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><p class="first last"><strong>Magic Keyword Argument</strong></p>
</th>
<th class="head"><p class="first last"><strong>Replace with</strong></p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><p class="first last"><cite>kwargs[&#8220;task_id&#8221;]</cite></p>
</td>
<td><p class="first last"><cite>self.request.id</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>kwargs[&#8220;delivery_info&#8221;]</cite></p>
</td>
<td><p class="first last"><cite>self.request.delivery_info</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>kwargs[&#8220;task_retries&#8221;]</cite></p>
</td>
<td><p class="first last"><cite>self.request.retries</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>kwargs[&#8220;logfile&#8221;]</cite></p>
</td>
<td><p class="first last"><cite>self.request.logfile</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>kwargs[&#8220;loglevel&#8221;]</cite></p>
</td>
<td><p class="first last"><cite>self.request.loglevel</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>kwargs[&#8220;task_is_eager</cite></p>
</td>
<td><p class="first last"><cite>self.request.is_eager</cite></p>
</td>
</tr>
<tr><td><p class="first last"><strong>NEW</strong></p>
</td>
<td><p class="first last"><cite>self.request.args</cite></p>
</td>
</tr>
<tr><td><p class="first last"><strong>NEW</strong></p>
</td>
<td><p class="first last"><cite>self.request.kwargs</cite></p>
</td>
</tr>
</tbody>
</table>
<p>In addition, the following methods now automatically uses the current
context, so you don&#8217;t have to pass <cite>kwargs</cite> manually anymore:</p>
<blockquote>
<div><ul class="simple">
<li><cite>task.retry</cite></li>
<li><cite>task.get_logger</cite></li>
<li><cite>task.update_state</cite></li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
<li><p class="first"><a class="reference external" href="http://eventlet.net">Eventlet</a> support.</p>
<blockquote>
<div><p>This is great news for I/O-bound tasks!</p>
<p>To change pool implementations you use the <em class="xref std std-option">-P|--pool</em> argument
to <strong class="program">celeryd</strong>, or globally using the
<a class="reference internal" href="configuration.html#std:setting-CELERYD_POOL"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_POOL</span></tt></a> setting.  This can be the full name of a class,
or one of the following aliases: <cite>processes</cite>, <cite>eventlet</cite>, <cite>gevent</cite>.</p>
<p>For more information please see the <a class="reference internal" href="userguide/concurrency/eventlet.html#concurrency-eventlet"><em>Concurrency with Eventlet</em></a> section
in the User Guide.</p>
<div class="admonition-why-not-gevent admonition">
<p class="first admonition-title">Why not gevent?</p>
<p>For our first alternative concurrency implementation we have focused
on <a class="reference external" href="http://eventlet.net">Eventlet</a>, but there is also an experimental <a class="reference external" href="http://gevent.org">gevent</a> pool
available. This is missing some features, notably the ability to
schedule ETA tasks.</p>
<p class="last">Hopefully the <a class="reference external" href="http://gevent.org">gevent</a> support will be feature complete by
version 2.3, but this depends on user demand (and contributions).</p>
</div>
</div></blockquote>
</li>
</ul>
<ul>
<li><p class="first">Python 2.4 support deprecated!</p>
<blockquote>
<div><p>We&#8217;re happy^H^H^H^H^Hsad to announce that this is the last version
to support Python 2.4.</p>
<p>You are urged to make some noise if you&#8217;re currently stuck with
Python 2.4.  Complain to your package maintainers, sysadmins and bosses:
tell them it&#8217;s time to move on!</p>
<p>Apart from wanting to take advantage of with-statements, coroutines,
conditional expressions and enhanced try blocks, the code base
now contains so many 2.4 related hacks and workarounds it&#8217;s no longer
just a compromise, but a sacrifice.</p>
<p>If it really isn&#8217;t your choice, and you don&#8217;t have the option to upgrade
to a newer version of Python, you can just continue to use Celery 2.2.
Important fixes can be backported for as long as there is interest.</p>
</div></blockquote>
</li>
<li><p class="first"><cite>celeryd</cite>: Now supports Autoscaling of child worker processes.</p>
<blockquote>
<div><p>The <em class="xref std std-option">--autoscale</em> option can be used to configure the minimum
and maximum number of child worker processes:</p>
<div class="highlight-python"><pre>--autoscale=AUTOSCALE
     Enable autoscaling by providing
     max_concurrency,min_concurrency.  Example:
       --autoscale=10,3 (always keep 3 processes, but grow to
      10 if necessary).</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Remote Debugging of Tasks</p>
<blockquote>
<div><p><tt class="docutils literal"><span class="pre">celery.contrib.rdb</span></tt> is an extended version of <tt class="xref py py-mod docutils literal"><span class="pre">pdb</span></tt> that
enables remote debugging of processes that does not have terminal
access.</p>
<p>Example usage:</p>
<div class="highlight-python"><pre>    from celery.contrib import rdb
    from celery.task import task

    @task
    def add(x, y):
        result = x + y
        rdb.set_trace()  # &lt;- set breakpoint
        return result


:func:`~celery.contrib.rdb.set_trace` sets a breakpoint at the current
location and creates a socket you can telnet into to remotely debug
your task.

The debugger may be started by multiple processes at the same time,
so rather than using a fixed port the debugger will search for an
available port, starting from the base port (6900 by default).
The base port can be changed using the environment variable
:envvar:`CELERY_RDB_PORT`.

By default the debugger will only be available from the local host,
to enable access from the outside you have to set the environment
variable :envvar:`CELERY_RDB_HOST`.

When `celeryd` encounters your breakpoint it will log the following
information::

    [INFO/MainProcess] Got task from broker:
        tasks.add[d7261c71-4962-47e5-b342-2448bedd20e8]
    [WARNING/PoolWorker-1] Remote Debugger:6900:
        Please telnet 127.0.0.1 6900.  Type `exit` in session to continue.
    [2011-01-18 14:25:44,119: WARNING/PoolWorker-1] Remote Debugger:6900:
        Waiting for client...

If you telnet the port specified you will be presented
with a ``pdb`` shell::

    $ telnet localhost 6900
    Connected to localhost.
    Escape character is '^]'.
    &gt; /opt/devel/demoapp/tasks.py(128)add()
    -&gt; return result
    (Pdb)

Enter ``help`` to get a list of available commands,
It may be a good idea to read the `Python Debugger Manual`_ if
you have never used `pdb` before.</pre>
</div>
</div></blockquote>
</li>
</ul>
<ul>
<li><p class="first">Events are now transient and is using a topic exchange (instead of direct).</p>
<blockquote>
<div><p>The <cite>CELERYD_EVENT_EXCHANGE</cite>, <cite>CELERYD_EVENT_ROUTING_KEY</cite>,
<cite>CELERYD_EVENT_EXCHANGE_TYPE</cite> settings are no longer in use.</p>
<p>This means events will not be stored until there is a consumer, and the
events will be gone as soon as the consumer stops.  Also it means there
can be multiple monitors running at the same time.</p>
<p>The routing key of an event is the type of event (e.g. <cite>worker.started</cite>,
<cite>worker.heartbeat</cite>, <cite>task.succeeded</cite>, etc.  This means a consumer can
filter on specific types, to only be alerted of the events it cares about.</p>
<p>Each consumer will create a unique queue, meaning it is in effect a
broadcast exchange.</p>
<p>This opens up a lot of possibilities, for example the workers could listen
for worker events to know what workers are in the neighborhood, and even
restart workers when they go down (or use this information to optimize
tasks/autoscaling).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The event exchange has been renamed from &#8220;celeryevent&#8221; to &#8220;celeryev&#8221;
so it does not collide with older versions.</p>
<p>If you would like to remove the old exchange you can do so
by executing the following command:</p>
<div class="last highlight-python"><pre>$ camqadm exchange.delete celeryevent</pre>
</div>
</div>
</div></blockquote>
</li>
<li><p class="first"><cite>celeryd</cite> now starts without configuration, and configuration can be
specified directly on the command line.</p>
<p>Configuration options must appear after the last argument, separated
by two dashes:</p>
<div class="highlight-python"><pre>$ celeryd -l info -I tasks -- broker.host=localhost broker.vhost=/app</pre>
</div>
</li>
<li><p class="first">Configuration is now an alias to the original configuration, so changes
to the original will reflect Celery at runtime.</p>
</li>
<li><p class="first"><cite>celery.conf</cite> has been deprecated, and modifying <cite>celery.conf.ALWAYS_EAGER</cite>
will no longer have any effect.</p>
<blockquote>
<div><p>The default configuration is now available in the
<a class="reference internal" href="reference/celery.app.defaults.html#module-celery.app.defaults" title="celery.app.defaults"><tt class="xref py py-mod docutils literal"><span class="pre">celery.app.defaults</span></tt></a> module.  The available configuration options
and their types can now be introspected.</p>
</div></blockquote>
</li>
<li><p class="first">Remote control commands are now provided by <cite>kombu.pidbox</cite>, the generic
process mailbox.</p>
</li>
<li><p class="first">Internal module <cite>celery.worker.listener</cite> has been renamed to
<cite>celery.worker.consumer</cite>, and <cite>.CarrotListener</cite> is now <cite>.Consumer</cite>.</p>
</li>
<li><p class="first">Previously deprecated modules <cite>celery.models</cite> and
<cite>celery.management.commands</cite> have now been removed as per the deprecation
timeline.</p>
</li>
<li><dl class="first docutils">
<dt>[Security: Low severity] Removed <cite>celery.task.RemoteExecuteTask</cite> and</dt>
<dd><p class="first">accompanying functions: <cite>dmap</cite>, <cite>dmap_async</cite>, and <cite>execute_remote</cite>.</p>
<p>Executing arbitrary code using pickle is a potential security issue if
someone gains unrestricted access to the message broker.</p>
<p class="last">If you really need this functionality, then you would have to add
this to your own project.</p>
</dd>
</dl>
</li>
<li><p class="first">[Security: Low severity] The <cite>stats</cite> command no longer transmits the
broker password.</p>
<blockquote>
<div><p>One would have needed an authenticated broker connection to receive
this password in the first place, but sniffing the password at the
wire level would have been possible if using unencrypted communication.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="v220-news">
<span id="id30"></span><h3><a class="toc-backref" href="#id128">News</a><a class="headerlink" href="#v220-news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">The internal module <cite>celery.task.builtins</cite> has been removed.</p>
</li>
<li><p class="first">The module <cite>celery.task.schedules</cite> is deprecated, and
<cite>celery.schedules</cite> should be used instead.</p>
<blockquote>
<div><p>For example if you have:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery.task.schedules</span> <span class="kn">import</span> <span class="n">crontab</span>
</pre></div>
</div>
<p>You should replace that with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery.schedules</span> <span class="kn">import</span> <span class="n">crontab</span>
</pre></div>
</div>
<p>The module needs to be renamed because it must be possible
to import schedules without importing the <cite>celery.task</cite> module.</p>
</div></blockquote>
</li>
<li><p class="first">The following functions have been deprecated and is scheduled for
removal in version 2.3:</p>
<blockquote>
<div><ul>
<li><p class="first"><cite>celery.execute.apply_async</cite></p>
<blockquote>
<div><p>Use <cite>task.apply_async()</cite> instead.</p>
</div></blockquote>
</li>
<li><p class="first"><cite>celery.execute.apply</cite></p>
<blockquote>
<div><p>Use <cite>task.apply()</cite> instead.</p>
</div></blockquote>
</li>
<li><p class="first"><cite>celery.execute.delay_task</cite></p>
<blockquote>
<div><p>Use <cite>registry.tasks[name].delay()</cite> instead.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Importing <cite>TaskSet</cite> from <cite>celery.task.base</cite> is now deprecated.</p>
<blockquote>
<div><p>You should use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task</span> <span class="kn">import</span> <span class="n">TaskSet</span>
</pre></div>
</div>
<p>instead.</p>
</div></blockquote>
</li>
<li><p class="first">New remote control commands:</p>
<blockquote>
<div><ul>
<li><p class="first"><cite>active_queues</cite></p>
<blockquote>
<div><p>Returns the queue declarations a worker is currently consuming from.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Added the ability to retry publishing the task message in
the event of connection loss or failure.</p>
<blockquote>
<div><p>This is disabled by default but can be enabled using the
<a class="reference internal" href="configuration.html#std:setting-CELERY_TASK_PUBLISH_RETRY"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_PUBLISH_RETRY</span></tt></a> setting, and tweaked by
the <a class="reference internal" href="configuration.html#std:setting-CELERY_TASK_PUBLISH_RETRY_POLICY"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_PUBLISH_RETRY_POLICY</span></tt></a> setting.</p>
<p>In addition <cite>retry</cite>, and <cite>retry_policy</cite> keyword arguments have
been added to <cite>Task.apply_async</cite>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using the <cite>retry</cite> argument to <cite>apply_async</cite> requires you to
handle the publisher/connection manually.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Periodic Task classes (<cite>&#64;periodic_task</cite>/<cite>PeriodicTask</cite>) will <em>not</em> be
deprecated as previously indicated in the source code.</p>
<blockquote>
<div><p>But you are encouraged to use the more flexible
<a class="reference internal" href="configuration.html#std:setting-CELERYBEAT_SCHEDULE"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYBEAT_SCHEDULE</span></tt></a> setting.</p>
</div></blockquote>
</li>
<li><p class="first">Built-in daemonization support of celeryd using <cite>celeryd-multi</cite>
is no longer experimental and is considered production quality.</p>
<blockquote>
<div><p>See <a class="reference internal" href="cookbook/daemonizing.html#daemon-generic"><em>Generic init scripts</em></a> if you want to use the new generic init
scripts.</p>
</div></blockquote>
</li>
<li><p class="first">Added support for message compression using the
<a class="reference internal" href="configuration.html#std:setting-CELERY_MESSAGE_COMPRESSION"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_MESSAGE_COMPRESSION</span></tt></a> setting, or the <cite>compression</cite> argument
to <cite>apply_async</cite>.  This can also be set using routers.</p>
</li>
<li><dl class="first docutils">
<dt><cite>celeryd</cite>: Now logs stacktrace of all threads when receiving the</dt>
<dd><p class="first"><cite>SIGUSR1</cite> signal.  (Does not work on cPython 2.4, Windows or Jython).</p>
<blockquote class="last">
<div><p>Inspired by <a class="reference external" href="https://gist.github.com/737056">https://gist.github.com/737056</a></p>
</div></blockquote>
</dd>
</dl>
</li>
<li><p class="first">Can now remotely terminate/kill the worker process currently processing
a task.</p>
<blockquote>
<div><p>The <cite>revoke</cite> remote control command now supports a <cite>terminate</cite> argument
Default signal is <cite>TERM</cite>, but can be specified using the <cite>signal</cite>
argument. Signal can be the uppercase name of any signal defined
in the <tt class="xref py py-mod docutils literal"><span class="pre">signal</span></tt> module in the Python Standard Library.</p>
<p>Terminating a task also revokes it.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task.control</span> <span class="kn">import</span> <span class="n">revoke</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">revoke</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">terminate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">revoke</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">terminate</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="s">&quot;KILL&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">revoke</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">terminate</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="s">&quot;SIGKILL&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><cite>TaskSetResult.join_native</cite>: Backend-optimized version of <cite>join()</cite>.</p>
<blockquote>
<div><p>If available, this version uses the backends ability to retrieve
multiple results at once, unlike <cite>join()</cite> which fetches the results
one by one.</p>
<p>So far only supported by the AMQP result backend.  Support for memcached
and Redis may be added later.</p>
</div></blockquote>
</li>
<li><p class="first">Improved implementations of <cite>TaskSetResult.join</cite> and <cite>AsyncResult.wait</cite>.</p>
<blockquote>
<div><p>An <cite>interval</cite> keyword argument have been added to both so the
polling interval can be specified (default interval is 0.5 seconds).</p>
<blockquote>
<div><p>A <cite>propagate</cite> keyword argument have been added to <cite>result.wait()</cite>,
errors will be returned instead of raised if this is set to False.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You should decrease the polling interval when using the database
result backend, as frequent polling can result in high database load.</p>
</div>
</div></blockquote>
</div></blockquote>
</li>
<li><p class="first">The PID of the child worker process accepting a task is now sent as a field
with the <cite>task-started</cite> event.</p>
</li>
<li><p class="first">The following fields have been added to all events in the worker class:</p>
<blockquote>
<div><ul class="simple">
<li><cite>sw_ident</cite>: Name of worker software (e.g. celeryd).</li>
<li><cite>sw_ver</cite>: Software version (e.g. 2.2.0).</li>
<li><cite>sw_sys</cite>: Operating System (e.g. Linux, Windows, Darwin).</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">For better accuracy the start time reported by the multiprocessing worker
process is used when calculating task duration.</p>
<blockquote>
<div><p>Previously the time reported by the accept callback was used.</p>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt><cite>celerybeat</cite>: New built-in daemonization support using the <cite>&#8211;detach</cite></dt>
<dd><p class="first last">option.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>celeryev</cite>: New built-in daemonization support using the <cite>&#8211;detach</cite></dt>
<dd><p class="first last">option.</p>
</dd>
</dl>
</li>
<li><p class="first"><cite>TaskSet.apply_async</cite>: Now supports custom publishers by using the
<cite>publisher</cite> argument.</p>
</li>
<li><p class="first">Added <a class="reference internal" href="configuration.html#std:setting-CELERY_SEND_TASK_SENT_EVENT"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_SEND_TASK_SENT_EVENT</span></tt></a> setting.</p>
<blockquote>
<div><p>If enabled an event will be sent with every task, so monitors can
track tasks before the workers receive them.</p>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt><cite>celerybeat</cite>: Now reuses the broker connection when applying</dt>
<dd><p class="first last">scheduled tasks.</p>
</dd>
</dl>
</li>
<li><p class="first">The configuration module and loader to use can now be specified on
the command line.</p>
<blockquote>
<div><p>For example:</p>
<div class="highlight-python"><pre>$ celeryd --config=celeryconfig.py --loader=myloader.Loader</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Added signals: <cite>beat_init</cite> and <cite>beat_embedded_init</cite></p>
<blockquote>
<div><ul>
<li><p class="first"><tt class="xref std std-signal docutils literal"><span class="pre">celery.signals.beat_init</span></tt></p>
<blockquote>
<div><p>Dispatched when <strong class="program">celerybeat</strong> starts (either standalone or
embedded).  Sender is the <a class="reference internal" href="internals/reference/celery.beat.html#celery.beat.Service" title="celery.beat.Service"><tt class="xref py py-class docutils literal"><span class="pre">celery.beat.Service</span></tt></a> instance.</p>
</div></blockquote>
</li>
<li><p class="first"><tt class="xref std std-signal docutils literal"><span class="pre">celery.signals.beat_embedded_init</span></tt></p>
<blockquote>
<div><p>Dispatched in addition to the <a class="reference internal" href="reference/celery.signals.html#std:signal-beat_init"><tt class="xref std std-signal docutils literal"><span class="pre">beat_init</span></tt></a> signal when
<strong class="program">celerybeat</strong> is started as an embedded process.  Sender
is the <a class="reference internal" href="internals/reference/celery.beat.html#celery.beat.Service" title="celery.beat.Service"><tt class="xref py py-class docutils literal"><span class="pre">celery.beat.Service</span></tt></a> instance.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Redis result backend: Removed deprecated settings <cite>REDIS_TIMEOUT</cite> and
<cite>REDIS_CONNECT_RETRY</cite>.</p>
</li>
<li><p class="first">CentOS init script for <strong class="program">celeryd</strong> now available in <cite>contrib/centos</cite>.</p>
</li>
<li><p class="first">Now depends on <cite>pyparsing</cite> version 1.5.0 or higher.</p>
<blockquote>
<div><p>There have been reported issues using Celery with pyparsing 1.4.x,
so please upgrade to the latest version.</p>
</div></blockquote>
</li>
<li><p class="first">Lots of new unit tests written, now with a total coverage of 95%.</p>
</li>
</ul>
</div>
<div class="section" id="v220-fixes">
<span id="id31"></span><h3><a class="toc-backref" href="#id129">Fixes</a><a class="headerlink" href="#v220-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><cite>celeryev</cite> Curses Monitor: Improved resize handling and UI layout
(<a class="reference external" href="https://github.com/ask/celery/issues/274" title="Ncurses ui layout"><span class="xref issue closed">Issue #274</span></a> + <a class="reference external" href="https://github.com/ask/celery/issues/276" title="Ncurses ui layout"><span class="xref issue closed">Issue #276</span></a>)</p>
</li>
<li><p class="first">AMQP Backend: Exceptions occurring while sending task results are now
propagated instead of silenced.</p>
<blockquote>
<div><p><cite>celeryd</cite> will then show the full traceback of these errors in the log.</p>
</div></blockquote>
</li>
<li><p class="first">AMQP Backend: No longer deletes the result queue after successful
poll, as this should be handled by the
<a class="reference internal" href="configuration.html#std:setting-CELERY_AMQP_TASK_RESULT_EXPIRES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_AMQP_TASK_RESULT_EXPIRES</span></tt></a> setting instead.</p>
</li>
<li><p class="first">AMQP Backend: Now ensures queues are declared before polling results.</p>
</li>
<li><p class="first">Windows: celeryd: Show error if running with <cite>-B</cite> option.</p>
<blockquote>
<div><p>Running celerybeat embedded is known not to work on Windows, so
users are encouraged to run celerybeat as a separate service instead.</p>
</div></blockquote>
</li>
<li><p class="first">Windows: Utilities no longer output ANSI color codes on Windows</p>
</li>
<li><p class="first">camqadm: Now properly handles Ctrl+C by simply exiting instead of showing
confusing traceback.</p>
</li>
<li><p class="first">Windows: All tests are now passing on Windows.</p>
</li>
<li><p class="first">Remove bin/ directory, and <cite>scripts</cite> section from setup.py.</p>
<blockquote>
<div><p>This means we now rely completely on setuptools entrypoints.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="experimental">
<span id="v220-experimental"></span><h3><a class="toc-backref" href="#id130">Experimental</a><a class="headerlink" href="#experimental" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Jython: celeryd now runs on Jython using the threaded pool.</p>
<blockquote>
<div><p>All tests pass, but there may still be bugs lurking around the corners.</p>
</div></blockquote>
</li>
<li><p class="first">PyPy: celeryd now runs on PyPy.</p>
<blockquote>
<div><p>It runs without any pool, so to get parallel execution you must start
multiple instances (e.g. using <strong class="program">celeryd-multi</strong>).</p>
<p>Sadly an initial benchmark seems to show a 30% performance decrease on
pypy-1.4.1 + JIT.  We would like to find out why this is, so stay tuned.</p>
</div></blockquote>
</li>
<li><p class="first"><tt class="xref py py-class docutils literal"><span class="pre">PublisherPool</span></tt>: Experimental pool of task publishers and
connections to be used with the <cite>retry</cite> argument to <cite>apply_async</cite>.</p>
<p>The example code below will re-use connections and channels, and
retry sending of the task message if the connection is lost.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">current_app</span>

<span class="c"># Global pool</span>
<span class="n">pool</span> <span class="o">=</span> <span class="n">current_app</span><span class="p">()</span><span class="o">.</span><span class="n">amqp</span><span class="o">.</span><span class="n">PublisherPool</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">pool</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="k">as</span> <span class="n">publisher</span><span class="p">:</span>
        <span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">publisher</span><span class="o">=</span><span class="n">publisher</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="version-2-1-4">
<span id="id32"></span><h2><a class="toc-backref" href="#id131">2.1.4</a><a class="headerlink" href="#version-2-1-4" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-12-03 12:00 P.M CEST</td>
</tr>
</tbody>
</table>
<div class="section" id="v214-fixes">
<span id="id33"></span><h3><a class="toc-backref" href="#id132">Fixes</a><a class="headerlink" href="#v214-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Execution options to <cite>apply_async</cite> now takes precedence over options
returned by active routers.  This was a regression introduced recently
(<a class="reference external" href="https://github.com/ask/celery/issues/244" title="execution options to apply_async should take precedence over routes."><span class="xref issue closed">Issue #244</span></a>).</p>
</li>
<li><p class="first"><cite>celeryev</cite> curses monitor: Long arguments are now truncated so curses
doesn&#8217;t crash with out of bounds errors.  (<a class="reference external" href="https://github.com/ask/celery/issues/235" title="celeryev does not properly truncate output"><span class="xref issue closed">Issue #235</span></a>).</p>
</li>
<li><p class="first"><cite>celeryd</cite>: Channel errors occurring while handling control commands no
longer crash the worker but are instead logged with severity error.</p>
</li>
<li><p class="first">SQLAlchemy database backend: Fixed a race condition occurring when
the client wrote the pending state.  Just like the Django database backend,
it does no longer save the pending state (<a class="reference external" href="https://github.com/ask/celery/issues/261" title="task.get() blocks without ever returning."><span class="xref issue closed">Issue #261</span></a> + <a class="reference external" href="https://github.com/ask/celery/issues/262" title="Db backend consistency"><span class="xref issue closed">Issue #262</span></a>).</p>
</li>
<li><p class="first">Error email body now uses <cite>repr(exception)</cite> instead of <cite>str(exception)</cite>,
as the latter could result in Unicode decode errors (<a class="reference external" href="https://github.com/ask/celery/issues/245" title="error email body should use repr(exc) not str(exc)"><span class="xref issue closed">Issue #245</span></a>).</p>
</li>
<li><p class="first">Error email timeout value is now configurable by using the
<a class="reference internal" href="configuration.html#std:setting-EMAIL_TIMEOUT"><tt class="xref std std-setting docutils literal"><span class="pre">EMAIL_TIMEOUT</span></tt></a> setting.</p>
</li>
<li><p class="first"><cite>celeryev</cite>: Now works on Windows (but the curses monitor won&#8217;t work without
having curses).</p>
</li>
<li><p class="first">Unit test output no longer emits non-standard characters.</p>
</li>
<li><p class="first"><cite>celeryd</cite>: The broadcast consumer is now closed if the connection is reset.</p>
</li>
<li><p class="first"><cite>celeryd</cite>: Now properly handles errors occurring while trying to acknowledge
the message.</p>
</li>
<li><dl class="first docutils">
<dt><cite>TaskRequest.on_failure</cite> now encodes traceback using the current filesystem</dt>
<dd><p class="first last">encoding.  (<a class="reference external" href="https://github.com/ask/celery/issues/286" title="worker.job.TaskReqeust.on_failure forces utf-8 encoding for traceback"><span class="xref issue closed">Issue #286</span></a>).</p>
</dd>
</dl>
</li>
<li><p class="first"><cite>EagerResult</cite> can now be pickled (<a class="reference external" href="https://github.com/ask/celery/issues/288" title="TaskSetResult cannot save with EagerResult"><span class="xref issue closed">Issue #288</span></a>).</p>
</li>
</ul>
</div>
<div class="section" id="documentation">
<span id="v214-documentation"></span><h3><a class="toc-backref" href="#id133">Documentation</a><a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Adding <a class="reference internal" href="contributing.html#contributing"><em>Contributing</em></a>.</li>
<li>Added <a class="reference internal" href="userguide/optimizing.html#guide-optimizing"><em>Optimizing</em></a>.</li>
<li>Added <a class="reference internal" href="faq.html#faq-security"><em>Security</em></a> section to the FAQ.</li>
</ul>
</div>
</div>
<div class="section" id="version-2-1-3">
<span id="id34"></span><h2><a class="toc-backref" href="#id134">2.1.3</a><a class="headerlink" href="#version-2-1-3" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-11-09 05:00 P.M CEST</td>
</tr>
</tbody>
</table>
<ul id="v213-fixes">
<li><p class="first">Fixed deadlocks in <cite>timer2</cite> which could lead to <cite>djcelerymon</cite>/<cite>celeryev -c</cite>
hanging.</p>
</li>
<li><p class="first"><cite>EventReceiver</cite>: now sends heartbeat request to find workers.</p>
<blockquote>
<div><p>This means <strong class="program">celeryev</strong> and friends finds workers immediately
at startup.</p>
</div></blockquote>
</li>
<li><p class="first">celeryev cursesmon: Set screen_delay to 10ms, so the screen refreshes more
often.</p>
</li>
<li><p class="first">Fixed pickling errors when pickling <tt class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></tt> on older Python
versions.</p>
</li>
<li><p class="first">celeryd: prefetch count was decremented by eta tasks even if there
were no active prefetch limits.</p>
</li>
</ul>
</div>
<div class="section" id="version-2-1-2">
<span id="id35"></span><h2><a class="toc-backref" href="#id135">2.1.2</a><a class="headerlink" href="#version-2-1-2" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-data:</th><td class="field-body">TBA</td>
</tr>
</tbody>
</table>
<div class="section" id="v212-fixes">
<span id="id36"></span><h3><a class="toc-backref" href="#id136">Fixes</a><a class="headerlink" href="#v212-fixes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>celeryd: Now sends the <cite>task-retried</cite> event for retried tasks.</li>
<li>celeryd: Now honors ignore result for
<a class="reference internal" href="reference/celery.exceptions.html#celery.exceptions.WorkerLostError" title="celery.exceptions.WorkerLostError"><tt class="xref py py-exc docutils literal"><span class="pre">WorkerLostError</span></tt></a> and timeout errors.</li>
<li>celerybeat: Fixed <tt class="xref py py-exc docutils literal"><span class="pre">UnboundLocalError</span></tt> in celerybeat logging
when using logging setup signals.</li>
<li>celeryd: All log messages now includes <cite>exc_info</cite>.</li>
</ul>
</div>
</div>
<div class="section" id="version-2-1-1">
<span id="id37"></span><h2><a class="toc-backref" href="#id137">2.1.1</a><a class="headerlink" href="#version-2-1-1" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-10-14 02:00 P.M CEST</td>
</tr>
</tbody>
</table>
<div class="section" id="v211-fixes">
<span id="id38"></span><h3><a class="toc-backref" href="#id138">Fixes</a><a class="headerlink" href="#v211-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Now working on Windows again.</p>
<blockquote>
<div><p>Removed dependency on the pwd/grp modules.</p>
</div></blockquote>
</li>
<li><p class="first">snapshots: Fixed race condition leading to loss of events.</p>
</li>
<li><p class="first">celeryd: Reject tasks with an eta that cannot be converted to a time stamp.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/209" title="Problem upgrading from 2.0.3 -&gt; 2.1"><span class="xref issue closed">issue #209</span></a></p>
</div></blockquote>
</li>
<li><p class="first">concurrency.processes.pool: The semaphore was released twice for each task
(both at ACK and result ready).</p>
<blockquote>
<div><p>This has been fixed, and it is now released only once per task.</p>
</div></blockquote>
</li>
<li><p class="first">docs/configuration: Fixed typo <cite>CELERYD_SOFT_TASK_TIME_LIMIT</cite> -&gt;
<a class="reference internal" href="configuration.html#std:setting-CELERYD_TASK_SOFT_TIME_LIMIT"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_TASK_SOFT_TIME_LIMIT</span></tt></a>.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/214" title="Docs say &quot;CELERYD_SOFT_TASK_TIME_LIMIT&quot; but should be &quot;CELERYD_TASK_SOFT_TIME_LIMIT&quot;"><span class="xref issue closed">issue #214</span></a></p>
</div></blockquote>
</li>
<li><p class="first">control command <cite>dump_scheduled</cite>: was using old .info attribute</p>
</li>
<li><dl class="first docutils">
<dt><strong class="program">celeryd-multi</strong>: Fixed <cite>set changed size during iteration</cite> bug</dt>
<dd><p class="first last">occurring in the restart command.</p>
</dd>
</dl>
</li>
<li><p class="first">celeryd: Accidentally tried to use additional command line arguments.</p>
<blockquote>
<div><p>This would lead to an error like:</p>
<blockquote>
<div><p><cite>got multiple values for keyword argument &#8216;concurrency&#8217;</cite>.</p>
<p>Additional command line arguments are now ignored, and does not
produce this error.  However &#8211; we do reserve the right to use
positional arguments in the future, so please do not depend on this
behavior.</p>
</div></blockquote>
</div></blockquote>
</li>
<li><p class="first">celerybeat: Now respects routers and task execution options again.</p>
</li>
<li><p class="first">celerybeat: Now reuses the publisher instead of the connection.</p>
</li>
<li><p class="first">Cache result backend: Using <tt class="xref py py-class docutils literal"><span class="pre">float</span></tt> as the expires argument
to <cite>cache.set</cite> is deprecated by the memcached libraries,
so we now automatically cast to <tt class="xref py py-class docutils literal"><span class="pre">int</span></tt>.</p>
</li>
<li><p class="first">unit tests: No longer emits logging and warnings in test output.</p>
</li>
</ul>
</div>
<div class="section" id="v211-news">
<span id="id39"></span><h3><a class="toc-backref" href="#id139">News</a><a class="headerlink" href="#v211-news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Now depends on carrot version 0.10.7.</p>
</li>
<li><p class="first">Added <a class="reference internal" href="configuration.html#std:setting-CELERY_REDIRECT_STDOUTS"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_REDIRECT_STDOUTS</span></tt></a>, and
<tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_REDIRECT_STDOUTS_LEVEL</span></tt> settings.</p>
<blockquote>
<div><p><a class="reference internal" href="configuration.html#std:setting-CELERY_REDIRECT_STDOUTS"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_REDIRECT_STDOUTS</span></tt></a> is used by <strong class="program">celeryd</strong> and
<strong class="program">celerybeat</strong>.  All output to <cite>stdout</cite> and <cite>stderr</cite> will be
redirected to the current logger if enabled.</p>
<p><a class="reference internal" href="configuration.html#std:setting-CELERY_REDIRECT_STDOUTS_LEVEL"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_REDIRECT_STDOUTS_LEVEL</span></tt></a> decides the log level used and is
<tt class="xref py py-const docutils literal"><span class="pre">WARNING</span></tt> by default.</p>
</div></blockquote>
</li>
<li><p class="first">Added <a class="reference internal" href="configuration.html#std:setting-CELERYBEAT_SCHEDULER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYBEAT_SCHEDULER</span></tt></a> setting.</p>
<blockquote>
<div><p>This setting is used to define the default for the -S option to
<strong class="program">celerybeat</strong>.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERYBEAT_SCHEDULER</span> <span class="o">=</span> <span class="s">&quot;djcelery.schedulers.DatabaseScheduler&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Added Task.expires: Used to set default expiry time for tasks.</p>
</li>
<li><p class="first">New remote control commands: <cite>add_consumer</cite> and <cite>cancel_consumer</cite>.</p>
<blockquote>
<div><dl class="method">
<dt>
<tt class="descname">add_consumer(queue, exchange, exchange_type, routing_key,</tt></dt>
<dt>
<tt class="descname">**options)</tt></dt>
<dd><p>Tells the worker to declare and consume from the specified
declaration.</p>
</dd></dl>

<dl class="method">
<dt id="cancel_consumer">
<tt class="descname">cancel_consumer</tt><big>(</big><em>queue_name</em><big>)</big><a class="headerlink" href="#cancel_consumer" title="Permalink to this definition">¶</a></dt>
<dd><p>Tells the worker to stop consuming from queue (by queue name).</p>
</dd></dl>

<p>Commands also added to <strong class="program">celeryctl</strong> and
<tt class="xref py py-class docutils literal"><span class="pre">inspect</span></tt>.</p>
<p>Example using celeryctl to start consuming from queue &#8220;queue&#8221;, in
exchange &#8220;exchange&#8221;, of type &#8220;direct&#8221; using binding key &#8220;key&#8221;:</p>
<div class="highlight-python"><pre>$ celeryctl inspect add_consumer queue exchange direct key
$ celeryctl inspect cancel_consumer queue</pre>
</div>
<p>See <a class="reference internal" href="userguide/monitoring.html#monitoring-celeryctl"><em>celeryctl: Management Utility</em></a> for more information about the
<strong class="program">celeryctl</strong> program.</p>
<p>Another example using <tt class="xref py py-class docutils literal"><span class="pre">inspect</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task.control</span> <span class="kn">import</span> <span class="n">inspect</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">add_consumer</span><span class="p">(</span><span class="n">queue</span><span class="o">=</span><span class="s">&quot;queue&quot;</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="s">&quot;exchange&quot;</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">exchange_type</span><span class="o">=</span><span class="s">&quot;direct&quot;</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">routing_key</span><span class="o">=</span><span class="s">&quot;key&quot;</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">durable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">auto_delete</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="o">.</span><span class="n">cancel_consumer</span><span class="p">(</span><span class="s">&quot;queue&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">celerybeat: Now logs the traceback if a message can&#8217;t be sent.</p>
</li>
<li><p class="first">celerybeat: Now enables a default socket timeout of 30 seconds.</p>
</li>
<li><p class="first">README/introduction/homepage: Added link to <a class="reference external" href="http://github.com/ask/flask-celery">Flask-Celery</a>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="version-2-1-0">
<span id="id40"></span><h2><a class="toc-backref" href="#id140">2.1.0</a><a class="headerlink" href="#version-2-1-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-10-08 12:00 P.M CEST</td>
</tr>
</tbody>
</table>
<div class="section" id="v210-important">
<span id="id41"></span><h3><a class="toc-backref" href="#id141">Important Notes</a><a class="headerlink" href="#v210-important" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Celery is now following the versioning semantics defined by <a class="reference external" href="http://semver.org">semver</a>.</p>
<blockquote>
<div><p>This means we are no longer allowed to use odd/even versioning semantics
By our previous versioning scheme this stable release should have
been version 2.2.</p>
</div></blockquote>
</li>
</ul>
<ul>
<li><p class="first">Now depends on Carrot 0.10.7.</p>
</li>
<li><p class="first">No longer depends on SQLAlchemy, this needs to be installed separately
if the database result backend is used.</p>
</li>
<li><p class="first">django-celery now comes with a monitor for the Django Admin interface.
This can also be used if you&#8217;re not a Django user.  See
<a class="reference internal" href="userguide/monitoring.html#monitoring-django-admin"><em>Django Admin Monitor</em></a> and <a class="reference internal" href="userguide/monitoring.html#monitoring-nodjango"><em>Using outside of Django</em></a> for more information.</p>
</li>
<li><p class="first">If you get an error after upgrading saying:
<cite>AttributeError: &#8216;module&#8217; object has no attribute &#8216;system&#8217;</cite>,</p>
<blockquote>
<div><p>Then this is because the <cite>celery.platform</cite> module has been
renamed to <cite>celery.platforms</cite> to not collide with the built-in
<tt class="xref py py-mod docutils literal"><span class="pre">platform</span></tt> module.</p>
<p>You have to remove the old <tt class="file docutils literal"><span class="pre">platform.py</span></tt> (and maybe
<tt class="file docutils literal"><span class="pre">platform.pyc</span></tt>) file from your previous Celery installation.</p>
<p>To do this use <strong class="program">python</strong> to find the location
of this module:</p>
<div class="highlight-python"><pre>$ python
&gt;&gt;&gt; import celery.platform
&gt;&gt;&gt; celery.platform
&lt;module 'celery.platform' from '/opt/devel/celery/celery/platform.pyc'&gt;</pre>
</div>
<p>Here the compiled module is in <tt class="file docutils literal"><span class="pre">/opt/devel/celery/celery/</span></tt>,
to remove the offending files do:</p>
<div class="highlight-python"><pre>$ rm -f /opt/devel/celery/celery/platform.py*</pre>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="v210-news">
<span id="id42"></span><h3><a class="toc-backref" href="#id142">News</a><a class="headerlink" href="#v210-news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Added support for expiration of AMQP results (requires RabbitMQ 2.1.0)</p>
<blockquote>
<div><p>The new configuration option <a class="reference internal" href="configuration.html#std:setting-CELERY_AMQP_TASK_RESULT_EXPIRES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_AMQP_TASK_RESULT_EXPIRES</span></tt></a>
sets the expiry time in seconds (can be int or float):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_AMQP_TASK_RESULT_EXPIRES</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c"># 30 minutes.</span>
<span class="n">CELERY_AMQP_TASK_RESULT_EXPIRES</span> <span class="o">=</span> <span class="mf">0.80</span>     <span class="c"># 800 ms.</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">celeryev: Event Snapshots</p>
<blockquote>
<div><p>If enabled, <strong class="program">celeryd</strong> sends messages about what the worker is doing.
These messages are called &#8220;events&#8221;.
The events are used by real-time monitors to show what the
cluster is doing, but they are not very useful for monitoring
over a longer period of time.  Snapshots
lets you take &#8220;pictures&#8221; of the clusters state at regular intervals.
This can then be stored in a database to generate statistics
with, or even monitoring over longer time periods.</p>
<p>django-celery now comes with a Celery monitor for the Django
Admin interface. To use this you need to run the django-celery
snapshot camera, which stores snapshots to the database at configurable
intervals.  See <a class="reference internal" href="userguide/monitoring.html#monitoring-nodjango"><em>Using outside of Django</em></a> for information about using
this monitor if you&#8217;re not using Django.</p>
<p>To use the Django admin monitor you need to do the following:</p>
<ol class="arabic">
<li><p class="first">Create the new database tables.</p>
<blockquote>
<div><p>$ python manage.py syncdb</p>
</div></blockquote>
</li>
<li><p class="first">Start the django-celery snapshot camera:</p>
<div class="highlight-python"><pre>$ python manage.py celerycam</pre>
</div>
</li>
<li><p class="first">Open up the django admin to monitor your cluster.</p>
</li>
</ol>
<p>The admin interface shows tasks, worker nodes, and even
lets you perform some actions, like revoking and rate limiting tasks,
and shutting down worker nodes.</p>
<p>There&#8217;s also a Debian init.d script for <a class="reference internal" href="reference/celery.bin.celeryev.html#module-celery.bin.celeryev" title="celery.bin.celeryev"><tt class="xref py py-mod docutils literal"><span class="pre">celeryev</span></tt></a> available,
see <a class="reference internal" href="cookbook/daemonizing.html"><em>Running celeryd as a daemon</em></a> for more information.</p>
<p>New command line arguments to celeryev:</p>
<blockquote>
<div><ul class="simple">
<li><em class="xref std std-option">-c|--camera</em>: Snapshot camera class to use.</li>
<li><em class="xref std std-option">--logfile|-f</em>: Log file</li>
<li><em class="xref std std-option">--loglevel|-l</em>: Log level</li>
<li><em class="xref std std-option">--maxrate|-r</em>: Shutter rate limit.</li>
<li><em class="xref std std-option">--freq|-F</em>: Shutter frequency</li>
</ul>
</div></blockquote>
<p>The <em class="xref std std-option">--camera</em> argument is the name of a class used to take
snapshots with. It must support the interface defined by
<a class="reference internal" href="internals/reference/celery.events.snapshot.html#celery.events.snapshot.Polaroid" title="celery.events.snapshot.Polaroid"><tt class="xref py py-class docutils literal"><span class="pre">celery.events.snapshot.Polaroid</span></tt></a>.</p>
<p>Shutter frequency controls how often the camera thread wakes up,
while the rate limit controls how often it will actually take
a snapshot.
The rate limit can be an integer (snapshots/s), or a rate limit string
which has the same syntax as the task rate limit strings (<cite>&#8220;200/m&#8221;</cite>,
<cite>&#8220;10/s&#8221;</cite>, <cite>&#8220;1/h&#8221;,</cite> etc).</p>
<p>For the Django camera case, this rate limit can be used to control
how often the snapshots are written to the database, and the frequency
used to control how often the thread wakes up to check if there&#8217;s
anything new.</p>
<p>The rate limit is off by default, which means it will take a snapshot
for every <em class="xref std std-option">--frequency</em> seconds.</p>
</div></blockquote>
</li>
</ul>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="userguide/monitoring.html#monitoring-django-admin"><em>Django Admin Monitor</em></a> and <a class="reference internal" href="userguide/monitoring.html#monitoring-snapshots"><em>Snapshots</em></a>.</p>
</div>
<ul>
<li><p class="first"><tt class="xref py py-func docutils literal"><span class="pre">broadcast()</span></tt>: Added callback argument, this can be
used to process replies immediately as they arrive.</p>
</li>
<li><p class="first">celeryctl: New command-line utility to manage and inspect worker nodes,
apply tasks and inspect the results of tasks.</p>
<blockquote>
<div><div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">The <a class="reference internal" href="userguide/monitoring.html#monitoring-celeryctl"><em>celeryctl: Management Utility</em></a> section in the <a class="reference internal" href="userguide/index.html#guide"><em>User Guide</em></a>.</p>
</div>
<p>Some examples:</p>
<div class="highlight-python"><pre>$ celeryctl apply tasks.add -a '[2, 2]' --countdown=10

$ celeryctl inspect active
$ celeryctl inspect registered_tasks
$ celeryctl inspect scheduled
$ celeryctl inspect --help
$ celeryctl apply --help</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Added the ability to set an expiry date and time for tasks.</p>
<blockquote>
<div><p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Task expires after one minute from now.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">task</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">expires</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Also supports datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">task</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span>
<span class="gp">... </span>                 <span class="n">expires</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>When a worker receives a task that has been expired it will be
marked as revoked (<a class="reference internal" href="reference/celery.exceptions.html#celery.exceptions.TaskRevokedError" title="celery.exceptions.TaskRevokedError"><tt class="xref py py-exc docutils literal"><span class="pre">celery.exceptions.TaskRevokedError</span></tt></a>).</p>
</div></blockquote>
</li>
<li><p class="first">Changed the way logging is configured.</p>
<blockquote>
<div><p>We now configure the root logger instead of only configuring
our custom logger. In addition we don&#8217;t hijack
the multiprocessing logger anymore, but instead use a custom logger name
for different applications:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><p class="first last"><strong>Application</strong></p>
</th>
<th class="head"><p class="first last"><strong>Logger Name</strong></p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><p class="first last"><cite>celeryd</cite></p>
</td>
<td><p class="first last">&#8220;celery&#8221;</p>
</td>
</tr>
<tr><td><p class="first last"><cite>celerybeat</cite></p>
</td>
<td><p class="first last">&#8220;celery.beat&#8221;</p>
</td>
</tr>
<tr><td><p class="first last"><cite>celeryev</cite></p>
</td>
<td><p class="first last">&#8220;celery.ev&#8221;</p>
</td>
</tr>
</tbody>
</table>
<p>This means that the <cite>loglevel</cite> and <cite>logfile</cite> arguments will
affect all registered loggers (even those from 3rd party libraries).
Unless you configure the loggers manually as shown below, that is.</p>
<p><em>Users can choose to configure logging by subscribing to the
:signal:`~celery.signals.setup_logging` signal:</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">logging.config</span> <span class="kn">import</span> <span class="n">fileConfig</span>
<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">signals</span>

<span class="k">def</span> <span class="nf">setup_logging</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">fileConfig</span><span class="p">(</span><span class="s">&quot;logging.conf&quot;</span><span class="p">)</span>
<span class="n">signals</span><span class="o">.</span><span class="n">setup_logging</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">setup_logging</span><span class="p">)</span>
</pre></div>
</div>
<p>If there are no receivers for this signal, the logging subsystem
will be configured using the <em class="xref std std-option">--loglevel</em>/<em class="xref std std-option">--logfile</em>
argument, this will be used for <em>all defined loggers</em>.</p>
<p>Remember that celeryd also redirects stdout and stderr
to the celery logger, if manually configure logging
you also need to redirect the stdouts manually:</p>
<div class="highlight-python"><pre> from logging.config import fileConfig
 from celery import log

def setup_logging(**kwargs):
     import logging
     fileConfig("logging.conf")
     stdouts = logging.getLogger("mystdoutslogger")
     log.redirect_stdouts_to_logger(stdouts, loglevel=logging.WARNING)</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">celeryd: Added command-line option <em class="xref std std-option">-I</em>/<em class="xref std std-option">--include</em>:</p>
<blockquote>
<div><p>A comma separated list of (task) modules to be imported.</p>
<p>Example:</p>
<div class="highlight-python"><pre>$ celeryd -I app1.tasks,app2.tasks</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">celeryd: now emits a warning if running as the root user (euid is 0).</p>
</li>
<li><p class="first"><tt class="xref py py-func docutils literal"><span class="pre">celery.messaging.establish_connection()</span></tt>: Ability to override defaults
used using keyword argument &#8220;defaults&#8221;.</p>
</li>
<li><p class="first">celeryd: Now uses <cite>multiprocessing.freeze_support()</cite> so that it should work
with <strong>py2exe</strong>, <strong>PyInstaller</strong>, <strong>cx_Freeze</strong>, etc.</p>
</li>
<li><p class="first">celeryd: Now includes more metadata for the <a class="reference internal" href="userguide/tasks.html#std:state-STARTED"><tt class="xref std std-state docutils literal"><span class="pre">STARTED</span></tt></a> state: PID and
host name of the worker that started the task.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/181" title="no way to tell which worker picked up a task"><span class="xref issue closed">issue #181</span></a></p>
</div></blockquote>
</li>
<li><p class="first">subtask: Merge additional keyword arguments to <cite>subtask()</cite> into task keyword
arguments.</p>
<blockquote>
<div><p>e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">subtask</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">{</span><span class="s">&quot;foo&quot;</span><span class="p">:</span> <span class="s">&quot;bar&quot;</span><span class="p">},</span> <span class="n">baz</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">args</span>
<span class="go">(1, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">kwargs</span>
<span class="go">{&quot;foo&quot;: &quot;bar&quot;, &quot;baz&quot;: 1}</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/ask/celery/issues/182" title="callback argument ignored by subtask"><span class="xref issue closed">issue #182</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">celeryd: Now emits a warning if there is already a worker node using the same
name running on the same virtual host.</p>
</li>
<li><p class="first">AMQP result backend: Sending of results are now retried if the connection
is down.</p>
</li>
<li><dl class="first docutils">
<dt>AMQP result backend: <cite>result.get()</cite>: Wait for next state if state is not</dt>
<dd><p class="first last">in <tt class="xref py py-data docutils literal"><span class="pre">READY_STATES</span></tt>.</p>
</dd>
</dl>
</li>
<li><p class="first">TaskSetResult now supports subscription.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">TaskSet</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span><span class="o">.</span><span class="n">apply_async</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Added <cite>Task.send_error_emails</cite> + <cite>Task.error_whitelist</cite>, so these can
be configured per task instead of just by the global setting.</p>
</li>
<li><p class="first">Added <cite>Task.store_errors_even_if_ignored</cite>, so it can be changed per Task,
not just by the global setting.</p>
</li>
<li><p class="first">The crontab scheduler no longer wakes up every second, but implements
<cite>remaining_estimate</cite> (<em>Optimization</em>).</p>
</li>
<li><dl class="first docutils">
<dt>celeryd:  Store <a class="reference internal" href="userguide/tasks.html#std:state-FAILURE"><tt class="xref std std-state docutils literal"><span class="pre">FAILURE</span></tt></a> result if the</dt>
<dd><p class="first last"><a class="reference internal" href="reference/celery.exceptions.html#celery.exceptions.WorkerLostError" title="celery.exceptions.WorkerLostError"><tt class="xref py py-exc docutils literal"><span class="pre">WorkerLostError</span></tt></a> exception occurs (worker process
disappeared).</p>
</dd>
</dl>
</li>
<li><p class="first">celeryd: Store <a class="reference internal" href="userguide/tasks.html#std:state-FAILURE"><tt class="xref std std-state docutils literal"><span class="pre">FAILURE</span></tt></a> result if one of the <cite>*TimeLimitExceeded</cite>
exceptions occurs.</p>
</li>
<li><p class="first">Refactored the periodic task responsible for cleaning up results.</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>The backend cleanup task is now only added to the schedule if</dt>
<dd><p class="first last"><a class="reference internal" href="configuration.html#std:setting-CELERY_TASK_RESULT_EXPIRES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_RESULT_EXPIRES</span></tt></a> is set.</p>
</dd>
</dl>
</li>
<li><p class="first">If the schedule already contains a periodic task named
&#8220;celery.backend_cleanup&#8221; it won&#8217;t change it, so the behavior of the
backend cleanup task can be easily changed.</p>
</li>
<li><p class="first">The task is now run every day at 4:00 AM, rather than every day since
the first time it was run (using crontab schedule instead of
<cite>run_every</cite>)</p>
</li>
<li><dl class="first docutils">
<dt>Renamed <cite>celery.task.builtins.DeleteExpiredTaskMetaTask</cite></dt>
<dd><p class="first last">-&gt; <tt class="xref py py-class docutils literal"><span class="pre">celery.task.builtins.backend_cleanup</span></tt></p>
</dd>
</dl>
</li>
<li><p class="first">The task itself has been renamed from &#8220;celery.delete_expired_task_meta&#8221;
to &#8220;celery.backend_cleanup&#8221;</p>
</li>
</ul>
<p>See <a class="reference external" href="https://github.com/ask/celery/issues/134" title="Need a config flag that allows disabling the builtin tasks"><span class="xref issue closed">issue #134</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Implemented <cite>AsyncResult.forget</cite> for sqla/cache/redis/tyrant backends.
(Forget and remove task result).</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/184" title="&quot;Discard task result&quot; operation"><span class="xref issue closed">issue #184</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first"><tt class="xref py py-meth docutils literal"><span class="pre">TaskSetResult.join</span></tt>:
Added &#8216;propagate=True&#8217; argument.</p>
<p>When set to <tt class="xref py py-const xref docutils literal"><span class="pre">False</span></tt> exceptions occurring in subtasks will
not be re-raised.</p>
</li>
<li><p class="first">Added <cite>Task.update_state(task_id, state, meta)</cite>
as a shortcut to <cite>task.backend.store_result(task_id, meta, state)</cite>.</p>
<blockquote>
<div><p>The backend interface is &#8220;private&#8221; and the terminology outdated,
so better to move this to <tt class="xref py py-class docutils literal"><span class="pre">Task</span></tt> so it can be
used.</p>
</div></blockquote>
</li>
<li><p class="first">timer2: Set <cite>self.running=False</cite> in
<a class="reference internal" href="internals/reference/celery.utils.timer2.html#celery.utils.timer2.Timer.stop" title="celery.utils.timer2.Timer.stop"><tt class="xref py py-meth docutils literal"><span class="pre">stop()</span></tt></a> so it won&#8217;t try to join again on
subsequent calls to <cite>stop()</cite>.</p>
</li>
<li><p class="first">Log colors are now disabled by default on Windows.</p>
</li>
<li><p class="first"><cite>celery.platform</cite> renamed to <a class="reference internal" href="internals/reference/celery.platforms.html#module-celery.platforms" title="celery.platforms"><tt class="xref py py-mod docutils literal"><span class="pre">celery.platforms</span></tt></a>, so it doesn&#8217;t
collide with the built-in <tt class="xref py py-mod docutils literal"><span class="pre">platform</span></tt> module.</p>
</li>
<li><p class="first">Exceptions occurring in Mediator+Pool callbacks are now caught and logged
instead of taking down the worker.</p>
</li>
<li><p class="first">Redis result backend: Now supports result expiration using the Redis
<cite>EXPIRE</cite> command.</p>
</li>
<li><p class="first">unit tests: Don&#8217;t leave threads running at tear down.</p>
</li>
<li><p class="first">celeryd: Task results shown in logs are now truncated to 46 chars.</p>
</li>
<li><dl class="first docutils">
<dt><cite>Task.__name__</cite> is now an alias to <cite>self.__class__.__name__</cite>.</dt>
<dd><p class="first last">This way tasks introspects more like regular functions.</p>
</dd>
</dl>
</li>
<li><p class="first"><cite>Task.retry</cite>: Now raises <tt class="xref py py-exc docutils literal"><span class="pre">TypeError</span></tt> if kwargs argument is empty.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/164" title="retry does not work without kwargs explicitly passed"><span class="xref issue closed">issue #164</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">timedelta_seconds: Use <cite>timedelta.total_seconds</cite> if running on Python 2.7</p>
</li>
<li><p class="first"><a class="reference internal" href="internals/reference/celery.datastructures.html#celery.datastructures.TokenBucket" title="celery.datastructures.TokenBucket"><tt class="xref py py-class docutils literal"><span class="pre">TokenBucket</span></tt></a>: Generic Token Bucket algorithm</p>
</li>
<li><p class="first"><a class="reference internal" href="reference/celery.events.state.html#module-celery.events.state" title="celery.events.state"><tt class="xref py py-mod docutils literal"><span class="pre">celery.events.state</span></tt></a>: Recording of cluster state can now
be paused and resumed, including support for buffering.</p>
<blockquote>
<div><dl class="method">
<dt id="State.freeze">
<tt class="descclassname">State.</tt><tt class="descname">freeze</tt><big>(</big><em>buffer=True</em><big>)</big><a class="headerlink" href="#State.freeze" title="Permalink to this definition">¶</a></dt>
<dd><p>Pauses recording of the stream.</p>
<p>If <cite>buffer</cite> is true, events received while being frozen will be
buffered, and may be replayed later.</p>
</dd></dl>

<dl class="method">
<dt id="State.thaw">
<tt class="descclassname">State.</tt><tt class="descname">thaw</tt><big>(</big><em>replay=True</em><big>)</big><a class="headerlink" href="#State.thaw" title="Permalink to this definition">¶</a></dt>
<dd><p>Resumes recording of the stream.</p>
<p>If <cite>replay</cite> is true, then the recorded buffer will be applied.</p>
</dd></dl>

<dl class="method">
<dt id="State.freeze_while">
<tt class="descclassname">State.</tt><tt class="descname">freeze_while</tt><big>(</big><em>fun</em><big>)</big><a class="headerlink" href="#State.freeze_while" title="Permalink to this definition">¶</a></dt>
<dd><p>With a function to apply, freezes the stream before,
and replays the buffer after the function returns.</p>
</dd></dl>

</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="reference/celery.events.html#celery.events.EventReceiver.capture" title="celery.events.EventReceiver.capture"><tt class="xref py py-meth docutils literal"><span class="pre">EventReceiver.capture</span></tt></a>
Now supports a timeout keyword argument.</p>
</li>
<li><p class="first">celeryd: The mediator thread is now disabled if
<tt class="xref std std-setting docutils literal"><span class="pre">CELERY_RATE_LIMITS</span></tt> is enabled, and tasks are directly sent to the
pool without going through the ready queue (<em>Optimization</em>).</p>
</li>
</ul>
</div>
<div class="section" id="v210-fixes">
<span id="id43"></span><h3><a class="toc-backref" href="#id143">Fixes</a><a class="headerlink" href="#v210-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Pool: Process timed out by <cite>TimeoutHandler</cite> must be joined by the Supervisor,
so don&#8217;t remove it from the internal process list.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/192" title="Currently having zombie processes on Celery master branch (like one a week)"><span class="xref issue closed">issue #192</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first"><cite>TaskPublisher.delay_task</cite> now supports exchange argument, so exchange can be
overridden when sending tasks in bulk using the same publisher</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/187" title="Using publisher with a different queue does not respond"><span class="xref issue closed">issue #187</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">celeryd no longer marks tasks as revoked if <a class="reference internal" href="configuration.html#std:setting-CELERY_IGNORE_RESULT"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_IGNORE_RESULT</span></tt></a>
is enabled.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/207" title="TaskRevokedError Exceptions stored to queue even when CELERY_IGNORE_RESULT=True"><span class="xref issue closed">issue #207</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">AMQP Result backend: Fixed bug with <cite>result.get()</cite> if
<a class="reference internal" href="configuration.html#std:setting-CELERY_TRACK_STARTED"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TRACK_STARTED</span></tt></a> enabled.</p>
<blockquote>
<div><p><cite>result.get()</cite> would stop consuming after receiving the
<a class="reference internal" href="userguide/tasks.html#std:state-STARTED"><tt class="xref std std-state docutils literal"><span class="pre">STARTED</span></tt></a> state.</p>
</div></blockquote>
</li>
<li><p class="first">Fixed bug where new processes created by the pool supervisor becomes stuck
while reading from the task Queue.</p>
<blockquote>
<div><p>See <a class="reference external" href="http://bugs.python.org/issue10037">http://bugs.python.org/issue10037</a></p>
</div></blockquote>
</li>
<li><p class="first">Fixed timing issue when declaring the remote control command reply queue</p>
<blockquote>
<div><p>This issue could result in replies being lost, but have now been fixed.</p>
</div></blockquote>
</li>
<li><p class="first">Backward compatible <cite>LoggerAdapter</cite> implementation: Now works for Python 2.4.</p>
<blockquote>
<div><p>Also added support for several new methods:
<cite>fatal</cite>, <cite>makeRecord</cite>, <cite>_log</cite>, <cite>log</cite>, <cite>isEnabledFor</cite>,
<cite>addHandler</cite>, <cite>removeHandler</cite>.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="v210-experimental">
<span id="id44"></span><h3><a class="toc-backref" href="#id144">Experimental</a><a class="headerlink" href="#v210-experimental" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">celeryd-multi: Added daemonization support.</p>
<blockquote>
<div><p>celeryd-multi can now be used to start, stop and restart worker nodes.</p>
<blockquote>
<div><p>$ celeryd-multi start jerry elaine george kramer</p>
</div></blockquote>
<p>This also creates PID files and log files (<tt class="file docutils literal"><span class="pre">celeryd&#64;jerry.pid</span></tt>,
..., <tt class="file docutils literal"><span class="pre">celeryd&#64;jerry.log</span></tt>. To specify a location for these files
use the <cite>&#8211;pidfile</cite> and <cite>&#8211;logfile</cite> arguments with the <cite>%n</cite>
format:</p>
<div class="highlight-python"><pre>$ celeryd-multi start jerry elaine george kramer \
                --logfile=/var/log/celeryd@%n.log \
                --pidfile=/var/run/celeryd@%n.pid</pre>
</div>
<p>Stopping:</p>
<div class="highlight-python"><pre>$ celeryd-multi stop jerry elaine george kramer</pre>
</div>
<p>Restarting. The nodes will be restarted one by one as the old ones
are shutdown:</p>
<div class="highlight-python"><pre>$ celeryd-multi restart jerry elaine george kramer</pre>
</div>
<p>Killing the nodes (<strong>WARNING</strong>: Will discard currently executing tasks):</p>
<div class="highlight-python"><pre>$ celeryd-multi kill jerry elaine george kramer</pre>
</div>
<p>See <cite>celeryd-multi help</cite> for help.</p>
</div></blockquote>
</li>
<li><p class="first">celeryd-multi: <cite>start</cite> command renamed to <cite>show</cite>.</p>
<blockquote>
<div><p><cite>celeryd-multi start</cite> will now actually start and detach worker nodes.
To just generate the commands you have to use <cite>celeryd-multi show</cite>.</p>
</div></blockquote>
</li>
<li><p class="first">celeryd: Added <cite>&#8211;pidfile</cite> argument.</p>
<blockquote>
<div><p>The worker will write its pid when it starts.  The worker will
not be started if this file exists and the pid contained is still alive.</p>
</div></blockquote>
</li>
<li><p class="first">Added generic init.d script using <cite>celeryd-multi</cite></p>
<blockquote>
<div><p><a class="reference external" href="http://github.com/ask/celery/tree/master/contrib/generic-init.d/celeryd">http://github.com/ask/celery/tree/master/contrib/generic-init.d/celeryd</a></p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="v210-documentation">
<span id="id45"></span><h3><a class="toc-backref" href="#id145">Documentation</a><a class="headerlink" href="#v210-documentation" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Added User guide section: Monitoring</p>
</li>
<li><p class="first">Added user guide section: Periodic Tasks</p>
<blockquote>
<div><p>Moved from <cite>getting-started/periodic-tasks</cite> and updated.</p>
</div></blockquote>
</li>
<li><p class="first">tutorials/external moved to new section: &#8220;community&#8221;.</p>
</li>
<li><p class="first">References has been added to all sections in the documentation.</p>
<blockquote>
<div><p>This makes it easier to link between documents.</p>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="version-2-0-3">
<span id="id46"></span><h2><a class="toc-backref" href="#id146">2.0.3</a><a class="headerlink" href="#version-2-0-3" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-08-27 12:00 P.M CEST</td>
</tr>
</tbody>
</table>
<div class="section" id="v203-fixes">
<span id="id47"></span><h3><a class="toc-backref" href="#id147">Fixes</a><a class="headerlink" href="#v203-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">celeryd: Properly handle connection errors happening while
closing consumers.</p>
</li>
<li><p class="first">celeryd: Events are now buffered if the connection is down,
then sent when the connection is re-established.</p>
</li>
<li><p class="first">No longer depends on the <tt class="xref py py-mod docutils literal"><span class="pre">mailer</span></tt> package.</p>
<blockquote>
<div><p>This package had a name space collision with <cite>django-mailer</cite>,
so its functionality was replaced.</p>
</div></blockquote>
</li>
<li><p class="first">Redis result backend: Documentation typos: Redis doesn&#8217;t have
database names, but database numbers. The default database is now 0.</p>
</li>
<li><p class="first"><tt class="xref py py-class docutils literal"><span class="pre">inspect</span></tt>:
<cite>registered_tasks</cite> was requesting an invalid command because of a typo.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/170" title="task.control.inspect.registered_task is broken"><span class="xref issue closed">issue #170</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="configuration.html#std:setting-CELERY_ROUTES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_ROUTES</span></tt></a>: Values defined in the route should now have
precedence over values defined in <a class="reference internal" href="configuration.html#std:setting-CELERY_QUEUES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_QUEUES</span></tt></a> when merging
the two.</p>
<blockquote>
<div><p>With the follow settings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_QUEUES</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;cpubound&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;exchange&quot;</span><span class="p">:</span> <span class="s">&quot;cpubound&quot;</span><span class="p">,</span>
                              <span class="s">&quot;routing_key&quot;</span><span class="p">:</span> <span class="s">&quot;cpubound&quot;</span><span class="p">}}</span>

<span class="n">CELERY_ROUTES</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;tasks.add&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;queue&quot;</span><span class="p">:</span> <span class="s">&quot;cpubound&quot;</span><span class="p">,</span>
                               <span class="s">&quot;routing_key&quot;</span><span class="p">:</span> <span class="s">&quot;tasks.add&quot;</span><span class="p">,</span>
                               <span class="s">&quot;serializer&quot;</span><span class="p">:</span> <span class="s">&quot;json&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<p>The final routing options for <cite>tasks.add</cite> will become:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;exchange&quot;</span><span class="p">:</span> <span class="s">&quot;cpubound&quot;</span><span class="p">,</span>
 <span class="s">&quot;routing_key&quot;</span><span class="p">:</span> <span class="s">&quot;tasks.add&quot;</span><span class="p">,</span>
 <span class="s">&quot;serializer&quot;</span><span class="p">:</span> <span class="s">&quot;json&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>This was not the case before: the values
in <a class="reference internal" href="configuration.html#std:setting-CELERY_QUEUES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_QUEUES</span></tt></a> would take precedence.</p>
</div></blockquote>
</li>
<li><p class="first">Worker crashed if the value of <a class="reference internal" href="configuration.html#std:setting-CELERY_TASK_ERROR_WHITELIST"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_ERROR_WHITELIST</span></tt></a> was
not an iterable</p>
</li>
<li><p class="first"><tt class="xref py py-func docutils literal"><span class="pre">apply()</span></tt>: Make sure <cite>kwargs[&#8220;task_id&#8221;]</cite> is
always set.</p>
</li>
<li><p class="first"><cite>AsyncResult.traceback</cite>: Now returns <tt class="xref py py-const xref docutils literal"><span class="pre">None</span></tt>, instead of raising
<tt class="xref py py-exc docutils literal"><span class="pre">KeyError</span></tt> if traceback is missing.</p>
</li>
<li><p class="first"><tt class="xref py py-class docutils literal"><span class="pre">inspect</span></tt>: Replies did not work correctly
if no destination was specified.</p>
</li>
<li><p class="first">Can now store result/metadata for custom states.</p>
</li>
<li><p class="first">celeryd: A warning is now emitted if the sending of task error
emails fails.</p>
</li>
<li><p class="first">celeryev: Curses monitor no longer crashes if the terminal window
is resized.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/160" title="celeryev crashes when terminal is resized"><span class="xref issue closed">issue #160</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">celeryd: On OS X it is not possible to run <cite>os.exec*</cite> in a process
that is threaded.</p>
<blockquote>
<div><blockquote>
<div><p>This breaks the SIGHUP restart handler,
and is now disabled on OS X, emitting a warning instead.</p>
</div></blockquote>
<p>See <a class="reference external" href="https://github.com/ask/celery/issues/152" title="kill -HUP leaves worker running but defunct, with &quot;OSError: [Errno 45] Operation not supported&quot;"><span class="xref issue closed">issue #152</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="internals/reference/celery.execute.trace.html#module-celery.execute.trace" title="celery.execute.trace"><tt class="xref py py-mod docutils literal"><span class="pre">celery.execute.trace</span></tt></a>: Properly handle <cite>raise(str)</cite>,
which is still allowed in Python 2.4.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/175" title="py2.4: raise &quot;string&quot; kills worker processes"><span class="xref issue closed">issue #175</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Using urllib2 in a periodic task on OS X crashed because
of the proxy auto detection used in OS X.</p>
<blockquote>
<div><p>This is now fixed by using a workaround.
See <a class="reference external" href="https://github.com/ask/celery/issues/143" title="test_cleanup fails"><span class="xref issue closed">issue #143</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Debian init scripts: Commands should not run in a sub shell</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/163" title="Debian initscript: $cmd should not be run in subshell"><span class="xref issue closed">issue #163</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Debian init scripts: Use the absolute path of celeryd to allow stat</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/162" title="Default debian init script won't run on Lenny"><span class="xref issue closed">issue #162</span></a>.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="v203-documentation">
<span id="id48"></span><h3><a class="toc-backref" href="#id148">Documentation</a><a class="headerlink" href="#v203-documentation" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">getting-started/broker-installation: Fixed typo</p>
<blockquote>
<div><p><cite>set_permissions &#8220;&#8221;</cite> -&gt; <cite>set_permissions &#8221;.*&#8221;</cite>.</p>
</div></blockquote>
</li>
<li><p class="first">Tasks User Guide: Added section on database transactions.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/169" title="Documentation issues"><span class="xref issue closed">issue #169</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Routing User Guide: Fixed typo <cite>&#8220;feed&#8221;: -&gt; {&#8220;queue&#8221;: &#8220;feeds&#8221;}</cite>.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/169" title="Documentation issues"><span class="xref issue closed">issue #169</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Documented the default values for the <a class="reference internal" href="configuration.html#std:setting-CELERYD_CONCURRENCY"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_CONCURRENCY</span></tt></a>
and <a class="reference internal" href="configuration.html#std:setting-CELERYD_PREFETCH_MULTIPLIER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_PREFETCH_MULTIPLIER</span></tt></a> settings.</p>
</li>
<li><p class="first">Tasks User Guide: Fixed typos in the subtask example</p>
</li>
<li><p class="first">celery.signals: Documented worker_process_init.</p>
</li>
<li><p class="first">Daemonization cookbook: Need to export DJANGO_SETTINGS_MODULE in
<cite>/etc/default/celeryd</cite>.</p>
</li>
<li><p class="first">Added some more FAQs from stack overflow</p>
</li>
<li><p class="first">Daemonization cookbook: Fixed typo <cite>CELERYD_LOGFILE/CELERYD_PIDFILE</cite></p>
<blockquote>
<div><p>to <cite>CELERYD_LOG_FILE</cite> / <cite>CELERYD_PID_FILE</cite></p>
<p>Also added troubleshooting section for the init scripts.</p>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="version-2-0-2">
<span id="id49"></span><h2><a class="toc-backref" href="#id149">2.0.2</a><a class="headerlink" href="#version-2-0-2" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-07-22 11:31 A.M CEST</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">Routes: When using the dict route syntax, the exchange for a task
could disappear making the task unroutable.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/158" title="Only the first delayed task is sent when overriding queue/routes."><span class="xref issue closed">issue #158</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Test suite now passing on Python 2.4</p>
</li>
<li><p class="first">No longer have to type <cite>PYTHONPATH=.</cite> to use celeryconfig in the current
directory.</p>
<blockquote>
<div><p>This is accomplished by the default loader ensuring that the current
directory is in <cite>sys.path</cite> when loading the config module.
<cite>sys.path</cite> is reset to its original state after loading.</p>
<p>Adding the current working directory to <cite>sys.path</cite> without the user
knowing may be a security issue, as this means someone can drop a Python module in the users
directory that executes arbitrary commands. This was the original reason
not to do this, but if done <em>only when loading the config module</em>, this
means that the behavior will only apply to the modules imported in the
config module, which I think is a good compromise (certainly better than
just explicitly setting <cite>PYTHONPATH=.</cite> anyway)</p>
</div></blockquote>
</li>
<li><p class="first">Experimental Cassandra backend added.</p>
</li>
<li><p class="first">celeryd: SIGHUP handler accidentally propagated to worker pool processes.</p>
<blockquote>
<div><p>In combination with 7a7c44e39344789f11b5346e9cc8340f5fe4846c
this would make each child process start a new celeryd when
the terminal window was closed :/</p>
</div></blockquote>
</li>
<li><p class="first">celeryd: Do not install SIGHUP handler if running from a terminal.</p>
<blockquote>
<div><p>This fixes the problem where celeryd is launched in the background
when closing the terminal.</p>
</div></blockquote>
</li>
<li><p class="first">celeryd: Now joins threads at shutdown.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/152" title="kill -HUP leaves worker running but defunct, with &quot;OSError: [Errno 45] Operation not supported&quot;"><span class="xref issue closed">issue #152</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Test tear down: Don&#8217;t use <cite>atexit</cite> but nose&#8217;s <cite>teardown()</cite> functionality
instead.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/154" title="Errors after python setup.py test: “Parent module 'celery.tests' not loaded”"><span class="xref issue closed">issue #154</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Debian init script for celeryd: Stop now works correctly.</p>
</li>
<li><p class="first">Task logger: <cite>warn</cite> method added (synonym for <cite>warning</cite>)</p>
</li>
<li><p class="first">Can now define a white list of errors to send error emails for.</p>
<blockquote>
<div><p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_TASK_ERROR_WHITELIST</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;myapp.MalformedInputError&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/ask/celery/issues/153" title="CELERY_SEND_TASK_ERROR_EMAILS exception whitelist"><span class="xref issue closed">issue #153</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">celeryd: Now handles overflow exceptions in <cite>time.mktime</cite> while parsing
the ETA field.</p>
</li>
<li><p class="first">LoggerWrapper: Try to detect loggers logging back to stderr/stdout making
an infinite loop.</p>
</li>
<li><p class="first">Added <tt class="xref py py-class docutils literal"><span class="pre">celery.task.control.inspect</span></tt>: Inspects a running worker.</p>
<blockquote>
<div><p>Examples:</p>
<div class="highlight-python"><pre># Inspect a single worker
&gt;&gt;&gt; i = inspect("myworker.example.com")

# Inspect several workers
&gt;&gt;&gt; i = inspect(["myworker.example.com", "myworker2.example.com"])

# Inspect all workers consuming on this vhost.
&gt;&gt;&gt; i = inspect()

### Methods

# Get currently executing tasks
&gt;&gt;&gt; i.active()

# Get currently reserved tasks
&gt;&gt;&gt; i.reserved()

# Get the current eta schedule
&gt;&gt;&gt; i.scheduled()

# Worker statistics and info
&gt;&gt;&gt; i.stats()

# List of currently revoked tasks
&gt;&gt;&gt; i.revoked()

# List of registered tasks
&gt;&gt;&gt; i.registered_tasks()</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Remote control commands <cite>dump_active</cite>/<cite>dump_reserved</cite>/<cite>dump_schedule</cite>
now replies with detailed task requests.</p>
<blockquote>
<div><p>Containing the original arguments and fields of the task requested.</p>
<p>In addition the remote control command <cite>set_loglevel</cite> has been added,
this only changes the log level for the main process.</p>
</div></blockquote>
</li>
<li><p class="first">Worker control command execution now catches errors and returns their
string representation in the reply.</p>
</li>
<li><p class="first">Functional test suite added</p>
<blockquote>
<div><p><tt class="xref py py-mod docutils literal"><span class="pre">celery.tests.functional.case</span></tt> contains utilities to start
and stop an embedded celeryd process, for use in functional testing.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="version-2-0-1">
<span id="id50"></span><h2><a class="toc-backref" href="#id150">2.0.1</a><a class="headerlink" href="#version-2-0-1" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-07-09 03:02 P.M CEST</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">multiprocessing.pool: Now handles encoding errors, so that pickling errors
doesn&#8217;t crash the worker processes.</p>
</li>
<li><p class="first">The remote control command replies was not working with RabbitMQ 1.8.0&#8217;s
stricter equivalence checks.</p>
<blockquote>
<div><p>If you&#8217;ve already hit this problem you may have to delete the
declaration:</p>
<div class="highlight-python"><pre>$ camqadm exchange.delete celerycrq</pre>
</div>
<p>or:</p>
<div class="highlight-python"><pre>$ python manage.py camqadm exchange.delete celerycrq</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">A bug sneaked in the ETA scheduler that made it only able to execute
one task per second(!)</p>
<blockquote>
<div><p>The scheduler sleeps between iterations so it doesn&#8217;t consume too much CPU.
It keeps a list of the scheduled items sorted by time, at each iteration
it sleeps for the remaining time of the item with the nearest deadline.
If there are no eta tasks it will sleep for a minimum amount of time, one
second by default.</p>
<p>A bug sneaked in here, making it sleep for one second for every task
that was scheduled. This has been fixed, so now it should move
tasks like hot knife through butter.</p>
<p>In addition a new setting has been added to control the minimum sleep
interval; <a class="reference internal" href="configuration.html#std:setting-CELERYD_ETA_SCHEDULER_PRECISION"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_ETA_SCHEDULER_PRECISION</span></tt></a>. A good
value for this would be a float between 0 and 1, depending
on the needed precision. A value of 0.8 means that when the ETA of a task
is met, it will take at most 0.8 seconds for the task to be moved to the
ready queue.</p>
</div></blockquote>
</li>
<li><p class="first">Pool: Supervisor did not release the semaphore.</p>
<blockquote>
<div><p>This would lead to a deadlock if all workers terminated prematurely.</p>
</div></blockquote>
</li>
<li><p class="first">Added Python version trove classifiers: 2.4, 2.5, 2.6 and 2.7</p>
</li>
<li><p class="first">Tests now passing on Python 2.7.</p>
</li>
<li><p class="first">Task.__reduce__: Tasks created using the task decorator can now be pickled.</p>
</li>
<li><p class="first">setup.py: nose added to <cite>tests_require</cite>.</p>
</li>
<li><p class="first">Pickle should now work with SQLAlchemy 0.5.x</p>
</li>
<li><p class="first">New homepage design by Jan Henrik Helmers: <a class="reference external" href="http://celeryproject.org">http://celeryproject.org</a></p>
</li>
<li><p class="first">New Sphinx theme by Armin Ronacher: <a class="reference external" href="http://docs.celeryproject.org/">http://docs.celeryproject.org/</a></p>
</li>
<li><p class="first">Fixed &#8220;pending_xref&#8221; errors shown in the HTML rendering of the
documentation. Apparently this was caused by new changes in Sphinx 1.0b2.</p>
</li>
<li><p class="first">Router classes in <a class="reference internal" href="configuration.html#std:setting-CELERY_ROUTES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_ROUTES</span></tt></a> are now imported lazily.</p>
<blockquote>
<div><p>Importing a router class in a module that also loads the Celery
environment would cause a circular dependency. This is solved
by importing it when needed after the environment is set up.</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="configuration.html#std:setting-CELERY_ROUTES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_ROUTES</span></tt></a> was broken if set to a single dict.</p>
<blockquote>
<div><p>This example in the docs should now work again:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_ROUTES</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;feed.tasks.import_feed&quot;</span><span class="p">:</span> <span class="s">&quot;feeds&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><cite>CREATE_MISSING_QUEUES</cite> was not honored by apply_async.</p>
</li>
<li><p class="first">New remote control command: <cite>stats</cite></p>
<blockquote>
<div><p>Dumps information about the worker, like pool process ids, and
total number of tasks executed by type.</p>
<p>Example reply:</p>
<div class="highlight-python"><pre>[{'worker.local':
     'total': {'tasks.sleeptask': 6},
     'pool': {'timeouts': [None, None],
              'processes': [60376, 60377],
              'max-concurrency': 2,
              'max-tasks-per-child': None,
              'put-guarded-by-semaphore': True}}]</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">New remote control command: <cite>dump_active</cite></p>
<blockquote>
<div><p>Gives a list of tasks currently being executed by the worker.
By default arguments are passed through repr in case there
are arguments that is not JSON encodable. If you know
the arguments are JSON safe, you can pass the argument <cite>safe=True</cite>.</p>
<p>Example reply:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">broadcast</span><span class="p">(</span><span class="s">&quot;dump_active&quot;</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;safe&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span> <span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">[{&#39;worker.local&#39;: [</span>
<span class="go">    {&#39;args&#39;: &#39;(1,)&#39;,</span>
<span class="go">     &#39;time_start&#39;: 1278580542.6300001,</span>
<span class="go">     &#39;name&#39;: &#39;tasks.sleeptask&#39;,</span>
<span class="go">     &#39;delivery_info&#39;: {</span>
<span class="go">         &#39;consumer_tag&#39;: &#39;30&#39;,</span>
<span class="go">         &#39;routing_key&#39;: &#39;celery&#39;,</span>
<span class="go">         &#39;exchange&#39;: &#39;celery&#39;},</span>
<span class="go">     &#39;hostname&#39;: &#39;casper.local&#39;,</span>
<span class="go">     &#39;acknowledged&#39;: True,</span>
<span class="go">     &#39;kwargs&#39;: &#39;{}&#39;,</span>
<span class="go">     &#39;id&#39;: &#39;802e93e9-e470-47ed-b913-06de8510aca2&#39;,</span>
<span class="go">    }</span>
<span class="go">]}]</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Added experimental support for persistent revokes.</p>
<blockquote>
<div><p>Use the <cite>-S|&#8211;statedb</cite> argument to celeryd to enable it:</p>
<div class="highlight-python"><pre>$ celeryd --statedb=/var/run/celeryd</pre>
</div>
<p>This will use the file: <cite>/var/run/celeryd.db</cite>,
as the <cite>shelve</cite> module automatically adds the <cite>.db</cite> suffix.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="version-2-0-0">
<span id="id51"></span><h2><a class="toc-backref" href="#id151">2.0.0</a><a class="headerlink" href="#version-2-0-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-07-02 02:30 P.M CEST</td>
</tr>
</tbody>
</table>
<div class="section" id="foreword">
<h3><a class="toc-backref" href="#id152">Foreword</a><a class="headerlink" href="#foreword" title="Permalink to this headline">¶</a></h3>
<p>Celery 2.0 contains backward incompatible changes, the most important
being that the Django dependency has been removed so Celery no longer
supports Django out of the box, but instead as an add-on package
called <a class="reference external" href="http://pypi.python.org/pypi/django-celery">django-celery</a>.</p>
<p>We&#8217;re very sorry for breaking backwards compatibility, but there&#8217;s
also many new and exciting features to make up for the time you lose
upgrading, so be sure to read the <a class="reference internal" href="#v200-news"><em>News</em></a> section.</p>
<p>Quite a lot of potential users have been upset about the Django dependency,
so maybe this is a chance to get wider adoption by the Python community as
well.</p>
<p>Big thanks to all contributors, testers and users!</p>
</div>
<div class="section" id="upgrading-for-django-users">
<span id="v200-django-upgrade"></span><h3><a class="toc-backref" href="#id153">Upgrading for Django-users</a><a class="headerlink" href="#upgrading-for-django-users" title="Permalink to this headline">¶</a></h3>
<p>Django integration has been moved to a separate package: <a class="reference external" href="http://pypi.python.org/pypi/django-celery">django-celery</a>.</p>
<ul>
<li><p class="first">To upgrade you need to install the <a class="reference external" href="http://pypi.python.org/pypi/django-celery">django-celery</a> module and change:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="s">&quot;celery&quot;</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="s">&quot;djcelery&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">If you use <cite>mod_wsgi</cite> you need to add the following line to your <cite>.wsgi</cite>
file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;CELERY_LOADER&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;django&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">The following modules has been moved to <a class="reference external" href="http://pypi.python.org/pypi/django-celery">django-celery</a>:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><p class="first last"><strong>Module name</strong></p>
</th>
<th class="head"><p class="first last"><strong>Replace with</strong></p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><p class="first last"><cite>celery.models</cite></p>
</td>
<td><p class="first last"><cite>djcelery.models</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>celery.managers</cite></p>
</td>
<td><p class="first last"><cite>djcelery.managers</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>celery.views</cite></p>
</td>
<td><p class="first last"><cite>djcelery.views</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>celery.urls</cite></p>
</td>
<td><p class="first last"><cite>djcelery.urls</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>celery.management</cite></p>
</td>
<td><p class="first last"><cite>djcelery.management</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>celery.loaders.djangoapp</cite></p>
</td>
<td><p class="first last"><cite>djcelery.loaders</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>celery.backends.database</cite></p>
</td>
<td><p class="first last"><cite>djcelery.backends.database</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>celery.backends.cache</cite></p>
</td>
<td><p class="first last"><cite>djcelery.backends.cache</cite></p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ul>
<p>Importing <tt class="xref py py-mod docutils literal"><span class="pre">djcelery</span></tt> will automatically setup Celery to use Django loader.
loader.  It does this by setting the <span class="target" id="index-0"></span><tt class="xref std std-envvar docutils literal"><span class="pre">CELERY_LOADER</span></tt> environment variable to
<cite>&#8220;django&#8221;</cite> (it won&#8217;t change it if a loader is already set.)</p>
<p>When the Django loader is used, the &#8220;database&#8221; and &#8220;cache&#8221; result backend
aliases will point to the <tt class="xref py py-mod docutils literal"><span class="pre">djcelery</span></tt> backends instead of the built-in backends,
and configuration will be read from the Django settings.</p>
</div>
<div class="section" id="upgrading-for-others">
<span id="v200-upgrade"></span><h3><a class="toc-backref" href="#id154">Upgrading for others</a><a class="headerlink" href="#upgrading-for-others" title="Permalink to this headline">¶</a></h3>
<div class="section" id="database-result-backend">
<span id="v200-upgrade-database"></span><h4><a class="toc-backref" href="#id155">Database result backend</a><a class="headerlink" href="#database-result-backend" title="Permalink to this headline">¶</a></h4>
<p>The database result backend is now using <a class="reference external" href="http://www.sqlalchemy.org">SQLAlchemy</a> instead of the
Django ORM, see <a class="reference external" href="http://www.sqlalchemy.org/docs/core/engines.html#supported-databases">Supported Databases</a> for a table of supported databases.</p>
<p>The <cite>DATABASE_*</cite> settings has been replaced by a single setting:
<a class="reference internal" href="configuration.html#std:setting-CELERY_RESULT_DBURI"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_RESULT_DBURI</span></tt></a>. The value here should be an
<a class="reference external" href="http://www.sqlalchemy.org/docs/core/engines.html#database-urls">SQLAlchemy Connection String</a>, some examples include:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># sqlite (filename)</span>
<span class="n">CELERY_RESULT_DBURI</span> <span class="o">=</span> <span class="s">&quot;sqlite:///celerydb.sqlite&quot;</span>

<span class="c"># mysql</span>
<span class="n">CELERY_RESULT_DBURI</span> <span class="o">=</span> <span class="s">&quot;mysql://scott:tiger@localhost/foo&quot;</span>

<span class="c"># postgresql</span>
<span class="n">CELERY_RESULT_DBURI</span> <span class="o">=</span> <span class="s">&quot;postgresql://scott:tiger@localhost/mydatabase&quot;</span>

<span class="c"># oracle</span>
<span class="n">CELERY_RESULT_DBURI</span> <span class="o">=</span> <span class="s">&quot;oracle://scott:tiger@127.0.0.1:1521/sidname&quot;</span>
</pre></div>
</div>
<p>See <a class="reference external" href="http://www.sqlalchemy.org/docs/core/engines.html#database-urls">SQLAlchemy Connection Strings</a> for more information about connection
strings.</p>
<p>To specify additional SQLAlchemy database engine options you can use
the <a class="reference internal" href="configuration.html#std:setting-CELERY_RESULT_ENGINE_OPTIONS"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_RESULT_ENGINE_OPTIONS</span></tt></a> setting:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># echo enables verbose logging from SQLAlchemy.</span>
<span class="n">CELERY_RESULT_ENGINE_OPTIONS</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;echo&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="cache-result-backend">
<span id="v200-upgrade-cache"></span><h4><a class="toc-backref" href="#id156">Cache result backend</a><a class="headerlink" href="#cache-result-backend" title="Permalink to this headline">¶</a></h4>
<p>The cache result backend is no longer using the Django cache framework,
but it supports mostly the same configuration syntax:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_CACHE_BACKEND</span> <span class="o">=</span> <span class="s">&quot;memcached://A.example.com:11211;B.example.com&quot;</span>
</pre></div>
</div>
<p>To use the cache backend you must either have the <a class="reference external" href="http://pypi.python.org/pypi/pylibmc">pylibmc</a> or
<a class="reference external" href="http://pypi.python.org/pypi/python-memcached">python-memcached</a> library installed, of which the former is regarded
as the best choice.</p>
<p>The support backend types are <cite>memcached://</cite> and <cite>memory://</cite>,
we haven&#8217;t felt the need to support any of the other backends
provided by Django.</p>
</div>
</div>
<div class="section" id="backward-incompatible-changes">
<span id="v200-incompatible"></span><h3><a class="toc-backref" href="#id157">Backward incompatible changes</a><a class="headerlink" href="#backward-incompatible-changes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Default (python) loader now prints warning on missing <cite>celeryconfig.py</cite>
instead of raising <tt class="xref py py-exc docutils literal"><span class="pre">ImportError</span></tt>.</p>
<blockquote>
<div><p>celeryd raises <a class="reference internal" href="reference/celery.exceptions.html#celery.exceptions.ImproperlyConfigured" title="celery.exceptions.ImproperlyConfigured"><tt class="xref py py-exc docutils literal"><span class="pre">ImproperlyConfigured</span></tt></a> if the configuration
is not set up. This makes it possible to use <cite>&#8211;help</cite> etc., without having a
working configuration.</p>
<p>Also this makes it possible to use the client side of celery without being
configured:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">carrot.connection</span> <span class="kn">import</span> <span class="n">BrokerConnection</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">BrokerConnection</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="s">&quot;guest&quot;</span><span class="p">,</span> <span class="s">&quot;guest&quot;</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.execute</span> <span class="kn">import</span> <span class="n">send_task</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">send_task</span><span class="p">(</span><span class="s">&quot;celery.ping&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.backends.amqp</span> <span class="kn">import</span> <span class="n">AMQPBackend</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">AMQPBackend</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">&#39;pong&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">The following deprecated settings has been removed (as scheduled by
the <a class="reference external" href="http://ask.github.com/celery/internals/deprecation.html">deprecation timeline</a>):</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><p class="first last"><strong>Setting name</strong></p>
</th>
<th class="head"><p class="first last"><strong>Replace with</strong></p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><p class="first last"><cite>CELERY_AMQP_CONSUMER_QUEUES</cite></p>
</td>
<td><p class="first last"><cite>CELERY_QUEUES</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>CELERY_AMQP_EXCHANGE</cite></p>
</td>
<td><p class="first last"><cite>CELERY_DEFAULT_EXCHANGE</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>CELERY_AMQP_EXCHANGE_TYPE</cite></p>
</td>
<td><p class="first last"><cite>CELERY_DEFAULT_EXCHANGE_TYPE</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>CELERY_AMQP_CONSUMER_ROUTING_KEY</cite></p>
</td>
<td><p class="first last"><cite>CELERY_QUEUES</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>CELERY_AMQP_PUBLISHER_ROUTING_KEY</cite></p>
</td>
<td><p class="first last"><cite>CELERY_DEFAULT_ROUTING_KEY</cite></p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ul>
<ul>
<li><p class="first">The <cite>celery.task.rest</cite> module has been removed, use <a class="reference internal" href="userguide/remote-tasks.html#module-celery.task.http" title="celery.task.http"><tt class="xref py py-mod docutils literal"><span class="pre">celery.task.http</span></tt></a>
instead (as scheduled by the <a class="reference external" href="http://ask.github.com/celery/internals/deprecation.html">deprecation timeline</a>).</p>
</li>
<li><p class="first">It&#8217;s no longer allowed to skip the class name in loader names.
(as scheduled by the <a class="reference external" href="http://ask.github.com/celery/internals/deprecation.html">deprecation timeline</a>):</p>
<blockquote>
<div><p>Assuming the implicit <cite>Loader</cite> class name is no longer supported,
if you use e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_LOADER</span> <span class="o">=</span> <span class="s">&quot;myapp.loaders&quot;</span>
</pre></div>
</div>
<p>You need to include the loader class name, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_LOADER</span> <span class="o">=</span> <span class="s">&quot;myapp.loaders.Loader&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="configuration.html#std:setting-CELERY_TASK_RESULT_EXPIRES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_RESULT_EXPIRES</span></tt></a> now defaults to 1 day.</p>
<blockquote>
<div><p>Previous default setting was to expire in 5 days.</p>
</div></blockquote>
</li>
<li><p class="first">AMQP backend: Don&#8217;t use different values for <cite>auto_delete</cite>.</p>
<blockquote>
<div><p>This bug became visible with RabbitMQ 1.8.0, which no longer
allows conflicting declarations for the auto_delete and durable settings.</p>
<p>If you&#8217;ve already used celery with this backend chances are you
have to delete the previous declaration:</p>
<div class="highlight-python"><pre>$ camqadm exchange.delete celeryresults</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Now uses pickle instead of cPickle on Python versions &lt;= 2.5</p>
<blockquote>
<div><p>cPickle is broken in Python &lt;= 2.5.</p>
<p>It unsafely and incorrectly uses relative instead of absolute imports,
so e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">exceptions</span><span class="o">.</span><span class="n">KeyError</span>
</pre></div>
</div>
<p>becomes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">celery</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">KeyError</span>
</pre></div>
</div>
<p>Your best choice is to upgrade to Python 2.6,
as while the pure pickle version has worse performance,
it is the only safe option for older Python versions.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="v200-news">
<span id="id52"></span><h3><a class="toc-backref" href="#id158">News</a><a class="headerlink" href="#v200-news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><strong>celeryev</strong>: Curses Celery Monitor and Event Viewer.</p>
<blockquote>
<div><p>This is a simple monitor allowing you to see what tasks are
executing in real-time and investigate tracebacks and results of ready
tasks. It also enables you to set new rate limits and revoke tasks.</p>
<p>Screenshot:</p>
<div class="figure">
<img alt="_images/celeryevshotsm.jpg" src="_images/celeryevshotsm.jpg" />
</div>
<p>If you run <cite>celeryev</cite> with the <cite>-d</cite> switch it will act as an event
dumper, simply dumping the events it receives to standard out:</p>
<div class="highlight-python"><pre>$ celeryev -d
-&gt; celeryev: starting capture...
casper.local [2010-06-04 10:42:07.020000] heartbeat
casper.local [2010-06-04 10:42:14.750000] task received:
    tasks.add(61a68756-27f4-4879-b816-3cf815672b0e) args=[2, 2] kwargs={}
    eta=2010-06-04T10:42:16.669290, retries=0
casper.local [2010-06-04 10:42:17.230000] task started
    tasks.add(61a68756-27f4-4879-b816-3cf815672b0e) args=[2, 2] kwargs={}
casper.local [2010-06-04 10:42:17.960000] task succeeded:
    tasks.add(61a68756-27f4-4879-b816-3cf815672b0e)
    args=[2, 2] kwargs={} result=4, runtime=0.782663106918

The fields here are, in order: *sender hostname*, *timestamp*, *event type* and
*additional event fields*.</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">AMQP result backend: Now supports <cite>.ready()</cite>, <cite>.successful()</cite>,
<cite>.result</cite>, <cite>.status</cite>, and even responds to changes in task state</p>
</li>
<li><p class="first">New user guides:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="userguide/workers.html"><em>Workers Guide</em></a></li>
<li><a class="reference internal" href="userguide/tasksets.html"><em>Sets of tasks, Subtasks and Callbacks</em></a></li>
<li><a class="reference internal" href="userguide/routing.html"><em>Routing Tasks</em></a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">celeryd: Standard out/error is now being redirected to the log file.</p>
</li>
<li><p class="first"><tt class="xref py py-mod docutils literal"><span class="pre">billiard</span></tt> has been moved back to the celery repository.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><p class="first last"><strong>Module name</strong></p>
</th>
<th class="head"><p class="first last"><strong>celery equivalent</strong></p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><p class="first last"><cite>billiard.pool</cite></p>
</td>
<td><p class="first last"><cite>celery.concurrency.processes.pool</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>billiard.serialization</cite></p>
</td>
<td><p class="first last"><cite>celery.serialization</cite></p>
</td>
</tr>
<tr><td><p class="first last"><cite>billiard.utils.functional</cite></p>
</td>
<td><p class="first last"><cite>celery.utils.functional</cite></p>
</td>
</tr>
</tbody>
</table>
<p>The <tt class="xref py py-mod docutils literal"><span class="pre">billiard</span></tt> distribution may be maintained, depending on interest.</p>
</div></blockquote>
</li>
<li><p class="first">now depends on <tt class="xref py py-mod docutils literal"><span class="pre">carrot</span></tt> &gt;= 0.10.5</p>
</li>
<li><p class="first">now depends on <tt class="xref py py-mod docutils literal"><span class="pre">pyparsing</span></tt></p>
</li>
<li><p class="first">celeryd: Added <cite>&#8211;purge</cite> as an alias to <cite>&#8211;discard</cite>.</p>
</li>
<li><p class="first">celeryd: Ctrl+C (SIGINT) once does warm shutdown, hitting Ctrl+C twice
forces termination.</p>
</li>
<li><p class="first">Added support for using complex crontab-expressions in periodic tasks. For
example, you can now use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">crontab</span><span class="p">(</span><span class="n">minute</span><span class="o">=</span><span class="s">&quot;*/15&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>or even:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">crontab</span><span class="p">(</span><span class="n">minute</span><span class="o">=</span><span class="s">&quot;*/30&quot;</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="s">&quot;8-17,1-2&quot;</span><span class="p">,</span> <span class="n">day_of_week</span><span class="o">=</span><span class="s">&quot;thu-fri&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="userguide/periodic-tasks.html"><em>Periodic Tasks</em></a>.</p>
</li>
<li><p class="first">celeryd: Now waits for available pool processes before applying new
tasks to the pool.</p>
<blockquote>
<div><p>This means it doesn&#8217;t have to wait for dozens of tasks to finish at shutdown
because it has applied prefetched tasks without having any pool
processes available to immediately accept them.</p>
<p>See <a class="reference external" href="https://github.com/ask/celery/issues/122" title="celery.worker.control.builtins.shutdown crashes cleanup if celeryd has prefetched tasks"><span class="xref issue closed">issue #122</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">New built-in way to do task callbacks using
<a class="reference internal" href="reference/celery.task.sets.html#celery.task.sets.subtask" title="celery.task.sets.subtask"><tt class="xref py py-class docutils literal"><span class="pre">subtask</span></tt></a>.</p>
<p>See <a class="reference internal" href="userguide/tasksets.html"><em>Sets of tasks, Subtasks and Callbacks</em></a> for more information.</p>
</li>
<li><p class="first">TaskSets can now contain several types of tasks.</p>
<p><a class="reference internal" href="reference/celery.task.sets.html#celery.task.sets.TaskSet" title="celery.task.sets.TaskSet"><tt class="xref py py-class docutils literal"><span class="pre">TaskSet</span></tt></a> has been refactored to use
a new syntax, please see <a class="reference internal" href="userguide/tasksets.html"><em>Sets of tasks, Subtasks and Callbacks</em></a> for more information.</p>
<p>The previous syntax is still supported, but will be deprecated in
version 1.4.</p>
</li>
<li><p class="first">TaskSet failed() result was incorrect.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/132" title="Taskset failed() result is incorrect (patch)"><span class="xref issue closed">issue #132</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Now creates different loggers per task class.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/129" title="Enhancement: Create a different logger per each task class"><span class="xref issue closed">issue #129</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Missing queue definitions are now created automatically.</p>
<blockquote>
<div><blockquote>
<div><p>You can disable this using the <a class="reference internal" href="configuration.html#std:setting-CELERY_CREATE_MISSING_QUEUES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_CREATE_MISSING_QUEUES</span></tt></a>
setting.</p>
<p>The missing queues are created with the following options:</p>
<div class="highlight-python"><pre>CELERY_QUEUES[name] = {"exchange": name,
                       "exchange_type": "direct",
                       "routing_key": "name}</pre>
</div>
</div></blockquote>
<p>This feature is added for easily setting up routing using the <cite>-Q</cite>
option to <cite>celeryd</cite>:</p>
<div class="highlight-python"><pre>$ celeryd -Q video, image</pre>
</div>
<p>See the new routing section of the User Guide for more information:
<a class="reference internal" href="userguide/routing.html"><em>Routing Tasks</em></a>.</p>
</div></blockquote>
</li>
<li><p class="first">New Task option: <cite>Task.queue</cite></p>
<blockquote>
<div><p>If set, message options will be taken from the corresponding entry
in <a class="reference internal" href="configuration.html#std:setting-CELERY_QUEUES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_QUEUES</span></tt></a>. <cite>exchange</cite>, <cite>exchange_type</cite> and <cite>routing_key</cite>
will be ignored</p>
</div></blockquote>
</li>
<li><p class="first">Added support for task soft and hard time limits.</p>
<blockquote>
<div><p>New settings added:</p>
<ul>
<li><p class="first"><a class="reference internal" href="configuration.html#std:setting-CELERYD_TASK_TIME_LIMIT"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_TASK_TIME_LIMIT</span></tt></a></p>
<blockquote>
<div><p>Hard time limit. The worker processing the task will be killed and
replaced with a new one when this is exceeded.</p>
</div></blockquote>
</li>
<li><p class="first"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_SOFT_TASK_TIME_LIMIT</span></tt></p>
<blockquote>
<div><p>Soft time limit. The <a class="reference internal" href="reference/celery.exceptions.html#celery.exceptions.SoftTimeLimitExceeded" title="celery.exceptions.SoftTimeLimitExceeded"><tt class="xref py py-exc docutils literal"><span class="pre">celery.exceptions.SoftTimeLimitExceeded</span></tt></a>
exception will be raised when this is exceeded.  The task can catch
this to e.g. clean up before the hard time limit comes.</p>
</div></blockquote>
</li>
</ul>
<p>New command line arguments to celeryd added:
<cite>&#8211;time-limit</cite> and <cite>&#8211;soft-time-limit</cite>.</p>
<p>What&#8217;s left?</p>
<p>This won&#8217;t work on platforms not supporting signals (and specifically
the <cite>SIGUSR1</cite> signal) yet. So an alternative the ability to disable
the feature all together on nonconforming platforms must be implemented.</p>
<p>Also when the hard time limit is exceeded, the task result should
be a <cite>TimeLimitExceeded</cite> exception.</p>
</div></blockquote>
</li>
<li><p class="first">Test suite is now passing without a running broker, using the carrot
in-memory backend.</p>
</li>
<li><p class="first">Log output is now available in colors.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><p class="first last"><strong>Log level</strong></p>
</th>
<th class="head"><p class="first last"><strong>Color</strong></p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><p class="first last"><cite>DEBUG</cite></p>
</td>
<td><p class="first last">Blue</p>
</td>
</tr>
<tr><td><p class="first last"><cite>WARNING</cite></p>
</td>
<td><p class="first last">Yellow</p>
</td>
</tr>
<tr><td><p class="first last"><cite>CRITICAL</cite></p>
</td>
<td><p class="first last">Magenta</p>
</td>
</tr>
<tr><td><p class="first last"><cite>ERROR</cite></p>
</td>
<td><p class="first last">Red</p>
</td>
</tr>
</tbody>
</table>
<p>This is only enabled when the log output is a tty.
You can explicitly enable/disable this feature using the
<a class="reference internal" href="configuration.html#std:setting-CELERYD_LOG_COLOR"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_LOG_COLOR</span></tt></a> setting.</p>
</div></blockquote>
</li>
<li><p class="first">Added support for task router classes (like the django multi-db routers)</p>
<blockquote>
<div><ul class="simple">
<li>New setting: <a class="reference internal" href="configuration.html#std:setting-CELERY_ROUTES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_ROUTES</span></tt></a></li>
</ul>
<p>This is a single, or a list of routers to traverse when
sending tasks. Dictionaries in this list converts to a
<a class="reference internal" href="internals/reference/celery.routes.html#celery.routes.MapRoute" title="celery.routes.MapRoute"><tt class="xref py py-class docutils literal"><span class="pre">celery.routes.MapRoute</span></tt></a> instance.</p>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">CELERY_ROUTES</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;celery.ping&quot;</span><span class="p">:</span> <span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="go">                     &quot;mytasks.add&quot;: &quot;cpu-bound&quot;,</span>
<span class="go">                     &quot;video.encode&quot;: {</span>
<span class="go">                         &quot;queue&quot;: &quot;video&quot;,</span>
<span class="go">                         &quot;exchange&quot;: &quot;media&quot;</span>
<span class="go">                         &quot;routing_key&quot;: &quot;media.video.encode&quot;}}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">CELERY_ROUTES</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;myapp.tasks.Router&quot;</span><span class="p">,</span>
<span class="go">                     {&quot;celery.ping&quot;: &quot;default})</span>
</pre></div>
</div>
<p>Where <cite>myapp.tasks.Router</cite> could be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Router</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">route_for_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">task</span> <span class="o">==</span> <span class="s">&quot;celery.ping&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;default&quot;</span>
</pre></div>
</div>
<p>route_for_task may return a string or a dict. A string then means
it&#8217;s a queue name in <a class="reference internal" href="configuration.html#std:setting-CELERY_QUEUES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_QUEUES</span></tt></a>, a dict means it&#8217;s a custom route.</p>
<p>When sending tasks, the routers are consulted in order. The first
router that doesn&#8217;t return <cite>None</cite> is the route to use. The message options
is then merged with the found route settings, where the routers settings
have priority.</p>
<p>Example if <tt class="xref py py-func docutils literal"><span class="pre">apply_async()</span></tt> has these arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Task</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">immediate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="s">&quot;video&quot;</span><span class="p">,</span>
<span class="gp">... </span>                 <span class="n">routing_key</span><span class="o">=</span><span class="s">&quot;video.compress&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>and a router returns:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;immediate&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
 <span class="s">&quot;exchange&quot;</span><span class="p">:</span> <span class="s">&quot;urgent&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>the final message options will be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">immediate</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="s">&quot;urgent&quot;</span><span class="p">,</span> <span class="n">routing_key</span><span class="o">=</span><span class="s">&quot;video.compress&quot;</span>
</pre></div>
</div>
<p>(and any default message options defined in the
<tt class="xref py py-class docutils literal"><span class="pre">Task</span></tt> class)</p>
</div></blockquote>
</li>
<li><p class="first">New Task handler called after the task returns:
<tt class="xref py py-meth docutils literal"><span class="pre">after_return()</span></tt>.</p>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="internals/reference/celery.datastructures.html#celery.datastructures.ExceptionInfo" title="celery.datastructures.ExceptionInfo"><tt class="xref py py-class docutils literal"><span class="pre">ExceptionInfo</span></tt></a> now passed to</dt>
<dd><p class="first last"><tt class="xref py py-meth docutils literal"><span class="pre">on_retry()</span></tt>/
<tt class="xref py py-meth docutils literal"><span class="pre">on_failure()</span></tt> as einfo keyword argument.</p>
</dd>
</dl>
</li>
<li><p class="first">celeryd: Added <a class="reference internal" href="configuration.html#std:setting-CELERYD_MAX_TASKS_PER_CHILD"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_MAX_TASKS_PER_CHILD</span></tt></a> /
<em class="xref std std-option">--maxtasksperchild</em></p>
<blockquote>
<div><p>Defines the maximum number of tasks a pool worker can process before
the process is terminated and replaced by a new one.</p>
</div></blockquote>
</li>
<li><p class="first">Revoked tasks now marked with state <a class="reference internal" href="userguide/tasks.html#std:state-REVOKED"><tt class="xref std std-state docutils literal"><span class="pre">REVOKED</span></tt></a>, and <cite>result.get()</cite>
will now raise <a class="reference internal" href="reference/celery.exceptions.html#celery.exceptions.TaskRevokedError" title="celery.exceptions.TaskRevokedError"><tt class="xref py py-exc docutils literal"><span class="pre">TaskRevokedError</span></tt></a>.</p>
</li>
<li><p class="first"><tt class="xref py py-func docutils literal"><span class="pre">celery.task.control.ping()</span></tt> now works as expected.</p>
</li>
<li><p class="first"><cite>apply(throw=True)</cite> / <a class="reference internal" href="configuration.html#std:setting-CELERY_EAGER_PROPAGATES_EXCEPTIONS"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_EAGER_PROPAGATES_EXCEPTIONS</span></tt></a>:
Makes eager execution re-raise task errors.</p>
</li>
<li><p class="first">New signal: <tt class="xref std std-signal docutils literal"><span class="pre">~celery.signals.worker_process_init</span></tt>: Sent inside the
pool worker process at init.</p>
</li>
<li><p class="first">celeryd <em class="xref std std-option">-Q</em> option: Ability to specify list of queues to use,
disabling other configured queues.</p>
<blockquote>
<div><p>For example, if <a class="reference internal" href="configuration.html#std:setting-CELERY_QUEUES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_QUEUES</span></tt></a> defines four
queues: <cite>image</cite>, <cite>video</cite>, <cite>data</cite> and <cite>default</cite>, the following
command would make celeryd only consume from the <cite>image</cite> and <cite>video</cite>
queues:</p>
<div class="highlight-python"><pre>$ celeryd -Q image,video</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">celeryd: New return value for the <cite>revoke</cite> control command:</p>
<blockquote>
<div><p>Now returns:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;ok&quot;</span><span class="p">:</span> <span class="s">&quot;task $id revoked&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>instead of <cite>True</cite>.</p>
</div></blockquote>
</li>
<li><p class="first">celeryd: Can now enable/disable events using remote control</p>
<blockquote>
<div><p>Example usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task.control</span> <span class="kn">import</span> <span class="n">broadcast</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">broadcast</span><span class="p">(</span><span class="s">&quot;enable_events&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">broadcast</span><span class="p">(</span><span class="s">&quot;disable_events&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Removed top-level tests directory. Test config now in celery.tests.config</p>
<blockquote>
<div><p>This means running the unit tests doesn&#8217;t require any special setup.
<cite>celery/tests/__init__</cite> now configures the <span class="target" id="index-1"></span><tt class="xref std std-envvar docutils literal"><span class="pre">CELERY_CONFIG_MODULE</span></tt>
and <span class="target" id="index-2"></span><tt class="xref std std-envvar docutils literal"><span class="pre">CELERY_LOADER</span></tt> environment variables, so when <cite>nosetests</cite>
imports that, the unit test environment is all set up.</p>
<p>Before you run the tests you need to install the test requirements:</p>
<div class="highlight-python"><pre>$ pip install -r contrib/requirements/test.txt</pre>
</div>
<p>Running all tests:</p>
<div class="highlight-python"><pre>$ nosetests</pre>
</div>
<p>Specifying the tests to run:</p>
<div class="highlight-python"><pre>$ nosetests celery.tests.test_task</pre>
</div>
<p>Producing HTML coverage:</p>
<div class="highlight-python"><pre>$ nosetests --with-coverage3</pre>
</div>
<p>The coverage output is then located in <cite>celery/tests/cover/index.html</cite>.</p>
</div></blockquote>
</li>
<li><p class="first">celeryd: New option <cite>&#8211;version</cite>: Dump version info and exit.</p>
</li>
<li><p class="first"><tt class="xref py py-mod docutils literal"><span class="pre">celeryd-multi</span></tt>: Tool for shell scripts
to start multiple workers.</p>
</li>
</ul>
<blockquote>
<div><p>Some examples:</p>
<div class="highlight-python"><pre># Advanced example with 10 workers:
#   * Three of the workers processes the images and video queue
#   * Two of the workers processes the data queue with loglevel DEBUG
#   * the rest processes the default' queue.
$ celeryd-multi start 10 -l INFO -Q:1-3 images,video -Q:4,5:data
    -Q default -L:4,5 DEBUG

# get commands to start 10 workers, with 3 processes each
$ celeryd-multi start 3 -c 3
celeryd -n celeryd1.myhost -c 3
celeryd -n celeryd2.myhost -c 3
celeryd- n celeryd3.myhost -c 3

# start 3 named workers
$ celeryd-multi start image video data -c 3
celeryd -n image.myhost -c 3
celeryd -n video.myhost -c 3
celeryd -n data.myhost -c 3

# specify custom hostname
$ celeryd-multi start 2 -n worker.example.com -c 3
celeryd -n celeryd1.worker.example.com -c 3
celeryd -n celeryd2.worker.example.com -c 3

# Additionl options are added to each celeryd',
# but you can also modify the options for ranges of or single workers

# 3 workers: Two with 3 processes, and one with 10 processes.
$ celeryd-multi start 3 -c 3 -c:1 10
celeryd -n celeryd1.myhost -c 10
celeryd -n celeryd2.myhost -c 3
celeryd -n celeryd3.myhost -c 3

# can also specify options for named workers
$ celeryd-multi start image video data -c 3 -c:image 10
celeryd -n image.myhost -c 10
celeryd -n video.myhost -c 3
celeryd -n data.myhost -c 3

# ranges and lists of workers in options is also allowed:
# (-c:1-3 can also be written as -c:1,2,3)
$ celeryd-multi start 5 -c 3  -c:1-3 10
celeryd-multi -n celeryd1.myhost -c 10
celeryd-multi -n celeryd2.myhost -c 10
celeryd-multi -n celeryd3.myhost -c 10
celeryd-multi -n celeryd4.myhost -c 3
celeryd-multi -n celeryd5.myhost -c 3

# lists also works with named workers
$ celeryd-multi start foo bar baz xuzzy -c 3 -c:foo,bar,baz 10
celeryd-multi -n foo.myhost -c 10
celeryd-multi -n bar.myhost -c 10
celeryd-multi -n baz.myhost -c 10
celeryd-multi -n xuzzy.myhost -c 3</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>The worker now calls the result backends <cite>process_cleanup</cite> method
<em>after</em> task execution instead of before.</li>
<li>AMQP result backend now supports Pika.</li>
</ul>
</div>
</div>
<div class="section" id="version-1-0-6">
<span id="id53"></span><h2><a class="toc-backref" href="#id159">1.0.6</a><a class="headerlink" href="#version-1-0-6" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-06-30 09:57 A.M CEST</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">RabbitMQ 1.8.0 has extended their exchange equivalence tests to
include <cite>auto_delete</cite> and <cite>durable</cite>. This broke the AMQP backend.</p>
<p>If you&#8217;ve already used the AMQP backend this means you have to
delete the previous definitions:</p>
<div class="highlight-python"><pre>$ camqadm exchange.delete celeryresults</pre>
</div>
<p>or:</p>
<div class="highlight-python"><pre>$ python manage.py camqadm exchange.delete celeryresults</pre>
</div>
</li>
</ul>
</div>
<div class="section" id="version-1-0-5">
<span id="id54"></span><h2><a class="toc-backref" href="#id160">1.0.5</a><a class="headerlink" href="#version-1-0-5" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-06-01 02:36 P.M CEST</td>
</tr>
</tbody>
</table>
<div class="section" id="critical">
<span id="v105-critical"></span><h3><a class="toc-backref" href="#id161">Critical</a><a class="headerlink" href="#critical" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">SIGINT/Ctrl+C killed the pool, abruptly terminating the currently executing
tasks.</p>
<blockquote>
<div><p>Fixed by making the pool worker processes ignore <tt class="xref py py-const docutils literal"><span class="pre">SIGINT</span></tt>.</p>
</div></blockquote>
</li>
<li><p class="first">Should not close the consumers before the pool is terminated, just cancel
the consumers.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/122" title="celery.worker.control.builtins.shutdown crashes cleanup if celeryd has prefetched tasks"><span class="xref issue closed">issue #122</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Now depends on <tt class="xref py py-mod docutils literal"><span class="pre">billiard</span></tt> &gt;= 0.3.1</p>
</li>
<li><p class="first">celeryd: Previously exceptions raised by worker components could stall startup,
now it correctly logs the exceptions and shuts down.</p>
</li>
<li><p class="first">celeryd: Prefetch counts was set too late. QoS is now set as early as possible,
so celeryd can&#8217;t slurp in all the messages at start-up.</p>
</li>
</ul>
</div>
<div class="section" id="changes">
<span id="v105-changes"></span><h3><a class="toc-backref" href="#id162">Changes</a><a class="headerlink" href="#changes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><a class="reference internal" href="reference/celery.contrib.abortable.html#module-celery.contrib.abortable" title="celery.contrib.abortable"><tt class="xref py py-mod docutils literal"><span class="pre">celery.contrib.abortable</span></tt></a>: Abortable tasks.</p>
<blockquote>
<div><p>Tasks that defines steps of execution, the task can then
be aborted after each step has completed.</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="reference/celery.events.html#celery.events.EventDispatcher" title="celery.events.EventDispatcher"><tt class="xref py py-class docutils literal"><span class="pre">EventDispatcher</span></tt></a>: No longer creates AMQP channel
if events are disabled</p>
</li>
<li><p class="first">Added required RPM package names under <cite>[bdist_rpm]</cite> section, to support building RPMs
from the sources using setup.py</p>
</li>
<li><p class="first">Running unit tests: <span class="target" id="index-3"></span><tt class="xref std std-envvar docutils literal"><span class="pre">NOSE_VERBOSE</span></tt> environment var now enables verbose output from Nose.</p>
</li>
<li><p class="first"><tt class="xref py py-func docutils literal"><span class="pre">celery.execute.apply()</span></tt>: Pass log file/log level arguments as task kwargs.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/110" title="slave task logging is broken"><span class="xref issue closed">issue #110</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">celery.execute.apply: Should return exception, not <a class="reference internal" href="internals/reference/celery.datastructures.html#celery.datastructures.ExceptionInfo" title="celery.datastructures.ExceptionInfo"><tt class="xref py py-class docutils literal"><span class="pre">ExceptionInfo</span></tt></a>
on error.</p>
<blockquote>
<div><p>See <a class="reference external" href="https://github.com/ask/celery/issues/111" title="TypeError: exceptions must be classes or instances, not ExceptionInfo"><span class="xref issue closed">issue #111</span></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Added new entries to the <a class="reference internal" href="faq.html"><em>FAQs</em></a>:</p>
<blockquote>
<div><ul class="simple">
<li>Should I use retry or acks_late?</li>
<li>Can I execute a task by name?</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="version-1-0-4">
<span id="id55"></span><h2><a class="toc-backref" href="#id163">1.0.4</a><a class="headerlink" href="#version-1-0-4" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-05-31 09:54 A.M CEST</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Changelog merged with 1.0.5 as the release was never announced.</li>
</ul>
</div>
<div class="section" id="version-1-0-3">
<span id="id56"></span><h2><a class="toc-backref" href="#id164">1.0.3</a><a class="headerlink" href="#version-1-0-3" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-05-15 03:00 P.M CEST</td>
</tr>
</tbody>
</table>
<div class="section" id="v103-important">
<span id="id57"></span><h3><a class="toc-backref" href="#id165">Important notes</a><a class="headerlink" href="#v103-important" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Messages are now acknowledged <em>just before</em> the task function is executed.</p>
<blockquote>
<div><p>This is the behavior we&#8217;ve wanted all along, but couldn&#8217;t have because of
limitations in the multiprocessing module.
The previous behavior was not good, and the situation worsened with the
release of 1.0.1, so this change will definitely improve
reliability, performance and operations in general.</p>
<p>For more information please see <a class="reference external" href="http://bit.ly/9hom6T">http://bit.ly/9hom6T</a></p>
</div></blockquote>
</li>
<li><p class="first">Database result backend: result now explicitly sets <cite>null=True</cite> as
<cite>django-picklefield</cite> version 0.1.5 changed the default behavior
right under our noses :(</p>
<blockquote>
<div><p>See: <a class="reference external" href="http://bit.ly/d5OwMr">http://bit.ly/d5OwMr</a></p>
<p>This means those who created their celery tables (via syncdb or
celeryinit) with picklefield versions &gt;= 0.1.5 has to alter their tables to
allow the result field to be <cite>NULL</cite> manually.</p>
<p>MySQL:</p>
<div class="highlight-python"><pre>ALTER TABLE celery_taskmeta MODIFY result TEXT NULL</pre>
</div>
<p>PostgreSQL:</p>
<div class="highlight-python"><pre>ALTER TABLE celery_taskmeta ALTER COLUMN result DROP NOT NULL</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Removed <cite>Task.rate_limit_queue_type</cite>, as it was not really useful
and made it harder to refactor some parts.</p>
</li>
<li><p class="first">Now depends on carrot &gt;= 0.10.4</p>
</li>
<li><p class="first">Now depends on billiard &gt;= 0.3.0</p>
</li>
</ul>
</div>
<div class="section" id="v103-news">
<span id="id58"></span><h3><a class="toc-backref" href="#id166">News</a><a class="headerlink" href="#v103-news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">AMQP backend: Added timeout support for <cite>result.get()</cite> /
<cite>result.wait()</cite>.</p>
</li>
<li><p class="first">New task option: <cite>Task.acks_late</cite> (default: <a class="reference internal" href="configuration.html#std:setting-CELERY_ACKS_LATE"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_ACKS_LATE</span></tt></a>)</p>
<blockquote>
<div><p>Late ack means the task messages will be acknowledged <strong>after</strong> the task
has been executed, not <em>just before</em>, which is the default behavior.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This means the tasks may be executed twice if the worker
crashes in mid-execution. Not acceptable for most
applications, but desirable for others.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Added crontab-like scheduling to periodic tasks.</p>
<blockquote>
<div><p>Like a cron job, you can specify units of time of when
you would like the task to execute. While not a full implementation
of cron&#8217;s features, it should provide a fair degree of common scheduling
needs.</p>
<p>You can specify a minute (0-59), an hour (0-23), and/or a day of the
week (0-6 where 0 is Sunday, or by names: sun, mon, tue, wed, thu, fri,
sat).</p>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery.schedules</span> <span class="kn">import</span> <span class="n">crontab</span>
<span class="kn">from</span> <span class="nn">celery.decorators</span> <span class="kn">import</span> <span class="n">periodic_task</span>

<span class="nd">@periodic_task</span><span class="p">(</span><span class="n">run_every</span><span class="o">=</span><span class="n">crontab</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">every_morning</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Runs every morning at 7:30a.m&quot;</span><span class="p">)</span>

<span class="nd">@periodic_task</span><span class="p">(</span><span class="n">run_every</span><span class="o">=</span><span class="n">crontab</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">day_of_week</span><span class="o">=</span><span class="s">&quot;mon&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">every_monday_morning</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Run every monday morning at 7:30a.m&quot;</span><span class="p">)</span>

<span class="nd">@periodic_task</span><span class="p">(</span><span class="n">run_every</span><span class="o">=</span><span class="n">crontab</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">every_hour</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Runs every hour on the clock. e.g. 1:30, 2:30, 3:30 etc.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This a late addition. While we have unittests, due to the
nature of this feature we haven&#8217;t been able to completely test this
in practice, so consider this experimental.</p>
</div>
</div></blockquote>
</li>
<li><p class="first"><cite>TaskPool.apply_async</cite>: Now supports the <cite>accept_callback</cite> argument.</p>
</li>
<li><p class="first"><cite>apply_async</cite>: Now raises <tt class="xref py py-exc docutils literal"><span class="pre">ValueError</span></tt> if task args is not a list,
or kwargs is not a tuple (<a class="reference external" href="https://github.com/ask/celery/issues/95" title="Calling apply_async with incorrect parameters does not result in a failed task"><span class="xref issue closed">Issue #95</span></a>).</p>
</li>
<li><p class="first"><cite>Task.max_retries</cite> can now be <cite>None</cite>, which means it will retry forever.</p>
</li>
<li><p class="first">Celerybeat: Now reuses the same connection when publishing large
sets of tasks.</p>
</li>
<li><p class="first">Modified the task locking example in the documentation to use
<cite>cache.add</cite> for atomic locking.</p>
</li>
<li><p class="first">Added experimental support for a <em>started</em> status on tasks.</p>
<blockquote>
<div><p>If <cite>Task.track_started</cite> is enabled the task will report its status
as &#8220;started&#8221; when the task is executed by a worker.</p>
<p>The default value is <cite>False</cite> as the normal behaviour is to not
report that level of granularity. Tasks are either pending, finished,
or waiting to be retried. Having a &#8220;started&#8221; status can be useful for
when there are long running tasks and there is a need to report which
task is currently running.</p>
<p>The global default can be overridden by the <a class="reference internal" href="configuration.html#std:setting-CELERY_TRACK_STARTED"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TRACK_STARTED</span></tt></a>
setting.</p>
</div></blockquote>
</li>
<li><p class="first">User Guide: New section <cite>Tips and Best Practices</cite>.</p>
<blockquote>
<div><p>Contributions welcome!</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="remote-control-commands">
<span id="v103-remote-control"></span><h3><a class="toc-backref" href="#id167">Remote control commands</a><a class="headerlink" href="#remote-control-commands" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Remote control commands can now send replies back to the caller.</p>
<blockquote>
<div><p>Existing commands has been improved to send replies, and the client
interface in <cite>celery.task.control</cite> has new keyword arguments: <cite>reply</cite>,
<cite>timeout</cite> and <cite>limit</cite>. Where reply means it will wait for replies,
timeout is the time in seconds to stop waiting for replies, and limit
is the maximum number of replies to get.</p>
<p>By default, it will wait for as many replies as possible for one second.</p>
<ul>
<li><p class="first">rate_limit(task_name, destination=all, reply=False, timeout=1, limit=0)</p>
<blockquote>
<div><p>Worker returns <cite>{&#8220;ok&#8221;: message}</cite> on success,
or <cite>{&#8220;failure&#8221;: message}</cite> on failure.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task.control</span> <span class="kn">import</span> <span class="n">rate_limit</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rate_limit</span><span class="p">(</span><span class="s">&quot;tasks.add&quot;</span><span class="p">,</span> <span class="s">&quot;10/s&quot;</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">[{&#39;worker1&#39;: {&#39;ok&#39;: &#39;new rate limit set successfully&#39;}},</span>
<span class="go"> {&#39;worker2&#39;: {&#39;ok&#39;: &#39;new rate limit set successfully&#39;}}]</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">ping(destination=all, reply=False, timeout=1, limit=0)</p>
<blockquote>
<div><p>Worker returns the simple message <cite>&#8220;pong&#8221;</cite>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task.control</span> <span class="kn">import</span> <span class="n">ping</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ping</span><span class="p">(</span><span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">[{&#39;worker1&#39;: &#39;pong&#39;},</span>
<span class="go"> {&#39;worker2&#39;: &#39;pong&#39;},</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">revoke(destination=all, reply=False, timeout=1, limit=0)</p>
<blockquote>
<div><p>Worker simply returns <cite>True</cite>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task.control</span> <span class="kn">import</span> <span class="n">revoke</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">revoke</span><span class="p">(</span><span class="s">&quot;419e46eb-cf6a-4271-86a8-442b7124132c&quot;</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">[{&#39;worker1&#39;: True},</span>
<span class="go"> {&#39;worker2&#39;; True}]</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">You can now add your own remote control commands!</p>
<blockquote>
<div><p>Remote control commands are functions registered in the command
registry. Registering a command is done using
<tt class="xref py py-meth docutils literal"><span class="pre">celery.worker.control.Panel.register()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery.task.control</span> <span class="kn">import</span> <span class="n">Panel</span>

<span class="nd">@Panel.register</span>
<span class="k">def</span> <span class="nf">reset_broker_connection</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">panel</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">reset_connection</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&quot;ok&quot;</span><span class="p">:</span> <span class="s">&quot;connection re-established&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>With this module imported in the worker, you can launch the command
using <cite>celery.task.control.broadcast</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task.control</span> <span class="kn">import</span> <span class="n">broadcast</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">broadcast</span><span class="p">(</span><span class="s">&quot;reset_broker_connection&quot;</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">[{&#39;worker1&#39;: {&#39;ok&#39;: &#39;connection re-established&#39;},</span>
<span class="go"> {&#39;worker2&#39;: {&#39;ok&#39;: &#39;connection re-established&#39;}}]</span>
</pre></div>
</div>
<p><strong>TIP</strong> You can choose the worker(s) to receive the command
by using the <cite>destination</cite> argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">broadcast</span><span class="p">(</span><span class="s">&quot;reset_broker_connection&quot;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;worker1&quot;</span><span class="p">])</span>
<span class="go">[{&#39;worker1&#39;: {&#39;ok&#39;: &#39;connection re-established&#39;}]</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">New remote control command: <cite>dump_reserved</cite></p>
<blockquote>
<div><p>Dumps tasks reserved by the worker, waiting to be executed:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task.control</span> <span class="kn">import</span> <span class="n">broadcast</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">broadcast</span><span class="p">(</span><span class="s">&quot;dump_reserved&quot;</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">[{&#39;myworker1&#39;: [&lt;TaskRequest ....&gt;]}]</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">New remote control command: <cite>dump_schedule</cite></p>
<blockquote>
<div><p>Dumps the workers currently registered ETA schedule.
These are tasks with an <cite>eta</cite> (or <cite>countdown</cite>) argument
waiting to be executed by the worker.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task.control</span> <span class="kn">import</span> <span class="n">broadcast</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">broadcast</span><span class="p">(</span><span class="s">&quot;dump_schedule&quot;</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">[{&#39;w1&#39;: []},</span>
<span class="go"> {&#39;w3&#39;: []},</span>
<span class="go"> {&#39;w2&#39;: [&#39;0. 2010-05-12 11:06:00 pri0 &lt;TaskRequest</span>
<span class="go">            {name:&quot;opalfeeds.tasks.refresh_feed_slice&quot;,</span>
<span class="go">             id:&quot;95b45760-4e73-4ce8-8eac-f100aa80273a&quot;,</span>
<span class="go">             args:&quot;(&lt;Feeds freq_max:3600 freq_min:60</span>
<span class="go">                           start:2184.0 stop:3276.0&gt;,)&quot;,</span>
<span class="go">             kwargs:&quot;{&#39;page&#39;: 2}&quot;}&gt;&#39;]},</span>
<span class="go"> {&#39;w4&#39;: [&#39;0. 2010-05-12 11:00:00 pri0 &lt;TaskRequest</span>
<span class="go">            {name:&quot;opalfeeds.tasks.refresh_feed_slice&quot;,</span>
<span class="go">             id:&quot;c053480b-58fb-422f-ae68-8d30a464edfe&quot;,</span>
<span class="go">             args:&quot;(&lt;Feeds freq_max:3600 freq_min:60</span>
<span class="go">                           start:1092.0 stop:2184.0&gt;,)&quot;,</span>
<span class="go">             kwargs:&quot;{\&#39;page\&#39;: 1}&quot;}&gt;&#39;,</span>
<span class="go">        &#39;1. 2010-05-12 11:12:00 pri0 &lt;TaskRequest</span>
<span class="go">            {name:&quot;opalfeeds.tasks.refresh_feed_slice&quot;,</span>
<span class="go">             id:&quot;ab8bc59e-6cf8-44b8-88d0-f1af57789758&quot;,</span>
<span class="go">             args:&quot;(&lt;Feeds freq_max:3600 freq_min:60</span>
<span class="go">                           start:3276.0 stop:4365&gt;,)&quot;,</span>
<span class="go">             kwargs:&quot;{\&#39;page\&#39;: 3}&quot;}&gt;&#39;]}]</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="v103-fixes">
<span id="id59"></span><h3><a class="toc-backref" href="#id168">Fixes</a><a class="headerlink" href="#v103-fixes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Mediator thread no longer blocks for more than 1 second.</p>
<blockquote>
<div><p>With rate limits enabled and when there was a lot of remaining time,
the mediator thread could block shutdown (and potentially block other
jobs from coming in).</p>
</div></blockquote>
</li>
<li><p class="first">Remote rate limits was not properly applied (<a class="reference external" href="https://github.com/ask/celery/issues/98" title="celery.task.control.rate_limit does not affect worker processes"><span class="xref issue closed">Issue #98</span></a>).</p>
</li>
<li><p class="first">Now handles exceptions with Unicode messages correctly in
<cite>TaskRequest.on_failure</cite>.</p>
</li>
<li><p class="first">Database backend: <cite>TaskMeta.result</cite>: default value should be <cite>None</cite>
not empty string.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="version-1-0-2">
<span id="id60"></span><h2><a class="toc-backref" href="#id169">1.0.2</a><a class="headerlink" href="#version-1-0-2" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-03-31 12:50 P.M CET</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">Deprecated: <tt class="xref std std-setting docutils literal"><span class="pre">CELERY_BACKEND</span></tt>, please use
<a class="reference internal" href="configuration.html#std:setting-CELERY_RESULT_BACKEND"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_RESULT_BACKEND</span></tt></a> instead.</p>
</li>
<li><p class="first">We now use a custom logger in tasks. This logger supports task magic
keyword arguments in formats.</p>
<blockquote>
<div><p>The default format for tasks (<a class="reference internal" href="configuration.html#std:setting-CELERYD_TASK_LOG_FORMAT"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_TASK_LOG_FORMAT</span></tt></a>) now
includes the id and the name of tasks so the origin of task log messages
can easily be traced.</p>
<dl class="docutils">
<dt>Example output::</dt>
<dd><dl class="first last docutils">
<dt>[2010-03-25 13:11:20,317: INFO/PoolWorker-1]</dt>
<dd><p class="first last">[tasks.add(a6e1c5ad-60d9-42a0-8b24-9e39363125a4)] Hello from add</p>
</dd>
</dl>
</dd>
</dl>
<p>To revert to the previous behavior you can set:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERYD_TASK_LOG_FORMAT</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    [</span><span class="si">%(asctime)s</span><span class="s">: </span><span class="si">%(levelname)s</span><span class="s">/</span><span class="si">%(processName)s</span><span class="s">] </span><span class="si">%(message)s</span><span class="s"></span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Unit tests: Don&#8217;t disable the django test database tear down,
instead fixed the underlying issue which was caused by modifications
to the <cite>DATABASE_NAME</cite> setting (<a class="reference external" href="https://github.com/ask/celery/issues/82" title="Celery stops manage.py test from destroying the test database"><span class="xref issue closed">Issue #82</span></a>).</p>
</li>
<li><p class="first">Django Loader: New config <tt class="xref std std-setting docutils literal"><span class="pre">CELERY_DB_REUSE_MAX</span></tt> (max number of
tasks to reuse the same database connection)</p>
<blockquote>
<div><p>The default is to use a new connection for every task.
We would very much like to reuse the connection, but a safe number of
reuses is not known, and we don&#8217;t have any way to handle the errors
that might happen, which may even be database dependent.</p>
<p>See: <a class="reference external" href="http://bit.ly/94fwdd">http://bit.ly/94fwdd</a></p>
</div></blockquote>
</li>
<li><p class="first">celeryd: The worker components are now configurable: <a class="reference internal" href="configuration.html#std:setting-CELERYD_POOL"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_POOL</span></tt></a>,
<a class="reference internal" href="configuration.html#std:setting-CELERYD_CONSUMER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_CONSUMER</span></tt></a>, <a class="reference internal" href="configuration.html#std:setting-CELERYD_MEDIATOR"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_MEDIATOR</span></tt></a>, and
<a class="reference internal" href="configuration.html#std:setting-CELERYD_ETA_SCHEDULER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_ETA_SCHEDULER</span></tt></a>.</p>
<blockquote>
<div><p>The default configuration is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERYD_POOL</span> <span class="o">=</span> <span class="s">&quot;celery.concurrency.processes.TaskPool&quot;</span>
<span class="n">CELERYD_MEDIATOR</span> <span class="o">=</span> <span class="s">&quot;celery.worker.controllers.Mediator&quot;</span>
<span class="n">CELERYD_ETA_SCHEDULER</span> <span class="o">=</span> <span class="s">&quot;celery.worker.controllers.ScheduleController&quot;</span>
<span class="n">CELERYD_CONSUMER</span> <span class="o">=</span> <span class="s">&quot;celery.worker.consumer.Consumer&quot;</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="configuration.html#std:setting-CELERYD_POOL"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_POOL</span></tt></a> setting makes it easy to swap out the
multiprocessing pool with a threaded pool, or how about a
twisted/eventlet pool?</p>
<p>Consider the competition for the first pool plug-in started!</p>
</div></blockquote>
</li>
<li><p class="first">Debian init scripts: Use <cite>-a</cite> not <cite>&amp;&amp;</cite> (<a class="reference external" href="https://github.com/ask/celery/issues/82" title="Celery stops manage.py test from destroying the test database"><span class="xref issue closed">Issue #82</span></a>).</p>
</li>
<li><p class="first">Debian init scripts: Now always preserves <cite>$CELERYD_OPTS</cite> from the
<cite>/etc/default/celeryd</cite> and <cite>/etc/default/celerybeat</cite>.</p>
</li>
<li><p class="first">celery.beat.Scheduler: Fixed a bug where the schedule was not properly
flushed to disk if the schedule had not been properly initialized.</p>
</li>
<li><p class="first">celerybeat: Now syncs the schedule to disk when receiving the <tt class="xref std std-sig docutils literal"><span class="pre">SIGTERM</span></tt>
and <tt class="xref std std-sig docutils literal"><span class="pre">SIGINT</span></tt> signals.</p>
</li>
<li><p class="first">Control commands: Make sure keywords arguments are not in Unicode.</p>
</li>
<li><p class="first">ETA scheduler: Was missing a logger object, so the scheduler crashed
when trying to log that a task had been revoked.</p>
</li>
<li><p class="first">management.commands.camqadm: Fixed typo <cite>camqpadm</cite> -&gt; <cite>camqadm</cite>
(<a class="reference external" href="https://github.com/ask/celery/issues/83" title="Typo in camqadm management command"><span class="xref issue closed">Issue #83</span></a>).</p>
</li>
<li><p class="first">PeriodicTask.delta_resolution: Was not working for days and hours, now fixed
by rounding to the nearest day/hour.</p>
</li>
<li><p class="first">Fixed a potential infinite loop in <cite>BaseAsyncResult.__eq__</cite>, although
there is no evidence that it has ever been triggered.</p>
</li>
<li><p class="first">celeryd: Now handles messages with encoding problems by acking them and
emitting an error message.</p>
</li>
</ul>
</div>
<div class="section" id="version-1-0-1">
<span id="id61"></span><h2><a class="toc-backref" href="#id170">1.0.1</a><a class="headerlink" href="#version-1-0-1" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-02-24 07:05 P.M CET</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">Tasks are now acknowledged early instead of late.</p>
<blockquote>
<div><p>This is done because messages can only be acknowledged within the same
connection channel, so if the connection is lost we would have to refetch
the message again to acknowledge it.</p>
<p>This might or might not affect you, but mostly those running tasks with a
really long execution time are affected, as all tasks that has made it
all the way into the pool needs to be executed before the worker can
safely terminate (this is at most the number of pool workers, multiplied
by the <a class="reference internal" href="configuration.html#std:setting-CELERYD_PREFETCH_MULTIPLIER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_PREFETCH_MULTIPLIER</span></tt></a> setting.)</p>
<p>We multiply the prefetch count by default to increase the performance at
times with bursts of tasks with a short execution time. If this doesn&#8217;t
apply to your use case, you should be able to set the prefetch multiplier
to zero, without sacrificing performance.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A patch to <tt class="xref py py-mod docutils literal"><span class="pre">multiprocessing</span></tt> is currently being
worked on, this patch would enable us to use a better solution, and is
scheduled for inclusion in the <cite>2.0.0</cite> release.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">celeryd now shutdowns cleanly when receiving the <tt class="xref std std-sig docutils literal"><span class="pre">SIGTERM</span></tt> signal.</p>
</li>
<li><p class="first">celeryd now does a cold shutdown if the <tt class="xref std std-sig docutils literal"><span class="pre">SIGINT</span></tt> signal is received (Ctrl+C),
this means it tries to terminate as soon as possible.</p>
</li>
<li><p class="first">Caching of results now moved to the base backend classes, so no need
to implement this functionality in the base classes.</p>
</li>
<li><p class="first">Caches are now also limited in size, so their memory usage doesn&#8217;t grow
out of control.</p>
<blockquote>
<div><p>You can set the maximum number of results the cache
can hold using the <a class="reference internal" href="configuration.html#std:setting-CELERY_MAX_CACHED_RESULTS"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_MAX_CACHED_RESULTS</span></tt></a> setting (the
default is five thousand results). In addition, you can refetch already
retrieved results using <cite>backend.reload_task_result</cite> +
<cite>backend.reload_taskset_result</cite> (that&#8217;s for those who want to send
results incrementally).</p>
</div></blockquote>
</li>
<li><p class="first"><cite>celeryd</cite> now works on Windows again.</p>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>If you&#8217;re using Celery with Django, you can&#8217;t use <cite>project.settings</cite>
as the settings module name, but the following should work:</p>
<div class="last highlight-python"><pre>$ python manage.py celeryd --settings=settings</pre>
</div>
</div>
</div></blockquote>
</li>
<li><p class="first">Execution: <cite>.messaging.TaskPublisher.send_task</cite> now
incorporates all the functionality apply_async previously did.</p>
<blockquote>
<div><p>Like converting countdowns to eta, so <tt class="xref py py-func docutils literal"><span class="pre">celery.execute.apply_async()</span></tt> is
now simply a convenient front-end to
<tt class="xref py py-meth docutils literal"><span class="pre">celery.messaging.TaskPublisher.send_task()</span></tt>, using
the task classes default options.</p>
<p>Also <tt class="xref py py-func docutils literal"><span class="pre">celery.execute.send_task()</span></tt> has been
introduced, which can apply tasks using just the task name (useful
if the client does not have the destination task in its task registry).</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.execute</span> <span class="kn">import</span> <span class="n">send_task</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">send_task</span><span class="p">(</span><span class="s">&quot;celery.ping&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">&#39;pong&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><cite>camqadm</cite>: This is a new utility for command line access to the AMQP API.</p>
<blockquote>
<div><p>Excellent for deleting queues/bindings/exchanges, experimentation and
testing:</p>
<div class="highlight-python"><pre>$ camqadm
1&gt; help</pre>
</div>
<p>Gives an interactive shell, type <cite>help</cite> for a list of commands.</p>
<p>When using Django, use the management command instead:</p>
<div class="highlight-python"><pre>$ python manage.py camqadm
1&gt; help</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Redis result backend: To conform to recent Redis API changes, the following
settings has been deprecated:</p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li><cite>REDIS_TIMEOUT</cite></li>
<li><cite>REDIS_CONNECT_RETRY</cite></li>
</ul>
</div></blockquote>
<p>These will emit a <cite>DeprecationWarning</cite> if used.</p>
<p>A <cite>REDIS_PASSWORD</cite> setting has been added, so you can use the new
simple authentication mechanism in Redis.</p>
</div></blockquote>
</li>
<li><p class="first">The redis result backend no longer calls <cite>SAVE</cite> when disconnecting,
as this is apparently better handled by Redis itself.</p>
</li>
<li><p class="first">If <cite>settings.DEBUG</cite> is on, celeryd now warns about the possible
memory leak it can result in.</p>
</li>
<li><p class="first">The ETA scheduler now sleeps at most two seconds between iterations.</p>
</li>
<li><p class="first">The ETA scheduler now deletes any revoked tasks it might encounter.</p>
<blockquote>
<div><p>As revokes are not yet persistent, this is done to make sure the task
is revoked even though it&#8217;s currently being hold because its eta is e.g.
a week into the future.</p>
</div></blockquote>
</li>
<li><p class="first">The <cite>task_id</cite> argument is now respected even if the task is executed
eagerly (either using apply, or <a class="reference internal" href="configuration.html#std:setting-CELERY_ALWAYS_EAGER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_ALWAYS_EAGER</span></tt></a>).</p>
</li>
<li><p class="first">The internal queues are now cleared if the connection is reset.</p>
</li>
<li><p class="first">New magic keyword argument: <cite>delivery_info</cite>.</p>
<blockquote>
<div><p>Used by retry() to resend the task to its original destination using the same
exchange/routing_key.</p>
</div></blockquote>
</li>
<li><p class="first">Events: Fields was not passed by <cite>.send()</cite> (fixes the UUID key errors
in celerymon)</p>
</li>
<li><p class="first">Added <cite>&#8211;schedule</cite>/<cite>-s</cite> option to celeryd, so it is possible to
specify a custom schedule filename when using an embedded celerybeat
server (the <cite>-B</cite>/<cite>&#8211;beat</cite>) option.</p>
</li>
<li><p class="first">Better Python 2.4 compatibility. The test suite now passes.</p>
</li>
<li><p class="first">task decorators: Now preserve docstring as <cite>cls.__doc__</cite>, (was previously
copied to <cite>cls.run.__doc__</cite>)</p>
</li>
<li><p class="first">The <cite>testproj</cite> directory has been renamed to <cite>tests</cite> and we&#8217;re now using
<cite>nose</cite> + <cite>django-nose</cite> for test discovery, and <cite>unittest2</cite> for test
cases.</p>
</li>
<li><p class="first">New pip requirements files available in <cite>contrib/requirements</cite>.</p>
</li>
<li><p class="first">TaskPublisher: Declarations are now done once (per process).</p>
</li>
<li><p class="first">Added <cite>Task.delivery_mode</cite> and the <a class="reference internal" href="configuration.html#std:setting-CELERY_DEFAULT_DELIVERY_MODE"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_DEFAULT_DELIVERY_MODE</span></tt></a>
setting.</p>
<blockquote>
<div><p>These can be used to mark messages non-persistent (i.e. so they are
lost if the broker is restarted).</p>
</div></blockquote>
</li>
<li><p class="first">Now have our own <cite>ImproperlyConfigured</cite> exception, instead of using the
Django one.</p>
</li>
<li><p class="first">Improvements to the Debian init scripts: Shows an error if the program is
not executable.  Does not modify <cite>CELERYD</cite> when using django with
virtualenv.</p>
</li>
</ul>
</div>
<div class="section" id="version-1-0-0">
<span id="id62"></span><h2><a class="toc-backref" href="#id171">1.0.0</a><a class="headerlink" href="#version-1-0-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-02-10 04:00 P.M CET</td>
</tr>
</tbody>
</table>
<div class="section" id="v100-incompatible">
<span id="id63"></span><h3><a class="toc-backref" href="#id172">Backward incompatible changes</a><a class="headerlink" href="#v100-incompatible" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Celery does not support detaching anymore, so you have to use the tools
available on your platform, or something like Supervisord to make
celeryd/celerybeat/celerymon into background processes.</p>
<blockquote>
<div><p>We&#8217;ve had too many problems with celeryd daemonizing itself, so it was
decided it has to be removed. Example startup scripts has been added to
<cite>contrib/</cite>:</p>
<ul>
<li><p class="first">Debian, Ubuntu, (start-stop-daemon)</p>
<blockquote>
<div><p><cite>contrib/debian/init.d/celeryd</cite>
<cite>contrib/debian/init.d/celerybeat</cite></p>
</div></blockquote>
</li>
<li><p class="first">Mac OS X launchd</p>
<blockquote>
<div><p><cite>contrib/mac/org.celeryq.celeryd.plist</cite>
<cite>contrib/mac/org.celeryq.celerybeat.plist</cite>
<cite>contrib/mac/org.celeryq.celerymon.plist</cite></p>
</div></blockquote>
</li>
<li><p class="first">Supervisord (<a class="reference external" href="http://supervisord.org">http://supervisord.org</a>)</p>
<blockquote>
<div><p><cite>contrib/supervisord/supervisord.conf</cite></p>
</div></blockquote>
</li>
</ul>
<p>In addition to <cite>&#8211;detach</cite>, the following program arguments has been
removed: <cite>&#8211;uid</cite>, <cite>&#8211;gid</cite>, <cite>&#8211;workdir</cite>, <cite>&#8211;chroot</cite>, <cite>&#8211;pidfile</cite>,
<cite>&#8211;umask</cite>. All good daemonization tools should support equivalent
functionality, so don&#8217;t worry.</p>
<p>Also the following configuration keys has been removed:
<cite>CELERYD_PID_FILE</cite>, <cite>CELERYBEAT_PID_FILE</cite>, <cite>CELERYMON_PID_FILE</cite>.</p>
</div></blockquote>
</li>
<li><p class="first">Default celeryd loglevel is now <cite>WARN</cite>, to enable the previous log level
start celeryd with <cite>&#8211;loglevel=INFO</cite>.</p>
</li>
<li><p class="first">Tasks are automatically registered.</p>
<blockquote>
<div><p>This means you no longer have to register your tasks manually.
You don&#8217;t have to change your old code right away, as it doesn&#8217;t matter if
a task is registered twice.</p>
<p>If you don&#8217;t want your task to be automatically registered you can set
the <cite>abstract</cite> attribute</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="n">abstract</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>By using <cite>abstract</cite> only tasks subclassing this task will be automatically
registered (this works like the Django ORM).</p>
<p>If you don&#8217;t want subclasses to be registered either, you can set the
<cite>autoregister</cite> attribute to <cite>False</cite>.</p>
<p>Incidentally, this change also fixes the problems with automatic name
assignment and relative imports. So you also don&#8217;t have to specify a task name
anymore if you use relative imports.</p>
</div></blockquote>
</li>
<li><p class="first">You can no longer use regular functions as tasks.</p>
<blockquote>
<div><p>This change was added
because it makes the internals a lot more clean and simple. However, you can
now turn functions into tasks by using the <cite>&#64;task</cite> decorator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery.decorators</span> <span class="kn">import</span> <span class="n">task</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="userguide/tasks.html#guide-tasks"><em>Tasks</em></a> for more information about the task decorators.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">The periodic task system has been rewritten to a centralized solution.</p>
<blockquote>
<div><p>This means <cite>celeryd</cite> no longer schedules periodic tasks by default,
but a new daemon has been introduced: <cite>celerybeat</cite>.</p>
<p>To launch the periodic task scheduler you have to run celerybeat:</p>
<div class="highlight-python"><pre>$ celerybeat</pre>
</div>
<p>Make sure this is running on one server only, if you run it twice, all
periodic tasks will also be executed twice.</p>
<p>If you only have one worker server you can embed it into celeryd like this:</p>
<div class="highlight-python"><pre>$ celeryd --beat # Embed celerybeat in celeryd.</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">The supervisor has been removed.</p>
<blockquote>
<div><p>This means the <cite>-S</cite> and <cite>&#8211;supervised</cite> options to <cite>celeryd</cite> is
no longer supported. Please use something like <a class="reference external" href="http://supervisord.org">http://supervisord.org</a>
instead.</p>
</div></blockquote>
</li>
<li><p class="first"><cite>TaskSet.join</cite> has been removed, use <cite>TaskSetResult.join</cite> instead.</p>
</li>
<li><p class="first">The task status <cite>&#8220;DONE&#8221;</cite> has been renamed to <cite>&#8220;SUCCESS&#8221;</cite>.</p>
</li>
<li><p class="first"><cite>AsyncResult.is_done</cite> has been removed, use <cite>AsyncResult.successful</cite>
instead.</p>
</li>
<li><p class="first">The worker no longer stores errors if <cite>Task.ignore_result</cite> is set, to
revert to the previous behaviour set
<a class="reference internal" href="configuration.html#std:setting-CELERY_STORE_ERRORS_EVEN_IF_IGNORED"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_STORE_ERRORS_EVEN_IF_IGNORED</span></tt></a> to <cite>True</cite>.</p>
</li>
<li><p class="first">The statistics functionality has been removed in favor of events,
so the <cite>-S</cite> and &#8211;statistics` switches has been removed.</p>
</li>
<li><p class="first">The module <cite>celery.task.strategy</cite> has been removed.</p>
</li>
<li><p class="first"><cite>celery.discovery</cite> has been removed, and it&#8217;s <cite>autodiscover</cite> function is
now in <cite>celery.loaders.djangoapp</cite>. Reason: Internal API.</p>
</li>
<li><p class="first">The <span class="target" id="index-4"></span><tt class="xref std std-envvar docutils literal"><span class="pre">CELERY_LOADER</span></tt> environment variable now needs loader class name
in addition to module name,</p>
<blockquote>
<div><p>E.g. where you previously had: <cite>&#8220;celery.loaders.default&#8221;</cite>, you now need
<cite>&#8220;celery.loaders.default.Loader&#8221;</cite>, using the previous syntax will result
in a <cite>DeprecationWarning</cite>.</p>
</div></blockquote>
</li>
<li><p class="first">Detecting the loader is now lazy, and so is not done when importing
<cite>celery.loaders</cite>.</p>
<blockquote>
<div><p>To make this happen <cite>celery.loaders.settings</cite> has
been renamed to <cite>load_settings</cite> and is now a function returning the
settings object. <cite>celery.loaders.current_loader</cite> is now also
a function, returning the current loader.</p>
<p>So:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">loader</span> <span class="o">=</span> <span class="n">current_loader</span>
</pre></div>
</div>
<p>needs to be changed to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">loader</span> <span class="o">=</span> <span class="n">current_loader</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="deprecations">
<span id="v100-deprecations"></span><h3><a class="toc-backref" href="#id173">Deprecations</a><a class="headerlink" href="#deprecations" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">The following configuration variables has been renamed and will be
deprecated in v2.0:</p>
<blockquote>
<div><ul class="simple">
<li>CELERYD_DAEMON_LOG_FORMAT -&gt; CELERYD_LOG_FORMAT</li>
<li>CELERYD_DAEMON_LOG_LEVEL -&gt; CELERYD_LOG_LEVEL</li>
<li>CELERY_AMQP_CONNECTION_TIMEOUT -&gt; CELERY_BROKER_CONNECTION_TIMEOUT</li>
<li>CELERY_AMQP_CONNECTION_RETRY -&gt; CELERY_BROKER_CONNECTION_RETRY</li>
<li>CELERY_AMQP_CONNECTION_MAX_RETRIES -&gt; CELERY_BROKER_CONNECTION_MAX_RETRIES</li>
<li>SEND_CELERY_TASK_ERROR_EMAILS -&gt; CELERY_SEND_TASK_ERROR_EMAILS</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">The public API names in celery.conf has also changed to a consistent naming
scheme.</p>
</li>
<li><p class="first">We now support consuming from an arbitrary number of queues.</p>
<blockquote>
<div><p>To do this we had to rename the configuration syntax. If you use any of
the custom AMQP routing options (queue/exchange/routing_key, etc.), you
should read the new FAQ entry: <a class="reference external" href="http://bit.ly/aiWoH">http://bit.ly/aiWoH</a>.</p>
<p>The previous syntax is deprecated and scheduled for removal in v2.0.</p>
</div></blockquote>
</li>
<li><p class="first"><cite>TaskSet.run</cite> has been renamed to <cite>TaskSet.apply_async</cite>.</p>
<blockquote>
<div><p><cite>TaskSet.run</cite> has now been deprecated, and is scheduled for
removal in v2.0.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id64">
<h3><a class="toc-backref" href="#id174">News</a><a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Rate limiting support (per task type, or globally).</p>
</li>
<li><p class="first">New periodic task system.</p>
</li>
<li><p class="first">Automatic registration.</p>
</li>
<li><p class="first">New cool task decorator syntax.</p>
</li>
<li><p class="first">celeryd now sends events if enabled with the <cite>-E</cite> argument.</p>
<blockquote>
<div><p>Excellent for monitoring tools, one is already in the making
(<a class="reference external" href="http://github.com/ask/celerymon">http://github.com/ask/celerymon</a>).</p>
<p>Current events include: worker-heartbeat,
task-[received/succeeded/failed/retried],
worker-online, worker-offline.</p>
</div></blockquote>
</li>
<li><p class="first">You can now delete (revoke) tasks that has already been applied.</p>
</li>
<li><p class="first">You can now set the hostname celeryd identifies as using the <cite>&#8211;hostname</cite>
argument.</p>
</li>
<li><p class="first">Cache backend now respects the <a class="reference internal" href="configuration.html#std:setting-CELERY_TASK_RESULT_EXPIRES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_RESULT_EXPIRES</span></tt></a> setting.</p>
</li>
<li><p class="first">Message format has been standardized and now uses ISO-8601 format
for dates instead of datetime.</p>
</li>
<li><p class="first"><cite>celeryd</cite> now responds to the <tt class="xref std std-sig docutils literal"><span class="pre">SIGHUP</span></tt> signal by restarting itself.</p>
</li>
<li><p class="first">Periodic tasks are now scheduled on the clock.</p>
<blockquote>
<div><p>I.e. <cite>timedelta(hours=1)</cite> means every hour at :00 minutes, not every
hour from the server starts.  To revert to the previous behaviour you
can set <cite>PeriodicTask.relative = True</cite>.</p>
</div></blockquote>
</li>
<li><p class="first">Now supports passing execute options to a TaskSets list of args, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">TaskSet</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="p">[([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">{},</span> <span class="p">{</span><span class="s">&quot;countdown&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}),</span>
<span class="gp">... </span>                  <span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">{},</span> <span class="p">{</span><span class="s">&quot;countdown&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}),</span>
<span class="gp">... </span>                  <span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="p">{},</span> <span class="p">{</span><span class="s">&quot;countdown&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first">Got a 3x performance gain by setting the prefetch count to four times the
concurrency, (from an average task round-trip of 0.1s to 0.03s!).</p>
<blockquote>
<div><p>A new setting has been added: <a class="reference internal" href="configuration.html#std:setting-CELERYD_PREFETCH_MULTIPLIER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_PREFETCH_MULTIPLIER</span></tt></a>, which
is set to <cite>4</cite> by default.</p>
</div></blockquote>
</li>
<li><p class="first">Improved support for webhook tasks.</p>
<blockquote>
<div><p><cite>celery.task.rest</cite> is now deprecated, replaced with the new and shiny
<a class="reference internal" href="userguide/remote-tasks.html#module-celery.task.http" title="celery.task.http"><tt class="xref py py-mod docutils literal"><span class="pre">celery.task.http</span></tt></a>. With more reflective names, sensible interface,
and it&#8217;s possible to override the methods used to perform HTTP requests.</p>
</div></blockquote>
</li>
<li><p class="first">The results of task sets are now cached by storing it in the result
backend.</p>
</li>
</ul>
</div>
<div class="section" id="v100-changes">
<span id="id65"></span><h3><a class="toc-backref" href="#id175">Changes</a><a class="headerlink" href="#v100-changes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Now depends on carrot &gt;= 0.8.1</p>
</li>
<li><p class="first">New dependencies: billiard, python-dateutil, django-picklefield</p>
</li>
<li><p class="first">No longer depends on python-daemon</p>
</li>
<li><p class="first">The <cite>uuid</cite> distribution is added as a dependency when running Python 2.4.</p>
</li>
<li><p class="first">Now remembers the previously detected loader by keeping it in
the <span class="target" id="index-5"></span><tt class="xref std std-envvar docutils literal"><span class="pre">CELERY_LOADER</span></tt> environment variable.</p>
<blockquote>
<div><p>This may help on windows where fork emulation is used.</p>
</div></blockquote>
</li>
<li><p class="first">ETA no longer sends datetime objects, but uses ISO 8601 date format in a
string for better compatibility with other platforms.</p>
</li>
<li><p class="first">No longer sends error mails for retried tasks.</p>
</li>
<li><p class="first">Task can now override the backend used to store results.</p>
</li>
<li><p class="first">Refactored the ExecuteWrapper, <cite>apply</cite> and <a class="reference internal" href="configuration.html#std:setting-CELERY_ALWAYS_EAGER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_ALWAYS_EAGER</span></tt></a>
now also executes the task callbacks and signals.</p>
</li>
<li><p class="first">Now using a proper scheduler for the tasks with an ETA.</p>
<blockquote>
<div><p>This means waiting eta tasks are sorted by time, so we don&#8217;t have
to poll the whole list all the time.</p>
</div></blockquote>
</li>
<li><p class="first">Now also imports modules listed in <a class="reference internal" href="configuration.html#std:setting-CELERY_IMPORTS"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_IMPORTS</span></tt></a> when running
with django (as documented).</p>
</li>
<li><p class="first">Log level for stdout/stderr changed from INFO to ERROR</p>
</li>
<li><p class="first">ImportErrors are now properly propagated when autodiscovering tasks.</p>
</li>
<li><p class="first">You can now use <cite>celery.messaging.establish_connection</cite> to establish a
connection to the broker.</p>
</li>
<li><p class="first">When running as a separate service the periodic task scheduler does some
smart moves to not poll too regularly.</p>
<blockquote>
<div><p>If you need faster poll times you can lower the value
of <a class="reference internal" href="configuration.html#std:setting-CELERYBEAT_MAX_LOOP_INTERVAL"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYBEAT_MAX_LOOP_INTERVAL</span></tt></a>.</p>
</div></blockquote>
</li>
<li><p class="first">You can now change periodic task intervals at runtime, by making
<cite>run_every</cite> a property, or subclassing <cite>PeriodicTask.is_due</cite>.</p>
</li>
<li><p class="first">The worker now supports control commands enabled through the use of a
broadcast queue, you can remotely revoke tasks or set the rate limit for
a task type. See <a class="reference internal" href="reference/celery.task.control.html#module-celery.task.control" title="celery.task.control"><tt class="xref py py-mod docutils literal"><span class="pre">celery.task.control</span></tt></a>.</p>
</li>
<li><p class="first">The services now sets informative process names (as shown in <cite>ps</cite>
listings) if the <tt class="xref py py-mod docutils literal"><span class="pre">setproctitle</span></tt> module is installed.</p>
</li>
<li><p class="first"><a class="reference internal" href="reference/celery.exceptions.html#celery.exceptions.NotRegistered" title="celery.exceptions.NotRegistered"><tt class="xref py py-exc docutils literal"><span class="pre">celery.exceptions.NotRegistered</span></tt></a> now inherits from <tt class="xref py py-exc docutils literal"><span class="pre">KeyError</span></tt>,
and <cite>TaskRegistry.__getitem__`+`pop</cite> raises <cite>NotRegistered</cite> instead</p>
</li>
<li><p class="first">You can set the loader via the <span class="target" id="index-6"></span><tt class="xref std std-envvar docutils literal"><span class="pre">CELERY_LOADER</span></tt> environment variable.</p>
</li>
<li><p class="first">You can now set <a class="reference internal" href="configuration.html#std:setting-CELERY_IGNORE_RESULT"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_IGNORE_RESULT</span></tt></a> to ignore task results by
default (if enabled, tasks doesn&#8217;t save results or errors to the backend used).</p>
</li>
<li><p class="first">celeryd now correctly handles malformed messages by throwing away and
acknowledging the message, instead of crashing.</p>
</li>
</ul>
</div>
<div class="section" id="bugs">
<span id="v100-bugs"></span><h3><a class="toc-backref" href="#id176">Bugs</a><a class="headerlink" href="#bugs" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fixed a race condition that could happen while storing task results in the
database.</li>
</ul>
</div>
<div class="section" id="v100-documentation">
<span id="id66"></span><h3><a class="toc-backref" href="#id177">Documentation</a><a class="headerlink" href="#v100-documentation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Reference now split into two sections; API reference and internal module
reference.</li>
</ul>
</div>
</div>
<div class="section" id="version-0-8-4">
<span id="id67"></span><h2><a class="toc-backref" href="#id178">0.8.4</a><a class="headerlink" href="#version-0-8-4" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2010-02-05 01:52 P.M CEST</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Now emits a warning if the &#8211;detach argument is used.
&#8211;detach should not be used anymore, as it has several not easily fixed
bugs related to it. Instead, use something like start-stop-daemon,
Supervisord or launchd (os x).</li>
<li>Make sure logger class is process aware, even if running Python &gt;= 2.6.</li>
<li>Error emails are not sent anymore when the task is retried.</li>
</ul>
</div>
<div class="section" id="version-0-8-3">
<span id="id68"></span><h2><a class="toc-backref" href="#id179">0.8.3</a><a class="headerlink" href="#version-0-8-3" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-12-22 09:43 A.M CEST</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Fixed a possible race condition that could happen when storing/querying
task results using the database backend.</li>
<li>Now has console script entry points in the setup.py file, so tools like
Buildout will correctly install the programs celeryd and celeryinit.</li>
</ul>
</div>
<div class="section" id="version-0-8-2">
<span id="id69"></span><h2><a class="toc-backref" href="#id180">0.8.2</a><a class="headerlink" href="#version-0-8-2" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-11-20 03:40 P.M CEST</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>QOS Prefetch count was not applied properly, as it was set for every message
received (which apparently behaves like, &#8220;receive one more&#8221;), instead of only
set when our wanted value changed.</li>
</ul>
</div>
<div class="section" id="version-0-8-1">
<span id="id70"></span><h2><a class="toc-backref" href="#id181">0.8.1</a><a class="headerlink" href="#version-0-8-1" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-11-16 05:21 P.M CEST</td>
</tr>
</tbody>
</table>
<div class="section" id="very-important-note">
<span id="v081-very-important"></span><h3><a class="toc-backref" href="#id182">Very important note</a><a class="headerlink" href="#very-important-note" title="Permalink to this headline">¶</a></h3>
<p>This release (with carrot 0.8.0) enables AMQP QoS (quality of service), which
means the workers will only receive as many messages as it can handle at a
time. As with any release, you should test this version upgrade on your
development servers before rolling it out to production!</p>
</div>
<div class="section" id="important-changes">
<span id="v081-important"></span><h3><a class="toc-backref" href="#id183">Important changes</a><a class="headerlink" href="#important-changes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">If you&#8217;re using Python &lt; 2.6 and you use the multiprocessing backport, then
multiprocessing version 2.6.2.1 is required.</p>
</li>
<li><p class="first">All AMQP_* settings has been renamed to BROKER_*, and in addition
AMQP_SERVER has been renamed to BROKER_HOST, so before where you had:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">AMQP_SERVER</span> <span class="o">=</span> <span class="s">&quot;localhost&quot;</span>
<span class="n">AMQP_PORT</span> <span class="o">=</span> <span class="mi">5678</span>
<span class="n">AMQP_USER</span> <span class="o">=</span> <span class="s">&quot;myuser&quot;</span>
<span class="n">AMQP_PASSWORD</span> <span class="o">=</span> <span class="s">&quot;mypassword&quot;</span>
<span class="n">AMQP_VHOST</span> <span class="o">=</span> <span class="s">&quot;celery&quot;</span>
</pre></div>
</div>
<p>You need to change that to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">BROKER_HOST</span> <span class="o">=</span> <span class="s">&quot;localhost&quot;</span>
<span class="n">BROKER_PORT</span> <span class="o">=</span> <span class="mi">5678</span>
<span class="n">BROKER_USER</span> <span class="o">=</span> <span class="s">&quot;myuser&quot;</span>
<span class="n">BROKER_PASSWORD</span> <span class="o">=</span> <span class="s">&quot;mypassword&quot;</span>
<span class="n">BROKER_VHOST</span> <span class="o">=</span> <span class="s">&quot;celery&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Custom carrot backends now need to include the backend class name, so before
where you had:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CARROT_BACKEND</span> <span class="o">=</span> <span class="s">&quot;mycustom.backend.module&quot;</span>
</pre></div>
</div>
<p>you need to change it to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CARROT_BACKEND</span> <span class="o">=</span> <span class="s">&quot;mycustom.backend.module.Backend&quot;</span>
</pre></div>
</div>
<p>where <cite>Backend</cite> is the class name. This is probably <cite>&#8220;Backend&#8221;</cite>, as
that was the previously implied name.</p>
</li>
<li><p class="first">New version requirement for carrot: 0.8.0</p>
</li>
</ul>
</div>
<div class="section" id="v081-changes">
<span id="id71"></span><h3><a class="toc-backref" href="#id184">Changes</a><a class="headerlink" href="#v081-changes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Incorporated the multiprocessing backport patch that fixes the
<cite>processName</cite> error.</li>
<li>Ignore the result of PeriodicTask&#8217;s by default.</li>
<li>Added a Redis result store backend</li>
<li>Allow /etc/default/celeryd to define additional options for the celeryd init
script.</li>
<li>MongoDB periodic tasks issue when using different time than UTC fixed.</li>
<li>Windows specific: Negate test for available os.fork (thanks miracle2k)</li>
<li>Now tried to handle broken PID files.</li>
<li>Added a Django test runner to contrib that sets
<cite>CELERY_ALWAYS_EAGER = True</cite> for testing with the database backend.</li>
<li>Added a <a class="reference internal" href="configuration.html#std:setting-CELERY_CACHE_BACKEND"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_CACHE_BACKEND</span></tt></a> setting for using something other
than the django-global cache backend.</li>
<li>Use custom implementation of functools.partial (curry) for Python 2.4 support
(Probably still problems with running on 2.4, but it will eventually be
supported)</li>
<li>Prepare exception to pickle when saving <a class="reference internal" href="userguide/tasks.html#std:state-RETRY"><tt class="xref std std-state docutils literal"><span class="pre">RETRY</span></tt></a> status for all backends.</li>
<li>SQLite no concurrency limit should only be effective if the database backend
is used.</li>
</ul>
</div>
</div>
<div class="section" id="version-0-8-0">
<span id="id72"></span><h2><a class="toc-backref" href="#id185">0.8.0</a><a class="headerlink" href="#version-0-8-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-09-22 03:06 P.M CEST</td>
</tr>
</tbody>
</table>
<div class="section" id="v080-incompatible">
<span id="id73"></span><h3><a class="toc-backref" href="#id186">Backward incompatible changes</a><a class="headerlink" href="#v080-incompatible" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Add traceback to result value on failure.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you use the database backend you have to re-create the
database table <cite>celery_taskmeta</cite>.</p>
<p class="last">Contact the <a class="reference internal" href="getting-started/resources.html#mailing-list"><em>Mailing list</em></a> or <a class="reference internal" href="getting-started/resources.html#irc-channel"><em>IRC</em></a> channel
for help doing this.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Database tables are now only created if the database backend is used,
so if you change back to the database backend at some point,
be sure to initialize tables (django: <cite>syncdb</cite>, python: <cite>celeryinit</cite>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is only applies if using Django version 1.1 or higher.</p>
</div>
</li>
<li><p class="first">Now depends on <cite>carrot</cite> version 0.6.0.</p>
</li>
<li><p class="first">Now depends on python-daemon 1.4.8</p>
</li>
</ul>
</div>
<div class="section" id="v080-important">
<span id="id74"></span><h3><a class="toc-backref" href="#id187">Important changes</a><a class="headerlink" href="#v080-important" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Celery can now be used in pure Python (outside of a Django project).</p>
<blockquote>
<div><p>This means celery is no longer Django specific.</p>
<p>For more information see the FAQ entry
<a class="reference internal" href="faq.html#faq-is-celery-for-django-only"><em>Is Celery for Django only?</em></a>.</p>
</div></blockquote>
</li>
<li><p class="first">Celery now supports task retries.</p>
<blockquote>
<div><p>See <a class="reference external" href="http://ask.github.com/celery/cookbook/task-retries.html">Cookbook: Retrying Tasks</a> for more information.</p>
</div></blockquote>
</li>
</ul>
<ul>
<li><p class="first">We now have an AMQP result store backend.</p>
<blockquote>
<div><p>It uses messages to publish task return value and status. And it&#8217;s
incredibly fast!</p>
<p>See <a class="reference external" href="https://github.com/ask/celery/issues/6" title="RabbitMQ Result store."><span class="xref issue closed">issue #6</span></a> for more info!</p>
</div></blockquote>
</li>
<li><p class="first">AMQP QoS (prefetch count) implemented:</p>
<blockquote>
<div><p>This to not receive more messages than we can handle.</p>
</div></blockquote>
</li>
<li><p class="first">Now redirects stdout/stderr to the celeryd log file when detached</p>
</li>
<li><dl class="first docutils">
<dt>Now uses <cite>inspect.getargspec</cite> to only pass default arguments</dt>
<dd><p class="first last">the task supports.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Add Task.on_success, .on_retry, .on_failure handlers</dt>
<dd><dl class="first last docutils">
<dt>See <tt class="xref py py-meth docutils literal"><span class="pre">celery.task.base.Task.on_success()</span></tt>,</dt>
<dd><p class="first last"><tt class="xref py py-meth docutils literal"><span class="pre">celery.task.base.Task.on_retry()</span></tt>,
<tt class="xref py py-meth docutils literal"><span class="pre">celery.task.base.Task.on_failure()</span></tt>,</p>
</dd>
</dl>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>celery.utils.gen_unique_id</cite>: Workaround for</dt>
<dd><p class="first last"><a class="reference external" href="http://bugs.python.org/issue4607">http://bugs.python.org/issue4607</a></p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>You can now customize what happens at worker start, at process init, etc.,</dt>
<dd><p class="first last">by creating your own loaders. (see <a class="reference internal" href="reference/celery.loaders.default.html#module-celery.loaders.default" title="celery.loaders.default"><tt class="xref py py-mod docutils literal"><span class="pre">celery.loaders.default</span></tt></a>,
<tt class="xref py py-mod docutils literal"><span class="pre">celery.loaders.djangoapp</span></tt>, <a class="reference internal" href="reference/celery.loaders.html#module-celery.loaders" title="celery.loaders"><tt class="xref py py-mod docutils literal"><span class="pre">celery.loaders</span></tt></a>.)</p>
</dd>
</dl>
</li>
<li><p class="first">Support for multiple AMQP exchanges and queues.</p>
<blockquote>
<div><p>This feature misses documentation and tests, so anyone interested
is encouraged to improve this situation.</p>
</div></blockquote>
</li>
<li><p class="first">celeryd now survives a restart of the AMQP server!</p>
<p>Automatically re-establish AMQP broker connection if it&#8217;s lost.</p>
<p>New settings:</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>AMQP_CONNECTION_RETRY</dt>
<dd><p class="first last">Set to <cite>True</cite> to enable connection retries.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>AMQP_CONNECTION_MAX_RETRIES.</dt>
<dd><p class="first last">Maximum number of restarts before we give up. Default: <cite>100</cite>.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="v080-news">
<span id="id75"></span><h3><a class="toc-backref" href="#id188">News</a><a class="headerlink" href="#v080-news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><dl class="first docutils">
<dt>Fix an incompatibility between python-daemon and multiprocessing,</dt>
<dd><p class="first last">which resulted in the <cite>[Errno 10] No child processes</cite> problem when
detaching.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Fixed a possible DjangoUnicodeDecodeError being raised when saving pickled</dt>
<dd><p class="first last">data to Django`s memcached cache backend.</p>
</dd>
</dl>
</li>
<li><p class="first">Better Windows compatibility.</p>
</li>
<li><dl class="first docutils">
<dt>New version of the pickled field (taken from</dt>
<dd><p class="first last"><a class="reference external" href="http://www.djangosnippets.org/snippets/513/">http://www.djangosnippets.org/snippets/513/</a>)</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>New signals introduced: <cite>task_sent</cite>, <cite>task_prerun</cite> and</dt>
<dd><p class="first last"><cite>task_postrun</cite>, see <a class="reference internal" href="reference/celery.signals.html#module-celery.signals" title="celery.signals"><tt class="xref py py-mod docutils literal"><span class="pre">celery.signals</span></tt></a> for more information.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>TaskSetResult.join</cite> caused <cite>TypeError</cite> when <cite>timeout=None</cite>.</dt>
<dd><p class="first last">Thanks Jerzy Kozera.  Closes #31</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>views.apply</cite> should return <cite>HttpResponse</cite> instance.</dt>
<dd><p class="first last">Thanks to Jerzy Kozera. Closes #32</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>PeriodicTask</cite>: Save conversion of <cite>run_every</cite> from <cite>int</cite></dt>
<dd><p class="first last">to <cite>timedelta</cite> to the class attribute instead of on the instance.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Exceptions has been moved to <cite>celery.exceptions</cite>, but are still</dt>
<dd><p class="first last">available in the previous module.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Try to rollback transaction and retry saving result if an error happens</dt>
<dd><p class="first last">while setting task status with the database backend.</p>
</dd>
</dl>
</li>
<li><p class="first">jail() refactored into <tt class="xref py py-class docutils literal"><span class="pre">celery.execute.ExecuteWrapper</span></tt>.</p>
</li>
<li><p class="first"><cite>views.apply</cite> now correctly sets mime-type to &#8220;application/json&#8221;</p>
</li>
<li><p class="first"><cite>views.task_status</cite> now returns exception if state is <a class="reference internal" href="userguide/tasks.html#std:state-RETRY"><tt class="xref std std-state docutils literal"><span class="pre">RETRY</span></tt></a></p>
</li>
<li><dl class="first docutils">
<dt><cite>views.task_status</cite> now returns traceback if state is <a class="reference internal" href="userguide/tasks.html#std:state-FAILURE"><tt class="xref std std-state docutils literal"><span class="pre">FAILURE</span></tt></a></dt>
<dd><p class="first last">or <a class="reference internal" href="userguide/tasks.html#std:state-RETRY"><tt class="xref std std-state docutils literal"><span class="pre">RETRY</span></tt></a></p>
</dd>
</dl>
</li>
<li><p class="first">Documented default task arguments.</p>
</li>
<li><p class="first">Add a sensible __repr__ to ExceptionInfo for easier debugging</p>
</li>
<li><dl class="first docutils">
<dt>Fix documentation typo <cite>.. import map</cite> -&gt; <cite>.. import dmap</cite>.</dt>
<dd><p class="first last">Thanks to mikedizon</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="version-0-6-0">
<span id="id76"></span><h2><a class="toc-backref" href="#id189">0.6.0</a><a class="headerlink" href="#version-0-6-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-08-07 06:54 A.M CET</td>
</tr>
</tbody>
</table>
<div class="section" id="v060-important">
<span id="id77"></span><h3><a class="toc-backref" href="#id190">Important changes</a><a class="headerlink" href="#v060-important" title="Permalink to this headline">¶</a></h3>
<ul>
<li><dl class="first docutils">
<dt>Fixed a bug where tasks raising unpickleable exceptions crashed pool</dt>
<dd><p class="first last">workers. So if you&#8217;ve had pool workers mysteriously disappearing, or
problems with celeryd stopping working, this has been fixed in this
version.</p>
</dd>
</dl>
</li>
<li><p class="first">Fixed a race condition with periodic tasks.</p>
</li>
<li><dl class="first docutils">
<dt>The task pool is now supervised, so if a pool worker crashes,</dt>
<dd><p class="first last">goes away or stops responding, it is automatically replaced with
a new one.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Task.name is now automatically generated out of class module+name, e.g.</dt>
<dd><p class="first last"><cite>&#8220;djangotwitter.tasks.UpdateStatusesTask&#8221;</cite>. Very convenient. No idea why
we didn&#8217;t do this before. Some documentation is updated to not manually
specify a task name.</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="v060-news">
<span id="id78"></span><h3><a class="toc-backref" href="#id191">News</a><a class="headerlink" href="#v060-news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Tested with Django 1.1</p>
</li>
<li><p class="first">New Tutorial: Creating a click counter using carrot and celery</p>
</li>
<li><dl class="first docutils">
<dt>Database entries for periodic tasks are now created at <cite>celeryd</cite></dt>
<dd><p class="first last">startup instead of for each check (which has been a forgotten TODO/XXX
in the code for a long time)</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>New settings variable: <a class="reference internal" href="configuration.html#std:setting-CELERY_TASK_RESULT_EXPIRES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_RESULT_EXPIRES</span></tt></a></dt>
<dd><p class="first last">Time (in seconds, or a <cite>datetime.timedelta</cite> object) for when after
stored task results are deleted. For the moment this only works for the
database backend.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>celeryd</cite> now emits a debug log message for which periodic tasks</dt>
<dd><p class="first last">has been launched.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The periodic task table is now locked for reading while getting</dt>
<dd><p class="first last">periodic task status. (MySQL only so far, seeking patches for other
engines)</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>A lot more debugging information is now available by turning on the</dt>
<dd><p class="first last"><cite>DEBUG</cite> log level (<cite>&#8211;loglevel=DEBUG</cite>).</p>
</dd>
</dl>
</li>
<li><p class="first">Functions/methods with a timeout argument now works correctly.</p>
</li>
<li><dl class="first docutils">
<dt>New: <cite>celery.strategy.even_time_distribution</cite>:</dt>
<dd><p class="first last">With an iterator yielding task args, kwargs tuples, evenly distribute
the processing of its tasks throughout the time window available.</p>
</dd>
</dl>
</li>
<li><p class="first">Log message <cite>Unknown task ignored...</cite> now has log level <cite>ERROR</cite></p>
</li>
<li><dl class="first docutils">
<dt>Log message <cite>&#8220;Got task from broker&#8221;</cite> is now emitted for all tasks, even if</dt>
<dd><p class="first last">the task has an ETA (estimated time of arrival). Also the message now
includes the ETA for the task (if any).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Acknowledgement now happens in the pool callback. Can&#8217;t do ack in the job</dt>
<dd><p class="first last">target, as it&#8217;s not pickleable (can&#8217;t share AMQP connection, etc.)).</p>
</dd>
</dl>
</li>
<li><p class="first">Added note about .delay hanging in README</p>
</li>
<li><p class="first">Tests now passing in Django 1.1</p>
</li>
<li><p class="first">Fixed discovery to make sure app is in INSTALLED_APPS</p>
</li>
<li><dl class="first docutils">
<dt>Previously overridden pool behavior (process reap, wait until pool worker</dt>
<dd><p class="first last">available, etc.) is now handled by <cite>multiprocessing.Pool</cite> itself.</p>
</dd>
</dl>
</li>
<li><p class="first">Convert statistics data to Unicode for use as kwargs. Thanks Lucy!</p>
</li>
</ul>
</div>
</div>
<div class="section" id="version-0-4-1">
<span id="id79"></span><h2><a class="toc-backref" href="#id192">0.4.1</a><a class="headerlink" href="#version-0-4-1" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-07-02 01:42 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Fixed a bug with parsing the message options (<cite>mandatory</cite>,
<cite>routing_key</cite>, <cite>priority</cite>, <cite>immediate</cite>)</li>
</ul>
</div>
<div class="section" id="version-0-4-0">
<span id="id80"></span><h2><a class="toc-backref" href="#id193">0.4.0</a><a class="headerlink" href="#version-0-4-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-07-01 07:29 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Adds eager execution. <cite>celery.execute.apply`|`Task.apply</cite> executes the
function blocking until the task is done, for API compatibility it
returns an <cite>celery.result.EagerResult</cite> instance. You can configure
celery to always run tasks locally by setting the
<a class="reference internal" href="configuration.html#std:setting-CELERY_ALWAYS_EAGER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_ALWAYS_EAGER</span></tt></a> setting to <cite>True</cite>.</li>
<li>Now depends on <cite>anyjson</cite>.</li>
<li>99% coverage using python <cite>coverage</cite> 3.0.</li>
</ul>
</div>
<div class="section" id="version-0-3-20">
<span id="id81"></span><h2><a class="toc-backref" href="#id194">0.3.20</a><a class="headerlink" href="#version-0-3-20" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-06-25 08:42 P.M CET</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">New arguments to <cite>apply_async</cite> (the advanced version of
<cite>delay_task</cite>), <cite>countdown</cite> and <cite>eta</cite>;</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Run 10 seconds into the future.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">apply_async</span><span class="p">(</span><span class="n">MyTask</span><span class="p">,</span> <span class="n">countdown</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Run 1 day from now</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">apply_async</span><span class="p">(</span><span class="n">MyTask</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">eta</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first">Now unlinks stale PID files</p>
</li>
<li><p class="first">Lots of more tests.</p>
</li>
<li><p class="first">Now compatible with carrot &gt;= 0.5.0.</p>
</li>
<li><p class="first"><strong>IMPORTANT</strong> The <cite>subtask_ids</cite> attribute on the <cite>TaskSetResult</cite>
instance has been removed. To get this information instead use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">subtask_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">subtask</span><span class="o">.</span><span class="n">task_id</span> <span class="k">for</span> <span class="n">subtask</span> <span class="ow">in</span> <span class="n">ts_res</span><span class="o">.</span><span class="n">subtasks</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p class="first"><cite>Taskset.run()</cite> now respects extra message options from the task class.</p>
</li>
<li><p class="first">Task: Add attribute <cite>ignore_result</cite>: Don&#8217;t store the status and
return value. This means you can&#8217;t use the
<cite>celery.result.AsyncResult</cite> to check if the task is
done, or get its return value. Only use if you need the performance
and is able live without these features. Any exceptions raised will
store the return value/status as usual.</p>
</li>
<li><p class="first">Task: Add attribute <cite>disable_error_emails</cite> to disable sending error
emails for that task.</p>
</li>
<li><p class="first">Should now work on Windows (although running in the background won&#8217;t
work, so using the <cite>&#8211;detach</cite> argument results in an exception
being raised.)</p>
</li>
<li><p class="first">Added support for statistics for profiling and monitoring.
To start sending statistics start <cite>celeryd</cite> with the
<cite>&#8211;statistics option. Then after a while you can dump the results
by running `python manage.py celerystats</cite>. See
<cite>celery.monitoring</cite> for more information.</p>
</li>
<li><p class="first">The celery daemon can now be supervised (i.e. it is automatically
restarted if it crashes). To use this start celeryd with the
&#8211;supervised` option (or alternatively <cite>-S</cite>).</p>
</li>
<li><p class="first">views.apply: View applying a task. Example</p>
<blockquote>
<div><div class="highlight-python"><pre>http://e.com/celery/apply/task_name/arg1/arg2//?kwarg1=a&amp;kwarg2=b</pre>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Use with caution! Do not expose this URL to the public
without first ensuring that your code is safe!</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Refactored <cite>celery.task</cite>. It&#8217;s now split into three modules:</p>
<blockquote>
<div><ul>
<li><p class="first">celery.task</p>
<blockquote>
<div><p>Contains <cite>apply_async</cite>, <cite>delay_task</cite>, <cite>discard_all</cite>, and task
shortcuts, plus imports objects from <cite>celery.task.base</cite> and
<cite>celery.task.builtins</cite></p>
</div></blockquote>
</li>
<li><p class="first">celery.task.base</p>
<blockquote>
<div><p>Contains task base classes: <cite>Task</cite>, <cite>PeriodicTask</cite>,
<cite>TaskSet</cite>, <cite>AsynchronousMapTask</cite>, <cite>ExecuteRemoteTask</cite>.</p>
</div></blockquote>
</li>
<li><p class="first">celery.task.builtins</p>
<blockquote>
<div><p>Built-in tasks: <cite>PingTask</cite>, <cite>DeleteExpiredTaskMetaTask</cite>.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="version-0-3-7">
<span id="id82"></span><h2><a class="toc-backref" href="#id195">0.3.7</a><a class="headerlink" href="#version-0-3-7" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2008-06-16 11:41 P.M CET</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first"><strong>IMPORTANT</strong> Now uses AMQP`s <cite>basic.consume</cite> instead of
<cite>basic.get</cite>. This means we&#8217;re no longer polling the broker for
new messages.</p>
</li>
<li><p class="first"><strong>IMPORTANT</strong> Default concurrency limit is now set to the number of CPUs
available on the system.</p>
</li>
<li><p class="first"><strong>IMPORTANT</strong> <cite>tasks.register</cite>: Renamed <cite>task_name</cite> argument to
<cite>name</cite>, so</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tasks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">task_name</span><span class="o">=</span><span class="s">&quot;mytask&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>has to be replaced with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tasks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;mytask&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">The daemon now correctly runs if the pidlock is stale.</p>
</li>
<li><p class="first">Now compatible with carrot 0.4.5</p>
</li>
<li><p class="first">Default AMQP connection timeout is now 4 seconds.</p>
</li>
<li><p class="first"><cite>AsyncResult.read()</cite> was always returning <cite>True</cite>.</p>
</li>
<li><p class="first">Only use README as long_description if the file exists so easy_install
doesn&#8217;t break.</p>
</li>
<li><p class="first"><cite>celery.view</cite>: JSON responses now properly set its mime-type.</p>
</li>
<li><p class="first"><cite>apply_async</cite> now has a <cite>connection</cite> keyword argument so you
can re-use the same AMQP connection if you want to execute
more than one task.</p>
</li>
<li><p class="first">Handle failures in task_status view such that it won&#8217;t throw 500s.</p>
</li>
<li><p class="first">Fixed typo <cite>AMQP_SERVER</cite> in documentation to <cite>AMQP_HOST</cite>.</p>
</li>
<li><p class="first">Worker exception emails sent to administrators now works properly.</p>
</li>
<li><p class="first">No longer depends on <cite>django</cite>, so installing <cite>celery</cite> won&#8217;t affect
the preferred Django version installed.</p>
</li>
<li><p class="first">Now works with PostgreSQL (psycopg2) again by registering the
<cite>PickledObject</cite> field.</p>
</li>
<li><p class="first"><cite>celeryd</cite>: Added <cite>&#8211;detach</cite> option as an alias to <cite>&#8211;daemon</cite>, and
it&#8217;s the term used in the documentation from now on.</p>
</li>
<li><p class="first">Make sure the pool and periodic task worker thread is terminated
properly at exit. (So <cite>Ctrl-C</cite> works again).</p>
</li>
<li><p class="first">Now depends on <cite>python-daemon</cite>.</p>
</li>
<li><p class="first">Removed dependency to <cite>simplejson</cite></p>
</li>
<li><p class="first">Cache Backend: Re-establishes connection for every task process
if the Django cache backend is memcached/libmemcached.</p>
</li>
<li><p class="first">Tyrant Backend: Now re-establishes the connection for every task
executed.</p>
</li>
</ul>
</div>
<div class="section" id="version-0-3-3">
<span id="id83"></span><h2><a class="toc-backref" href="#id196">0.3.3</a><a class="headerlink" href="#version-0-3-3" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-06-08 01:07 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The <cite>PeriodicWorkController</cite> now sleeps for 1 second between checking
for periodic tasks to execute.</li>
</ul>
</div>
<div class="section" id="version-0-3-2">
<span id="id84"></span><h2><a class="toc-backref" href="#id197">0.3.2</a><a class="headerlink" href="#version-0-3-2" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-06-08 01:07 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>celeryd: Added option <cite>&#8211;discard</cite>: Discard (delete!) all waiting
messages in the queue.</li>
<li>celeryd: The <cite>&#8211;wakeup-after</cite> option was not handled as a float.</li>
</ul>
</div>
<div class="section" id="version-0-3-1">
<span id="id85"></span><h2><a class="toc-backref" href="#id198">0.3.1</a><a class="headerlink" href="#version-0-3-1" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-06-08 01:07 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The <cite>PeriodicTask</cite> worker is now running in its own thread instead
of blocking the <cite>TaskController</cite> loop.</li>
<li>Default <cite>QUEUE_WAKEUP_AFTER</cite> has been lowered to <cite>0.1</cite> (was <cite>0.3</cite>)</li>
</ul>
</div>
<div class="section" id="version-0-3-0">
<span id="id86"></span><h2><a class="toc-backref" href="#id199">0.3.0</a><a class="headerlink" href="#version-0-3-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-06-08 12:41 P.M CET</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is a development version, for the stable release, please
see versions 0.2.x.</p>
</div>
<p><strong>VERY IMPORTANT:</strong> Pickle is now the encoder used for serializing task
arguments, so be sure to flush your task queue before you upgrade.</p>
<ul>
<li><p class="first"><strong>IMPORTANT</strong> TaskSet.run() now returns a celery.result.TaskSetResult
instance, which lets you inspect the status and return values of a
taskset as it was a single entity.</p>
</li>
<li><p class="first"><strong>IMPORTANT</strong> Celery now depends on carrot &gt;= 0.4.1.</p>
</li>
<li><p class="first">The celery daemon now sends task errors to the registered admin emails.
To turn off this feature, set <cite>SEND_CELERY_TASK_ERROR_EMAILS</cite> to
<cite>False</cite> in your <cite>settings.py</cite>. Thanks to Grégoire Cachet.</p>
</li>
<li><p class="first">You can now run the celery daemon by using <cite>manage.py</cite>:</p>
<div class="highlight-python"><pre>$ python manage.py celeryd</pre>
</div>
<p>Thanks to Grégoire Cachet.</p>
</li>
<li><p class="first">Added support for message priorities, topic exchanges, custom routing
keys for tasks. This means we have introduced
<cite>celery.task.apply_async</cite>, a new way of executing tasks.</p>
<p>You can use <cite>celery.task.delay</cite> and <cite>celery.Task.delay</cite> like usual, but
if you want greater control over the message sent, you want
<cite>celery.task.apply_async</cite> and <cite>celery.Task.apply_async</cite>.</p>
<p>This also means the AMQP configuration has changed. Some settings has
been renamed, while others are new:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_AMQP_EXCHANGE</span>
<span class="n">CELERY_AMQP_PUBLISHER_ROUTING_KEY</span>
<span class="n">CELERY_AMQP_CONSUMER_ROUTING_KEY</span>
<span class="n">CELERY_AMQP_CONSUMER_QUEUE</span>
<span class="n">CELERY_AMQP_EXCHANGE_TYPE</span>
</pre></div>
</div>
<p>See the entry <a class="reference external" href="http://bit.ly/celery_AMQP_routing">Can I send some tasks to only some servers?</a> in the
<a class="reference external" href="http://ask.github.com/celery/faq.html">FAQ</a> for more information.</p>
</li>
</ul>
<ul class="simple">
<li>Task errors are now logged using log level <cite>ERROR</cite> instead of <cite>INFO</cite>,
and stacktraces are dumped. Thanks to Grégoire Cachet.</li>
<li>Make every new worker process re-establish it&#8217;s Django DB connection,
this solving the &#8220;MySQL connection died?&#8221; exceptions.
Thanks to Vitaly Babiy and Jirka Vejrazka.</li>
<li><strong>IMPORTANT</strong> Now using pickle to encode task arguments. This means you
now can pass complex python objects to tasks as arguments.</li>
<li>Removed dependency to <cite>yadayada</cite>.</li>
<li>Added a FAQ, see <cite>docs/faq.rst</cite>.</li>
<li>Now converts any Unicode keys in task <cite>kwargs</cite> to regular strings.
Thanks Vitaly Babiy.</li>
<li>Renamed the <cite>TaskDaemon</cite> to <cite>WorkController</cite>.</li>
<li><cite>celery.datastructures.TaskProcessQueue</cite> is now renamed to
<cite>celery.pool.TaskPool</cite>.</li>
<li>The pool algorithm has been refactored for greater performance and
stability.</li>
</ul>
</div>
<div class="section" id="version-0-2-0">
<span id="id87"></span><h2><a class="toc-backref" href="#id200">0.2.0</a><a class="headerlink" href="#version-0-2-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-05-20 05:14 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Final release of 0.2.0</li>
<li>Compatible with carrot version 0.4.0.</li>
<li>Fixes some syntax errors related to fetching results
from the database backend.</li>
</ul>
</div>
<div class="section" id="pre3">
<span id="version-0-2-0-pre3"></span><h2><a class="toc-backref" href="#id201">0.2.0-pre3</a><a class="headerlink" href="#pre3" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-05-20 05:14 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><em>Internal release</em>. Improved handling of unpickleable exceptions,
<cite>get_result</cite> now tries to recreate something looking like the
original exception.</li>
</ul>
</div>
<div class="section" id="pre2">
<span id="version-0-2-0-pre2"></span><h2><a class="toc-backref" href="#id202">0.2.0-pre2</a><a class="headerlink" href="#pre2" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-05-20 01:56 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Now handles unpickleable exceptions (like the dynamically generated
subclasses of <cite>django.core.exception.MultipleObjectsReturned</cite>).</li>
</ul>
</div>
<div class="section" id="pre1">
<span id="version-0-2-0-pre1"></span><h2><a class="toc-backref" href="#id203">0.2.0-pre1</a><a class="headerlink" href="#pre1" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-05-20 12:33 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>It&#8217;s getting quite stable, with a lot of new features, so bump
version to 0.2. This is a pre-release.</li>
<li><cite>celery.task.mark_as_read()</cite> and <cite>celery.task.mark_as_failure()</cite> has
been removed. Use <cite>celery.backends.default_backend.mark_as_read()</cite>,
and <cite>celery.backends.default_backend.mark_as_failure()</cite> instead.</li>
</ul>
</div>
<div class="section" id="version-0-1-15">
<span id="id88"></span><h2><a class="toc-backref" href="#id204">0.1.15</a><a class="headerlink" href="#version-0-1-15" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-05-19 04:13 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The celery daemon was leaking AMQP connections, this should be fixed,
if you have any problems with too many files open (like <cite>emfile</cite>
errors in <cite>rabbit.log</cite>, please contact us!</li>
</ul>
</div>
<div class="section" id="version-0-1-14">
<span id="id89"></span><h2><a class="toc-backref" href="#id205">0.1.14</a><a class="headerlink" href="#version-0-1-14" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-05-19 01:08 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Fixed a syntax error in the <cite>TaskSet</cite> class.  (No such variable
<cite>TimeOutError</cite>).</li>
</ul>
</div>
<div class="section" id="version-0-1-13">
<span id="id90"></span><h2><a class="toc-backref" href="#id206">0.1.13</a><a class="headerlink" href="#version-0-1-13" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-05-19 12:36 P.M CET</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">Forgot to add <cite>yadayada</cite> to install requirements.</p>
</li>
<li><p class="first">Now deletes all expired task results, not just those marked as done.</p>
</li>
<li><p class="first">Able to load the Tokyo Tyrant backend class without django
configuration, can specify tyrant settings directly in the class
constructor.</p>
</li>
<li><p class="first">Improved API documentation</p>
</li>
<li><p class="first">Now using the Sphinx documentation system, you can build
the html documentation by doing</p>
<div class="highlight-python"><pre>$ cd docs
$ make html</pre>
</div>
<p>and the result will be in <cite>docs/.build/html</cite>.</p>
</li>
</ul>
</div>
<div class="section" id="version-0-1-12">
<span id="id91"></span><h2><a class="toc-backref" href="#id207">0.1.12</a><a class="headerlink" href="#version-0-1-12" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-05-18 04:38 P.M CET</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first"><cite>delay_task()</cite> etc. now returns <cite>celery.task.AsyncResult</cite> object,
which lets you check the result and any failure that might have
happened.  It kind of works like the <cite>multiprocessing.AsyncResult</cite>
class returned by <cite>multiprocessing.Pool.map_async</cite>.</p>
</li>
<li><p class="first">Added dmap() and dmap_async(). This works like the
<cite>multiprocessing.Pool</cite> versions except they are tasks
distributed to the celery server. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task</span> <span class="kn">import</span> <span class="n">dmap</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">operator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dmap</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.task</span> <span class="kn">import</span> <span class="n">dmap_async</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">operator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">dmap_async</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">result</span>
<span class="go">[4, 8, 16]</span>
</pre></div>
</div>
</li>
<li><p class="first">Refactored the task metadata cache and database backends, and added
a new backend for Tokyo Tyrant. You can set the backend in your django
settings file. E.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_RESULT_BACKEND</span> <span class="o">=</span> <span class="s">&quot;database&quot;</span><span class="p">;</span> <span class="c"># Uses the database</span>
<span class="n">CELERY_RESULT_BACKEND</span> <span class="o">=</span> <span class="s">&quot;cache&quot;</span><span class="p">;</span> <span class="c"># Uses the django cache framework</span>
<span class="n">CELERY_RESULT_BACKEND</span> <span class="o">=</span> <span class="s">&quot;tyrant&quot;</span><span class="p">;</span> <span class="c"># Uses Tokyo Tyrant</span>
<span class="n">TT_HOST</span> <span class="o">=</span> <span class="s">&quot;localhost&quot;</span><span class="p">;</span> <span class="c"># Hostname for the Tokyo Tyrant server.</span>
<span class="n">TT_PORT</span> <span class="o">=</span> <span class="mi">6657</span><span class="p">;</span> <span class="c"># Port of the Tokyo Tyrant server.</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="version-0-1-11">
<span id="id92"></span><h2><a class="toc-backref" href="#id208">0.1.11</a><a class="headerlink" href="#version-0-1-11" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-05-12 02:08 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The logging system was leaking file descriptors, resulting in
servers stopping with the EMFILES (too many open files) error. (fixed)</li>
</ul>
</div>
<div class="section" id="version-0-1-10">
<span id="id93"></span><h2><a class="toc-backref" href="#id209">0.1.10</a><a class="headerlink" href="#version-0-1-10" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-05-11 12:46 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Tasks now supports both positional arguments and keyword arguments.</li>
<li>Requires carrot 0.3.8.</li>
<li>The daemon now tries to reconnect if the connection is lost.</li>
</ul>
</div>
<div class="section" id="version-0-1-8">
<span id="id94"></span><h2><a class="toc-backref" href="#id210">0.1.8</a><a class="headerlink" href="#version-0-1-8" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-05-07 12:27 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Better test coverage</li>
<li>More documentation</li>
<li>celeryd doesn&#8217;t emit <cite>Queue is empty</cite> message if
<cite>settings.CELERYD_EMPTY_MSG_EMIT_EVERY</cite> is 0.</li>
</ul>
</div>
<div class="section" id="version-0-1-7">
<span id="id95"></span><h2><a class="toc-backref" href="#id211">0.1.7</a><a class="headerlink" href="#version-0-1-7" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-04-30 01:50 P.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Added some unit tests</li>
<li>Can now use the database for task metadata (like if the task has
been executed or not). Set <cite>settings.CELERY_TASK_META</cite></li>
<li>Can now run <cite>python setup.py test</cite> to run the unit tests from
within the <cite>tests</cite> project.</li>
<li>Can set the AMQP exchange/routing key/queue using
<cite>settings.CELERY_AMQP_EXCHANGE</cite>, <cite>settings.CELERY_AMQP_ROUTING_KEY</cite>,
and <cite>settings.CELERY_AMQP_CONSUMER_QUEUE</cite>.</li>
</ul>
</div>
<div class="section" id="version-0-1-6">
<span id="id96"></span><h2><a class="toc-backref" href="#id212">0.1.6</a><a class="headerlink" href="#version-0-1-6" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-04-28 02:13 P.M CET</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">Introducing <cite>TaskSet</cite>. A set of subtasks is executed and you can
find out how many, or if all them, are done (excellent for progress
bars and such)</p>
</li>
<li><p class="first">Now catches all exceptions when running <cite>Task.__call__</cite>, so the
daemon doesn&#8217;t die. This doesn&#8217;t happen for pure functions yet, only
<cite>Task</cite> classes.</p>
</li>
<li><p class="first"><cite>autodiscover()</cite> now works with zipped eggs.</p>
</li>
<li><p class="first">celeryd: Now adds current working directory to <cite>sys.path</cite> for
convenience.</p>
</li>
<li><p class="first">The <cite>run_every</cite> attribute of <cite>PeriodicTask</cite> classes can now be a
<cite>datetime.timedelta()</cite> object.</p>
</li>
<li><p class="first">celeryd: You can now set the <cite>DJANGO_PROJECT_DIR</cite> variable
for <cite>celeryd</cite> and it will add that to <cite>sys.path</cite> for easy launching.</p>
</li>
<li><p class="first">Can now check if a task has been executed or not via HTTP.</p>
</li>
<li><p class="first">You can do this by including the celery <cite>urls.py</cite> into your project,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">url</span><span class="p">(</span><span class="s">r&#39;^celery/$&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&quot;celery.urls&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>then visiting the following url,:</p>
<div class="highlight-python"><pre>http://mysite/celery/$task_id/done/</pre>
</div>
<p>this will return a JSON dictionary like e.g:</p>
<div class="highlight-python"><pre>&gt;&gt;&gt; {"task": {"id": $task_id, "executed": true}}</pre>
</div>
</li>
<li><p class="first"><cite>delay_task</cite> now returns string id, not <cite>uuid.UUID</cite> instance.</p>
</li>
<li><p class="first">Now has <cite>PeriodicTasks</cite>, to have <cite>cron</cite> like functionality.</p>
</li>
<li><p class="first">Project changed name from <cite>crunchy</cite> to <cite>celery</cite>. The details of
the name change request is in <cite>docs/name_change_request.txt</cite>.</p>
</li>
</ul>
</div>
<div class="section" id="version-0-1-0">
<span id="id97"></span><h2><a class="toc-backref" href="#id213">0.1.0</a><a class="headerlink" href="#version-0-1-0" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">release-date:</th><td class="field-body">2009-04-24 11:28 A.M CET</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Initial release</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="index.html">
  <img class="logo" src="http://cloud.github.com/downloads/ask/celery/celery_128.png" alt="Logo"/>
</a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="faq.html"
                        title="previous chapter">Frequently Asked Questions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="reference/index.html"
                        title="next chapter">API Reference</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/changelog.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="reference/index.html" title="API Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="faq.html" title="Frequently Asked Questions"
             >previous</a> |</li>
        <li><a href="index.html">Celery v2.4.0rc1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2011, Ask Solem &amp; Contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.8.
    </div>
  </body>
</html>