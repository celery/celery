<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>First steps with Django &mdash; Celery 2.6.0a1 documentation</title>
    
    <link rel="stylesheet" href="../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/issuetracker.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.6.0a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Celery 2.6.0a1 documentation" href="../index.html" />
    <link rel="up" title="Django" href="index.html" />
    <link rel="next" title="Unit Testing" href="unit-testing.html" />
    <link rel="prev" title="Django" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="unit-testing.html" title="Unit Testing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Django"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Celery 2.6.0a1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Django</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
<div class="deck">

    
        <p class="developmentversion">
        This document is for Celery's development version, which can be
        significantly different from previous releases. Get old docs here:

        <a href="http://docs.celeryproject.org/en/latest/django/first-steps-with-django.html">2.5</a>.
        </p>
        

</div>
    <div class="section" id="first-steps-with-django">
<h1>First steps with Django<a class="headerlink" href="#first-steps-with-django" title="Permalink to this headline">¶</a></h1>
<div class="section" id="configuring-your-django-project-to-use-celery">
<h2>Configuring your Django project to use Celery<a class="headerlink" href="#configuring-your-django-project-to-use-celery" title="Permalink to this headline">¶</a></h2>
<p>You need four simple steps to use celery with your Django project.</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Install the <tt class="docutils literal"><span class="pre">django-celery</span></tt> library:</p>
<div class="highlight-python"><pre>$ pip install django-celery</pre>
</div>
</li>
<li><p class="first">Add the following lines to <tt class="docutils literal"><span class="pre">settings.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">djcelery</span>
<span class="n">djcelery</span><span class="o">.</span><span class="n">setup_loader</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first">Add <tt class="docutils literal"><span class="pre">djcelery</span></tt> to <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt>.</p>
</li>
<li><p class="first">Create the celery database tables.</p>
<blockquote>
<div><p>If you are using <a class="reference external" href="http://pypi.python.org/pypi/South/">south</a> for schema migrations, you&#8217;ll want to:</p>
<div class="highlight-python"><pre>$ python manage.py migrate djcelery</pre>
</div>
<p>For those who are not using south, a normal <tt class="docutils literal"><span class="pre">syncdb</span></tt> will work:</p>
<div class="highlight-python"><pre>$ python manage.py syncdb</pre>
</div>
</div></blockquote>
</li>
</ol>
</div></blockquote>
<p>By default Celery uses <a class="reference external" href="http://www.rabbitmq.com/">RabbitMQ</a> as the broker, but there are several
alternatives to choose from, see <a class="reference internal" href="../getting-started/first-steps-with-celery.html#celerytut-broker"><em>Choosing a Broker</em></a>.</p>
<p>All settings mentioned in the Celery documentation should be added
to your Django project&#8217;s <tt class="docutils literal"><span class="pre">settings.py</span></tt> module. For example
we can configure the <a class="reference internal" href="../configuration.html#std:setting-BROKER_URL"><tt class="xref std std-setting docutils literal"><span class="pre">BROKER_URL</span></tt></a> setting to specify
what broker to use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">BROKER_URL</span> <span class="o">=</span> <span class="s">&quot;amqp://guest:guest@localhost:5672/&quot;</span>
</pre></div>
</div>
<p>That&#8217;s it.</p>
<div class="section" id="special-note-for-mod-wsgi-users">
<h3>Special note for mod_wsgi users<a class="headerlink" href="#special-note-for-mod-wsgi-users" title="Permalink to this headline">¶</a></h3>
<p>If you&#8217;re using <tt class="docutils literal"><span class="pre">mod_wsgi</span></tt> to deploy your Django application you need to
include the following in your <tt class="docutils literal"><span class="pre">.wsgi</span></tt> module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">djcelery</span>
<span class="n">djcelery</span><span class="o">.</span><span class="n">setup_loader</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="defining-and-executing-tasks">
<h2>Defining and executing tasks<a class="headerlink" href="#defining-and-executing-tasks" title="Permalink to this headline">¶</a></h2>
<p>Tasks are defined by wrapping functions in the <tt class="docutils literal"><span class="pre">&#64;task</span></tt> decorator.
It is a common practice to put these in their own module named <tt class="docutils literal"><span class="pre">tasks.py</span></tt>,
and the worker will automatically go through the apps in <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt>
to import these modules.</p>
<p>For a simple demonstration we can create a new Django app called
<tt class="docutils literal"><span class="pre">celerytest</span></tt>.  To create this app you need to be in the directoryw
of your Django project where <tt class="docutils literal"><span class="pre">manage.py</span></tt> is located and execute:</p>
<div class="highlight-python"><pre>$ python manage.py startapp celerytest</pre>
</div>
<p>After our new app has been created we can define our task by editing
a new file called <tt class="docutils literal"><span class="pre">celerytest/tasks.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery.task</span> <span class="kn">import</span> <span class="n">task</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<p>Our example task is pretty pointless, it just returns the sum of two
arguments, but it will do for demonstration, and it is referenced in many
parts of the Celery documentation.</p>
</div>
<div class="section" id="starting-the-worker-process">
<h2>Starting the worker process<a class="headerlink" href="#starting-the-worker-process" title="Permalink to this headline">¶</a></h2>
<p>You can start a worker instance by using the <tt class="docutils literal"><span class="pre">celeryd</span></tt> manage command:</p>
<div class="highlight-python"><pre>$ python manage.py celeryd --loglevel=info</pre>
</div>
<p>In production you probably want to run the worker in the
background as a daemon, see <a class="reference external" href="http://docs.celeryq.org/en/latest/cookbook/daemonizing.html">Running Celery as a daemon</a>.
For a complete listing of the command line options available, use the help command:</p>
<div class="highlight-python"><pre>$ python manage.py help celeryd</pre>
</div>
</div>
<div class="section" id="executing-our-task">
<h2>Executing our task<a class="headerlink" href="#executing-our-task" title="Permalink to this headline">¶</a></h2>
<p>Now that the worker is running we can open up a new terminal to actually
execute our task:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celerytest.tasks</span> <span class="kn">import</span> <span class="n">add</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">delay</span></tt> method is a handy shortcut to the <tt class="docutils literal"><span class="pre">apply_async</span></tt> method which
enables you to have greater control of the task execution.
To read more about executing tasks, including specifying the time at which
the task should execute see <a class="reference internal" href="../userguide/executing.html#guide-executing"><em>Executing Tasks</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Tasks need to be stored in a real module, they can&#8217;t
be defined in the python shell or ipython/bpython. This is because the
worker server must be able to import the task function so that it can
execute it.</p>
</div>
<p>The task should now be executed by the worker you started earlier,
and you can verify that by looking at the workers console output.</p>
<p>Applying a task returns an <a class="reference internal" href="../reference/celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><tt class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></tt></a> instance,
which can be used to check the state of the task, wait for the task to finish
or get its return value (or if the task failed, the exception and traceback).</p>
<p>By default django-celery stores this state in the Django database,
you may consider choosing an alternate result backend or disabling
states alltogether (see <a class="reference internal" href="../userguide/tasks.html#task-result-backends"><em>Result Backends</em></a>).</p>
<p>To demonstrate how the results work we can execute the task again,
but this time keep the result instance returned:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span> <span class="c"># returns True if the task has finished processing.</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">result</span> <span class="c"># task is not ready, so no return value yet.</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>   <span class="c"># Waits until the task is done and returns the retval.</span>
<span class="go">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">result</span> <span class="c"># direct access to result, doesn&#39;t re-raise errors.</span>
<span class="go">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">successful</span><span class="p">()</span> <span class="c"># returns True if the task didn&#39;t end in failure.</span>
<span class="go">True</span>
</pre></div>
</div>
<p>If the task raises an exception, the return value of <tt class="docutils literal"><span class="pre">result.successful()</span></tt>
will be <tt class="docutils literal"><span class="pre">False</span></tt>, and <tt class="docutils literal"><span class="pre">result.result</span></tt> will contain the exception instance
raised by the task.</p>
</div>
<div class="section" id="where-to-go-from-here">
<h2>Where to go from here<a class="headerlink" href="#where-to-go-from-here" title="Permalink to this headline">¶</a></h2>
<p>To learn more you should read the <a class="reference external" href="http://docs.celeryproject.org/en/latest/userguide/">Celery User Guide</a>, and the
<a class="reference external" href="http://docs.celeryproject.org/">Celery Documentation</a> in general</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="../index.html">
  <img class="logo" src="http://cloud.github.com/downloads/ask/celery/celery_128.png" alt="Logo"/>
</a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Django</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="unit-testing.html"
                        title="next chapter">Unit Testing</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/django/first-steps-with-django.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="unit-testing.html" title="Unit Testing"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Django"
             >previous</a> |</li>
        <li><a href="../index.html">Celery 2.6.0a1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Django</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2012, Ask Solem &amp; Contributors.
    </div>
  </body>
</html>