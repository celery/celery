<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>celery.platforms &mdash; Celery v2.4.0rc1 documentation</title>
    <link rel="stylesheet" href="../../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/issuetracker.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.4.0rc1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Celery v2.4.0rc1 documentation" href="../../index.html" />
    <link rel="up" title="Internal Module Reference" href="index.html" />
    <link rel="prev" title="celery.utils.dispatch.saferef" href="celery.utils.dispatch.saferef.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="celery.utils.dispatch.saferef.html" title="celery.utils.dispatch.saferef"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Celery v2.4.0rc1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Internals</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Internal Module Reference</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
<div class="deck">

    
        <p class="developmentversion">
        This document is for Celery's development version, which can be
        significantly different from previous releases. Get old docs here:

        <a href="http://docs.celeryproject.org/en/latest/internals/reference/celery.platforms.html">2.1</a>.
        </p>
        

</div>
    <div class="section" id="celery-platforms">
<h1>celery.platforms<a class="headerlink" href="#celery-platforms" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id2">celery.platforms</a></li>
</ul>
</div>
<span class="target" id="module-celery.platforms"></span><div class="section" id="id1">
<h2><a class="toc-backref" href="#id2">celery.platforms</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Utilities dealing with platform specifics: signals, daemonization, users &amp;
groups, etc.</p>
<dl class="exception">
<dt id="celery.platforms.LockFailed">
<em class="property">exception </em><tt class="descclassname">celery.platforms.</tt><tt class="descname">LockFailed</tt><a class="headerlink" href="#celery.platforms.LockFailed" title="Permalink to this definition">¶</a></dt>
<dd><p>Raised if a pidlock can&#8217;t be acquired.</p>
</dd></dl>

<dl class="function">
<dt id="celery.platforms.get_fdmax">
<tt class="descclassname">celery.platforms.</tt><tt class="descname">get_fdmax</tt><big>(</big><em>default=None</em><big>)</big><a class="headerlink" href="#celery.platforms.get_fdmax" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the maximum number of open file descriptors
on this system.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><strong>default</strong> &#8211; Value returned if there&#8217;s no file
descriptor limit.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="celery.platforms.create_pidlock">
<tt class="descclassname">celery.platforms.</tt><tt class="descname">create_pidlock</tt><big>(</big><em>pidfile</em><big>)</big><a class="headerlink" href="#celery.platforms.create_pidlock" title="Permalink to this definition">¶</a></dt>
<dd><p>Create and verify pid file.</p>
<p>If the pid file already exists the program exits with an error message,
however if the process it refers to is not running anymore, the pid file
is deleted and the program continues.</p>
<p>The caller is responsible for releasing the lock before the program
exits.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><tt class="xref py py-class docutils literal"><span class="pre">PIDFile</span></tt>.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">atexit</span>
<span class="n">pidlock</span> <span class="o">=</span> <span class="n">create_pidlock</span><span class="p">(</span><span class="s">&quot;/var/run/app.pid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
<span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">pidlock</span><span class="o">.</span><span class="n">release</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="celery.platforms.DaemonContext">
<em class="property">class </em><tt class="descclassname">celery.platforms.</tt><tt class="descname">DaemonContext</tt><big>(</big><em>pidfile=None</em>, <em>workdir='/'</em>, <em>umask=0</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#celery.platforms.DaemonContext" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="celery.platforms.DaemonContext.close">
<tt class="descname">close</tt><big>(</big><em>*args</em><big>)</big><a class="headerlink" href="#celery.platforms.DaemonContext.close" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="celery.platforms.DaemonContext.open">
<tt class="descname">open</tt><big>(</big><big>)</big><a class="headerlink" href="#celery.platforms.DaemonContext.open" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="celery.platforms.detached">
<tt class="descclassname">celery.platforms.</tt><tt class="descname">detached</tt><big>(</big><em>logfile=None</em>, <em>pidfile=None</em>, <em>uid=None</em>, <em>gid=None</em>, <em>umask=0</em>, <em>workdir=None</em>, <em>**opts</em><big>)</big><a class="headerlink" href="#celery.platforms.detached" title="Permalink to this definition">¶</a></dt>
<dd><p>Detach the current process in the background (daemonize).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>logfile</strong> &#8211; Optional log file.  The ability to write to this file
will be verified before the process is detached.</li>
<li><strong>pidfile</strong> &#8211; Optional pid file.  The pid file will not be created,
as this is the responsibility of the child.  But the process will
exit if the pid lock exists and the pid written is still running.</li>
<li><strong>uid</strong> &#8211; Optional user id or user name to change
effective privileges to.</li>
<li><strong>gid</strong> &#8211; Optional group id or group name to change effective
privileges to.</li>
<li><strong>umask</strong> &#8211; Optional umask that will be effective in the child process.</li>
<li><strong>workdir</strong> &#8211; Optional new working directory.</li>
<li><strong>**opts</strong> &#8211; Ignored.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">atexit</span>
<span class="kn">from</span> <span class="nn">celery.platforms</span> <span class="kn">import</span> <span class="n">detached</span><span class="p">,</span> <span class="n">create_pidlock</span>

<span class="k">with</span> <span class="n">detached</span><span class="p">(</span><span class="n">logfile</span><span class="o">=</span><span class="s">&quot;/var/log/app.log&quot;</span><span class="p">,</span> <span class="n">pidfile</span><span class="o">=</span><span class="s">&quot;/var/run/app.pid&quot;</span><span class="p">,</span>
              <span class="n">uid</span><span class="o">=</span><span class="s">&quot;nobody&quot;</span><span class="p">):</span>
    <span class="c"># Now in detached child process with effective user set to nobody,</span>
    <span class="c"># and we know that our logfile can be written to, and that</span>
    <span class="c"># the pidfile is not locked.</span>
    <span class="n">pidlock</span> <span class="o">=</span> <span class="n">create_pidlock</span><span class="p">(</span><span class="s">&quot;/var/run/app.pid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
    <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">pidlock</span><span class="o">.</span><span class="n">release</span><span class="p">)</span>

    <span class="c"># Run the program</span>
    <span class="n">program</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">logfile</span><span class="o">=</span><span class="s">&quot;/var/log/app.log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="celery.platforms.parse_uid">
<tt class="descclassname">celery.platforms.</tt><tt class="descname">parse_uid</tt><big>(</big><em>uid</em><big>)</big><a class="headerlink" href="#celery.platforms.parse_uid" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse user id.</p>
<p>uid can be an integer (uid) or a string (user name), if a user name
the uid is taken from the password file.</p>
</dd></dl>

<dl class="function">
<dt id="celery.platforms.parse_gid">
<tt class="descclassname">celery.platforms.</tt><tt class="descname">parse_gid</tt><big>(</big><em>gid</em><big>)</big><a class="headerlink" href="#celery.platforms.parse_gid" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse group id.</p>
<p>gid can be an integer (gid) or a string (group name), if a group name
the gid is taken from the password file.</p>
</dd></dl>

<dl class="function">
<dt id="celery.platforms.setegid">
<tt class="descclassname">celery.platforms.</tt><tt class="descname">setegid</tt><big>(</big><em>gid</em><big>)</big><a class="headerlink" href="#celery.platforms.setegid" title="Permalink to this definition">¶</a></dt>
<dd><p>Set effective group id.</p>
</dd></dl>

<dl class="function">
<dt id="celery.platforms.seteuid">
<tt class="descclassname">celery.platforms.</tt><tt class="descname">seteuid</tt><big>(</big><em>uid</em><big>)</big><a class="headerlink" href="#celery.platforms.seteuid" title="Permalink to this definition">¶</a></dt>
<dd><p>Set effective user id.</p>
</dd></dl>

<dl class="function">
<dt id="celery.platforms.set_effective_user">
<tt class="descclassname">celery.platforms.</tt><tt class="descname">set_effective_user</tt><big>(</big><em>uid=None</em>, <em>gid=None</em><big>)</big><a class="headerlink" href="#celery.platforms.set_effective_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Change process privileges to new user/group.</p>
<p>If UID and GID is set the effective user/group is set.</p>
<p>If only UID is set, the effective user is set, and the group is
set to the users primary group.</p>
<p>If only GID is set, the effective group is set.</p>
</dd></dl>

<dl class="class">
<dt id="celery.platforms.Signals">
<em class="property">class </em><tt class="descclassname">celery.platforms.</tt><tt class="descname">Signals</tt><a class="headerlink" href="#celery.platforms.Signals" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience interface to <tt class="xref py py-mod docutils literal"><span class="pre">signals</span></tt>.</p>
<p>If the requested signal is not supported on the current platform,
the operation will be ignored.</p>
<p><strong>Examples</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.platforms</span> <span class="kn">import</span> <span class="n">signals</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">signals</span><span class="p">[</span><span class="s">&quot;INT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_handler</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">signals</span><span class="p">[</span><span class="s">&quot;INT&quot;</span><span class="p">]</span>
<span class="go">my_handler</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">signals</span><span class="o">.</span><span class="n">supported</span><span class="p">(</span><span class="s">&quot;INT&quot;</span><span class="p">)</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">signals</span><span class="o">.</span><span class="n">signum</span><span class="p">(</span><span class="s">&quot;INT&quot;</span><span class="p">)</span>
<span class="go">2</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">signals</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="s">&quot;USR1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">signals</span><span class="p">[</span><span class="s">&quot;USR1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ignored</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">signals</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="s">&quot;USR1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">signals</span><span class="p">[</span><span class="s">&quot;USR1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">default</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">signals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">INT</span><span class="o">=</span><span class="n">exit_handler</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">TERM</span><span class="o">=</span><span class="n">exit_handler</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">HUP</span><span class="o">=</span><span class="n">hup_handler</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="celery.platforms.Signals.ignore">
<tt class="descname">ignore</tt><big>(</big><em>*signal_names</em><big>)</big><a class="headerlink" href="#celery.platforms.Signals.ignore" title="Permalink to this definition">¶</a></dt>
<dd><p>Ignore signal using <tt class="xref py py-const docutils literal"><span class="pre">SIG_IGN</span></tt>.</p>
<p>Does nothing if the platform doesn&#8217;t support signals,
or the specified signal in particular.</p>
</dd></dl>

<dl class="method">
<dt id="celery.platforms.Signals.reset">
<tt class="descname">reset</tt><big>(</big><em>*signal_names</em><big>)</big><a class="headerlink" href="#celery.platforms.Signals.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset signals to the default signal handler.</p>
<p>Does nothing if the platform doesn&#8217;t support signals,
or the specified signal in particular.</p>
</dd></dl>

<dl class="method">
<dt id="celery.platforms.Signals.signum">
<tt class="descname">signum</tt><big>(</big><em>signal_name</em><big>)</big><a class="headerlink" href="#celery.platforms.Signals.signum" title="Permalink to this definition">¶</a></dt>
<dd><p>Get signal number from signal name.</p>
</dd></dl>

<dl class="method">
<dt id="celery.platforms.Signals.supported">
<tt class="descname">supported</tt><big>(</big><em>signal_name</em><big>)</big><a class="headerlink" href="#celery.platforms.Signals.supported" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true value if <tt class="docutils literal"><span class="pre">signal_name</span></tt> exists on this platform.</p>
</dd></dl>

<dl class="method">
<dt id="celery.platforms.Signals.update">
<tt class="descname">update</tt><big>(</big><em>_d_=None</em>, <em>**sigmap</em><big>)</big><a class="headerlink" href="#celery.platforms.Signals.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Set signal handlers from a mapping.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="celery.platforms.set_process_title">
<tt class="descclassname">celery.platforms.</tt><tt class="descname">set_process_title</tt><big>(</big><em>progname</em>, <em>info=None</em><big>)</big><a class="headerlink" href="#celery.platforms.set_process_title" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the ps name for the currently running process.</p>
<p>Only works if <tt class="xref py py-mod docutils literal"><span class="pre">setproctitle</span></tt> is installed.</p>
</dd></dl>

<dl class="function">
<dt id="celery.platforms.set_mp_process_title">
<tt class="descclassname">celery.platforms.</tt><tt class="descname">set_mp_process_title</tt><big>(</big><em>progname</em>, <em>info=None</em>, <em>hostname=None</em><big>)</big><a class="headerlink" href="#celery.platforms.set_mp_process_title" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the ps name using the multiprocessing process name.</p>
<p>Only works if <tt class="xref py py-mod docutils literal"><span class="pre">setproctitle</span></tt> is installed.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="../../index.html">
  <img class="logo" src="http://cloud.github.com/downloads/ask/celery/celery_128.png" alt="Logo"/>
</a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="celery.utils.dispatch.saferef.html"
                        title="previous chapter">celery.utils.dispatch.saferef</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/internals/reference/celery.platforms.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="celery.utils.dispatch.saferef.html" title="celery.utils.dispatch.saferef"
             >previous</a> |</li>
        <li><a href="../../index.html">Celery v2.4.0rc1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Internals</a> &raquo;</li>
          <li><a href="index.html" >Internal Module Reference</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2011, Ask Solem &amp; Contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.8.
    </div>
  </body>
</html>