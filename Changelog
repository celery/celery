.. _changelog:

================
 Change history
================

This document contains change notes for bugfix releases in
the 4.1.x series (latentcall), please see :ref:`whatsnew-4.1` for
an overview of what's new in Celery 4.1.

.. _version-4.1.0:

4.1.0
=====
:release-date: 2017-07-25 00:00 PM PST
:release-by: Omer Katz


- Fix typos (#4140)

 Contributed by **Vivek Anand**.

- CELERY_SEND_EVENTS instead of CELERYD_SEND_EVENTS for 3.1.x compatibility (#3997)

 Contributed by **abhinav nilaratna**.

- Restore behavior so Broadcast queues work. (#3934)

 Contributed by **Patrick Cloke**.

- Make appstr use standard format (#4134) (#4139)

 Contributed by **Preston Moore**.

- Resolve pip UnicodeEncoderError for PyPy environments (#4138)

 Contributed by **George Psarakis**.

- Handle possibility there are no workers (#4074)

 Contributed by **Derek Harland**.

- Make id, name always accessible from logging.Formatter via extra (#3994)

 Contributed by **Yoichi NAKAYAMA**.

- Add worker_shutting_down signal (#3998)

 Contributed by **Daniel Huang**.

- Bump PyPy version in build to 5.8.0 (#4128)

 Contributed by **Omer Katz**.

- Update rdb.py (#4135)

 Contributed by **James Michael DuPont**.

- Updated documentation settings for DatabaseScheduler. #4057 (#4058)

 Contributed by **Steven**.

- Fix CELERY_TASK_ settings (#4094)

 Contributed by **Anthony Lukach**.

- Update before installing dependencies.

 Contributed by **Omer Katz**.

- Retry downloading dynamodb if it fails.

 Contributed by **Omer Katz**.

- elasticsearch: Fix serializing keys (#3924)

 Contributed by **Static**.

- Upgrade build environment to trusty.

 Contributed by **Omer Katz**.

- Add note about RPC backend not support chords (#4120)

 Contributed by **Anthony Lukach**.

- Update CONTRIBUTORS.txt

 Contributed by **aydin**.

- Create states.py

 Contributed by **aydin**.

- fix minor grammatical errors and rewrite to be more clear and concise, (#3801)

 Contributed by **Jay McGrath**.

- Fix wrong type in docstring (#4067)

 Contributed by **Kirill Romanov**.

- Fix task eager Django setting names (#4061)

 Contributed by **Ross Patterson**.

- Update whatsnew-4.0 (#3909)

 Contributed by **Primož Kerin**.

- Fix typo in periodic-tasks docs (#3869)

 Contributed by **Primož Kerin**.

- Fix CELERYBEAT_LOG_FILE replacement option typo (#3788)

 Contributed by **Tamer Sherif**.

- documentation fix. (#3732)

 Contributed by **Eric Poelke**.

- Deserialize all tasks in a chain (#4015)

 Contributed by **Felipe**.

- recover loglevel for ExecStart in systemd config (#4023)

 Contributed by **Yoichi NAKAYAMA**.

- Fix pytest config file name

 Contributed by **Samuel Dion-Girardeau**.

- Update contributors list

 Contributed by **Samuel Dion-Girardeau**.

- Fix multiline formatting issue

 Contributed by **Samuel Dion-Girardeau**.

- Fix link reference in the FAQ

 Contributed by **Samuel Dion-Girardeau**.

- Fix minor typos in the FAQ and user guide

 Contributed by **Samuel Dion-Girardeau**.

- fix small documentation typos

 Contributed by **Viraj**.

- Add link to Version 2

 Contributed by **Anthony Lukach**.

- Fix docs example (small) (#4009)

 Contributed by **Anthony Lukach**.

- Correct broker URL in RabbitMQ getting started info. (#4043)

 Contributed by **Luke Plant**.

- Update testing.rst (#4046)

 Contributed by **Rico Moorman**.

- Use the Sphinx add_directive_to_domain API. (#4037)

 Contributed by **Patrick Cloke**.

- Clarify AsyncResult.ready docstring (#4038)

 Contributed by **Simon Schmidt**.

- Rename section to [bdist_wheel] as [wheel] is considered legacy (#4033)

 Contributed by **Jon Dufresne**.

- Signal before_task_publish not doing what documented (#4035)

 Contributed by **Javier Domingo Cansino**.

- Update changelog for v4.0.3 (#3999)

 Contributed by **Daniel Huang**.

- Add SSL option for redis backends (#3831)

 Contributed by **Chris Kuehl**.

- celery.schedule.crontab: fix reduce (#3826) (#3827)

 Contributed by **Taylor C. Richberger**.

- Prefer https over http when available (#3966)

 Contributed by **Jon Dufresne**.

- Updates, fixes, and improvements to documentation (#3976)

 Contributed by **Joey Wilhelm**.

- Remove duplicate entry in __all__

 Contributed by **Tao Qingyun**.

- FIX badly written check  if cluster_state is None

 Contributed by **Thierry RAMORASOAVINA**.

- Fix celery issues when using flower REST API

 Contributed by **Thierry RAMORASOAVINA**.

- Typo of variable name

 Contributed by **Dmytro Petruk**.

- Elasticsearch: Fix serializing document id.

 Contributed by **Acey9**.

- Support Elasticsearch backend options settings

 Contributed by **Acey9**.

- Add tests for ensuring schedule changes are detected

 Contributed by **Brian May**.

- Make shallow copy of schedules dictionary

 Contributed by **Brian May**.

- Populate heap when periodic tasks are changed

 Contributed by **Wojciech Żywno**.

- Resolve issue with Redis integration test in Python3

 Contributed by **georgepsarakis**.

- Allow class methods to define tasks

 Contributed by **georgepsarakis**.

- return boolean value according to the doc

 Contributed by **Jian Yu**.

- Add regression test for chain duplication in chords (#3771)

 Contributed by **georgepsarakis**.

- Avoid duplicating chains in chords (#3779)

 Contributed by **Ryan Hiebert**.

- Lookup task only if list has items

 Contributed by **Marc Gibbons**.

- Write failing test

 Contributed by **Marc Gibbons**.

- Update slightly the doc (#3929)

 Contributed by **Tom 'Biwaa' Riat**.

- Remove non-free ICC profiles from docs/images (#3936)

 Contributed by **Christopher Hoskin**.

- Changed default redis_socket_timeout setting value (#3920)

 Contributed by **Sergey Fursov**.

- Indent statement in docs function (#3910)

 Contributed by **Michal Kuffa**.

- -Ofair reference, rst formatting fixes (#3913)

 Contributed by **Slam**.

- Document rate limit and ETA incompatibilities (#3899)

 Contributed by **Bruno Alla**.

- Fix grammar, update .gitignore (#3887)

 Contributed by **Static**.

- Allow unicode message for exception raised in task (#3903)

 Contributed by **George Psarakis**.

- Document support for Python 3.6 (#3904)

 Contributed by **Jon Dufresne**.

- Revert "Fix setting name for task_eager_propagates" (#3880)

 Contributed by **Omer Katz**.

- Fix setting name for task_eager_propagates (#3846)

 Contributed by **Mike Helmick**.

- Fix retried tasks with expirations (#3790)

 Contributed by **Brendan MacDonell**.

- Fix typo from "restart limit" to "retry limit" (#3807)

 Contributed by **Salvatore Rinchiera**.

- Typo in README (#3836)

 Contributed by **Jamie Alessio**.

- confirm error (#3840)

 Contributed by **Pysaoke**.

- Use a wording a bit closer to English (#3842)

 Contributed by **Peter Bittner**.

- * Fixes items format route in docs (#3875)

 Contributed by **Slam**.

- Fix URLs to userguide/daemonizing docs (#3871)

 Contributed by **Simon Legner**.

- Add a link to django-transaction-hooks (#3799)

 Contributed by **orf**.

- Docs: Fix typo in whatsnew-4.0.rst (#3793)

 Contributed by **Ed Morley**.

- Fix maybe_make_aware (#3850)

 Contributed by **Taylor C. Richberger**.

- Fix task ETA issues when timezone is defined in configuration (#3867)

 Contributed by **George Psarakis**.

- Prevent consuming queue before ready on startup (#3752)

 Contributed by **Alan Hamlett**.

- Cache pip installs (#3785)

 Contributed by **orf**.

- Update tasks.rst (#3777)

 Contributed by **orf**.

- AWS DynamoDB result backend (#3736)

 Contributed by **George Psarakis**.

- Consumer does not shutdown properly when embedded in gevent application (#3746)

 Contributed by **Arcadiy Ivanov**.

- Added python3.6 on tox (#3749)

 Contributed by **Asif Saifuddin Auvi**.

- Fix sqs broker documentation typos (#3742)

 Contributed by **Arthur Vigil**.

- Fix #3725: Task replaced with group does not complete (#3731)

 Contributed by **Morgan Doocy**.

- Fix #3726 - Chaining of replaced tasks (#3730)

 Contributed by **Morgan Doocy**.

- Update first-steps-with-django.rst (#3724)

 Contributed by **Marc Hörsken**.

- Sync subtask option (#3696)

 Contributed by **shalev67**.

- Fix request context for blocking task apply (added hostname) (#3716)

 Contributed by **Marat Sharafutdinov**.

- Doc: add 'self' to test_send_order.test_failure (#3718)

 Contributed by **Daniel Hahler**.

- Fix #3678 (#3693)

 Contributed by **Roman Sichny**.

- Provide a transparent method to update the Scheduler heap (#3721)

 Contributed by **Alejandro Pernin**.

- add myself to contributor list (#3710)

 Contributed by **Mike Chen**.

- fix typo (#3717)

 Contributed by **YuLun Shih**.

- Grammar: pluralize verb (#3713)

 Contributed by **Kalle Bronsen**.

- Specify default value for pidfile option of celery beat. (#3722)

 Contributed by **Arnaud Rocher**.

- Fixed TypeError due to change of task protocol (#3714)

 Contributed by **Michael**.

- [docs] Fixed link to pytest (#3720)

 Contributed by **Michael**.

- make missing args/kwargs in protocol v1 message to return empty value in protocol v2 message (#3695)

 Contributed by **Roman Sichny**.

- Fix celery mongodb integration so that binary encodings like pickle/m… (#3705)

 Contributed by **Andrew de Quincey**.

- **Results**: Elasticsearch: Stop generating a new field every time when a new result is being put (#3708)

 Contributed by **Mike Chen**.

- **Requirements**

    - Now depends on :ref:`Kombu 4.1.0 <kombu:version-4.1.0>`.

- **Results**: Elasticsearch now reuses fields when new results are added.

    Contributed by **Mike Chen**.

- **Results**: Fixed MongoDB integration when using binary encodings
  (Issue #3575).

    Contributed by **Andrew de Quincey**.

- **Worker**: Making missing ``*args`` and ``**kwargs`` in Task protocol 1
return empty value in protocol 2 (Issue #3687).

    Contributed by **Roman Sichny**.

- **App**: Fixed :exc:`TypeError` in AMQP when using deprecated signal
  (Issue #3707).

    Contributed by :github_user:`michael-k`.

- **Beat**: Added a transparent method to update the scheduler heap.

    Contributed by **Alejandro Pernin**.

- **Task**: Fixed handling of tasks with keyword arguments on Python 3
  (Issue #3657).

    Contributed by **Roman Sichny**.

- **Task**: Fixed request context for blocking task apply by adding missing
  hostname attribute.

    Contributed by **Marat Sharafutdinov**.

- **Task**: Added option to run subtasks synchronously with
  ``disable_sync_subtasks`` argument.

    Contributed by :github_user:`shalev67`.

- **App**: Fixed chaining of replaced tasks (Issue #3726).

    Contributed by **Morgan Doocy**.

- **Canvas**: Fixed bug where replaced tasks with groups were not completing
  (Issue #3725).

    Contributed by **Morgan Doocy**.

- **Worker**: Fixed problem where consumer does not shutdown properly when
  embedded in a gevent application (Issue #3745).

    Contributed by **Arcadiy Ivanov**.

- **Results**: Added support for using AWS DynamoDB as a result backend.

    Contributed by **George Psarakis**.

- **Testing**: Added caching on pip installs.

    Contributed by :github_user:`orf`.

- **Worker**: Prevent consuming queue before ready on startup (Issue #3620).

    Contributed by **Alan Hamlett**.

- **App**: Fixed task ETA issues when timezone is defined in configuration
  (Issue #3753).

    Contributed by **George Psarakis**.

- **Utils**: ``maybe_make_aware`` should not modify datetime when it is
  already timezone-aware (Issue #3849).

    Contributed by **Taylor C. Richberger**.

- **App**: Fixed retrying tasks with expirations (Issue #3734).

    Contributed by **Brendan MacDonell**.

- **Results**: Allow unicode message for exceptions raised in task
  (Issue #3858).

    Contributed by :github_user:`staticfox`.

- **Canvas**: Fixed :exc:`IndexError` raised when chord has an empty header.

    Contributed by **Marc Gibbons**.

- **Canvas**: Avoid duplicating chains in chords (Issue #3771).

    Contributed by **Ryan Hiebert** and **George Psarakis**.

- **Utils**: Allow class methods to define tasks (Issue #3863).

    Contributed by **George Psarakis**.

- **Beat**: Populate heap when periodic tasks are changed.

    Contributed by :github_user:`wzywno` and **Brian May**.

- **Results**: Added support for Elasticsearch backend options settings.

    Contributed by :github_user:`Acey9`.

- **Events**: Ensure ``Task.as_dict()`` works when not all information about
  task is available.

    Contributed by :github_user:`tramora`.

- **Schedules**: Fixed pickled crontab schedules to restore properly (Issue #3826).

    Contributed by **Taylor C. Richberger**.

- **Results**: Added SSL option for redis backends (Issue #3830).

    Contributed by **Chris Kuehl**.

- Documentation and examples improvements by:

    - **Bruno Alla**
    - **Jamie Alessio**
    - **Ask Solem**
    - **Peter Bittner**
    - **Jon Dufresne**
    - **Sergey Fursov**
    - **Daniel Hahler**
    - **Mike Helmick**
    - **Marc Hörsken**
    - **Christopher Hoskin**
    - **Michal Kuffa**
    - **Simon Legner**
    - **Ed Morley**
    - **Dmytro Petruk**
    - **Salvatore Rinchiera**
    - **Arnaud Rocher**
    - **YuLun Shih**
    - **Tom 'Biwaa' Riat**
    - **Arthur Vigil**
    - **Joey Wilhelm**
    - **Jian Yu**
    - :github_user:`baixuexue123`
    - :github_user:`bronsen`
    - :github_user:`michael-k`
    - :github_user:`orf`
    - :github_user:`3lnc`
