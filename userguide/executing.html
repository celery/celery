<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Executing Tasks &mdash; Celery 2.5.0b1 documentation</title>
    
    <link rel="stylesheet" href="../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/issuetracker.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.5.0b1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Celery 2.5.0b1 documentation" href="../index.html" />
    <link rel="up" title="User Guide" href="index.html" />
    <link rel="next" title="Workers Guide" href="workers.html" />
    <link rel="prev" title="Tasks" href="tasks.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="workers.html" title="Workers Guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tasks.html" title="Tasks"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Celery 2.5.0b1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">User Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
<div class="deck">

    
        <p class="developmentversion">
        This document is for Celery's development version, which can be
        significantly different from previous releases. Get old docs here:

        <a href="http://docs.celeryproject.org/en/latest/userguide/executing.html">2.1</a>.
        </p>
        

</div>
    <div class="section" id="executing-tasks">
<span id="guide-executing"></span><h1>Executing Tasks<a class="headerlink" href="#executing-tasks" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#basics" id="id1">Basics</a></li>
<li><a class="reference internal" href="#eta-and-countdown" id="id2">ETA and countdown</a></li>
<li><a class="reference internal" href="#expiration" id="id3">Expiration</a></li>
<li><a class="reference internal" href="#serializers" id="id4">Serializers</a></li>
<li><a class="reference internal" href="#connections-and-connection-timeouts" id="id5">Connections and connection timeouts.</a></li>
<li><a class="reference internal" href="#routing-options" id="id6">Routing options</a></li>
<li><a class="reference internal" href="#amqp-options" id="id7">AMQP options</a></li>
</ul>
</div>
<div class="section" id="basics">
<span id="executing-basics"></span><h2><a class="toc-backref" href="#id1">Basics</a><a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<p>Executing a task is done with <tt class="xref py py-meth docutils literal"><span class="pre">apply_async()</span></tt>,
and the shortcut: <tt class="xref py py-meth docutils literal"><span class="pre">delay()</span></tt>.</p>
<p><cite>delay</cite> is simple and convenient, as it looks like calling a regular
function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Task</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">kwarg1</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="n">kwarg2</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The same using <cite>apply_async</cite> is written like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Task</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;kwarg1&quot;</span><span class="p">:</span> <span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;kwarg2&quot;</span><span class="p">:</span> <span class="s">&quot;y&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>While <cite>delay</cite> is convenient, it doesn&#8217;t give you as much control as using
<cite>apply_async</cite>.  With <cite>apply_async</cite> you can override the execution options
available as attributes on the <cite>Task</cite> class (see <a class="reference internal" href="tasks.html#task-options"><em>Task options</em></a>).
In addition you can set countdown/eta, task expiry, provide a custom broker
connection and more.</p>
<p>Let&#8217;s go over these in more detail.  All the examples uses a simple task
called <cite>add</cite>, returning the sum of two positional arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@task</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>You can also execute a task by name using
<tt class="xref py py-func docutils literal"><span class="pre">send_task()</span></tt>, if you don&#8217;t have access to the
task class:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery.execute</span> <span class="kn">import</span> <span class="n">send_task</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">send_task</span><span class="p">(</span><span class="s">&quot;tasks.add&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">4</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="eta-and-countdown">
<span id="executing-eta"></span><h2><a class="toc-backref" href="#id2">ETA and countdown</a><a class="headerlink" href="#eta-and-countdown" title="Permalink to this headline">¶</a></h2>
<p>The ETA (estimated time of arrival) lets you set a specific date and time that
is the earliest time at which your task will be executed.  <cite>countdown</cite> is
a shortcut to set eta by seconds into the future.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">countdown</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>    <span class="c"># this takes at least 3 seconds to return</span>
<span class="go">20</span>
</pre></div>
</div>
<p>The task is guaranteed to be executed at some time <em>after</em> the
specified date and time, but not necessarily at that exact time.
Possible reasons for broken deadlines may include many items waiting
in the queue, or heavy network latency.  To make sure your tasks
are executed in a timely manner you should monitor queue lengths. Use
Munin, or similar tools, to receive alerts, so appropriate action can be
taken to ease the workload.  See <a class="reference internal" href="monitoring.html#monitoring-munin"><em>Munin</em></a>.</p>
<p>While <cite>countdown</cite> is an integer, <cite>eta</cite> must be a <a class="reference external" href="http://docs.python.org/dev/library/datetime.html#datetime.datetime" title="(in Python v3.3)"><tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt></a>
object, specifying an exact date and time (including millisecond precision,
and timezone information):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tomorrow</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">eta</span><span class="o">=</span><span class="n">tomorrow</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="expiration">
<span id="executing-expiration"></span><h2><a class="toc-backref" href="#id3">Expiration</a><a class="headerlink" href="#expiration" title="Permalink to this headline">¶</a></h2>
<p>The <cite>expires</cite> argument defines an optional expiry time,
either as seconds after task publish, or a specific date and time using
<a class="reference external" href="http://docs.python.org/dev/library/datetime.html#datetime.datetime" title="(in Python v3.3)"><tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Task expires after one minute from now.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">expires</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># Also supports datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">,</span>
<span class="gp">... </span>                <span class="n">expires</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>When a worker receives an expired task it will mark
the task as <a class="reference internal" href="tasks.html#std:state-REVOKED"><tt class="xref std std-state docutils literal"><span class="pre">REVOKED</span></tt></a> (<a class="reference internal" href="../reference/celery.exceptions.html#celery.exceptions.TaskRevokedError" title="celery.exceptions.TaskRevokedError"><tt class="xref py py-exc docutils literal"><span class="pre">TaskRevokedError</span></tt></a>).</p>
</div>
<div class="section" id="serializers">
<span id="executing-serializers"></span><h2><a class="toc-backref" href="#id4">Serializers</a><a class="headerlink" href="#serializers" title="Permalink to this headline">¶</a></h2>
<p>Data transferred between clients and workers needs to be serialized.
The default serializer is <a class="reference external" href="http://docs.python.org/dev/library/pickle.html#pickle" title="(in Python v3.3)"><tt class="xref py py-mod docutils literal"><span class="pre">pickle</span></tt></a>, but you can
change this globally or for each individual task.
There is built-in support for <a class="reference external" href="http://docs.python.org/dev/library/pickle.html#pickle" title="(in Python v3.3)"><tt class="xref py py-mod docutils literal"><span class="pre">pickle</span></tt></a>, <cite>JSON</cite>, <cite>YAML</cite>
and <cite>msgpack</cite>, and you can also add your own custom serializers by registering
them into the Kombu serializer registry (see <a class="reference external" href="http://packages.python.org/kombu/introduction.html#serialization-of-data">Kombu: Serialization of Data</a>).</p>
<p>Each option has its advantages and disadvantages.</p>
<dl class="docutils">
<dt>json &#8211; JSON is supported in many programming languages, is now</dt>
<dd><p class="first">a standard part of Python (since 2.6), and is fairly fast to decode
using the modern Python libraries such as <tt class="xref py py-mod docutils literal"><span class="pre">cjson</span></tt> or <tt class="xref py py-mod docutils literal"><span class="pre">simplejson</span></tt>.</p>
<p>The primary disadvantage to JSON is that it limits you to the following
data types: strings, Unicode, floats, boolean, dictionaries, and lists.
Decimals and dates are notably missing.</p>
<p>Also, binary data will be transferred using Base64 encoding, which will
cause the transferred data to be around 34% larger than an encoding which
supports native binary types.</p>
<p>However, if your data fits inside the above constraints and you need
cross-language support, the default setting of JSON is probably your
best choice.</p>
<p class="last">See <a class="reference external" href="http://json.org">http://json.org</a> for more information.</p>
</dd>
<dt>pickle &#8211; If you have no desire to support any language other than</dt>
<dd><p class="first">Python, then using the pickle encoding will gain you the support of
all built-in Python data types (except class instances), smaller
messages when sending binary files, and a slight speedup over JSON
processing.</p>
<p class="last">See <a class="reference external" href="http://docs.python.org/library/pickle.html">http://docs.python.org/library/pickle.html</a> for more information.</p>
</dd>
<dt>yaml &#8211; YAML has many of the same characteristics as json,</dt>
<dd><p class="first">except that it natively supports more data types (including dates,
recursive references, etc.)</p>
<p>However, the Python libraries for YAML are a good bit slower than the
libraries for JSON.</p>
<p>If you need a more expressive set of data types and need to maintain
cross-language compatibility, then YAML may be a better fit than the above.</p>
<p class="last">See <a class="reference external" href="http://yaml.org/">http://yaml.org/</a> for more information.</p>
</dd>
<dt>msgpack &#8211; msgpack is a binary serialization format that is closer to JSON</dt>
<dd><p class="first">in features.  It is very young however, and support should be considered
experimental at this point.</p>
<p class="last">See <a class="reference external" href="http://msgpack.org/">http://msgpack.org/</a> for more information.</p>
</dd>
</dl>
<p>The encoding used is available as a message header, so the worker knows how to
deserialize any task.  If you use a custom serializer, this serializer must
be available for the worker.</p>
<p>The client uses the following order to decide which serializer
to use when sending a task:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The <cite>serializer</cite> argument to <cite>apply_async</cite></li>
<li>The tasks <cite>serializer</cite> attribute</li>
<li>The default <a class="reference internal" href="../configuration.html#std:setting-CELERY_TASK_SERIALIZER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_SERIALIZER</span></tt></a> setting.</li>
</ol>
</div></blockquote>
<ul class="simple">
<li>Using the <cite>serializer</cite> argument to <cite>apply_async</cite>:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">serializer</span><span class="o">=</span><span class="s">&quot;json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="connections-and-connection-timeouts">
<span id="executing-connections"></span><h2><a class="toc-backref" href="#id5">Connections and connection timeouts.</a><a class="headerlink" href="#connections-and-connection-timeouts" title="Permalink to this headline">¶</a></h2>
<div class="admonition-automatic-pool-support admonition">
<p class="first admonition-title">Automatic Pool Support</p>
<p>Since version 2.3 there is support for automatic connection pools,
so you don&#8217;t have to manually handle connections and publishers
to reuse connections.</p>
<p>The connection pool is enabled by default since version 2.5.</p>
<p class="last">See the <a class="reference internal" href="../configuration.html#std:setting-BROKER_POOL_LIMIT"><tt class="xref std std-setting docutils literal"><span class="pre">BROKER_POOL_LIMIT</span></tt></a> setting for more information.</p>
</div>
<p>You can handle the connection manually by creating a
publisher:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">numbers</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)]</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">publisher</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">get_publisher</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">publisher</span><span class="o">=</span><span class="n">publisher</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">publisher</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">publisher</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">print</span><span class="p">([</span><span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This particular example is better expressed as a task set.
See <a class="reference internal" href="tasksets.html#sets-taskset"><em>Task Sets</em></a>.  Tasksets already reuses connections.</p>
</div>
<p>The connection timeout is the number of seconds to wait before giving up
on establishing the connection.  You can set this by using the
<cite>connect_timeout</cite> argument to <cite>apply_async</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">connect_timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Or if you handle the connection manually:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">publisher</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">get_publisher</span><span class="p">(</span><span class="n">connect_timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="routing-options">
<span id="executing-routing"></span><h2><a class="toc-backref" href="#id6">Routing options</a><a class="headerlink" href="#routing-options" title="Permalink to this headline">¶</a></h2>
<p>Celery uses the AMQP routing mechanisms to route tasks to different workers.</p>
<p>Messages (tasks) are sent to exchanges, a queue binds to an exchange with a
routing key. Let&#8217;s look at an example:</p>
<p>Let&#8217;s pretend we have an application with lot of different tasks: some
process video, others process images, and some gather collective intelligence
about its users.  Some of these tasks are more important, so we want to make
sure the high priority tasks get sent to dedicated nodes.</p>
<p>For the sake of this example we have a single exchange called <cite>tasks</cite>.
There are different types of exchanges, each type interpreting the routing
key in different ways, implementing different messaging scenarios.</p>
<p>The most common types used with Celery are <cite>direct</cite> and <cite>topic</cite>.</p>
<ul>
<li><p class="first">direct</p>
<blockquote>
<div><p>Matches the routing key exactly.</p>
</div></blockquote>
</li>
<li><p class="first">topic</p>
<blockquote>
<div><p>In the topic exchange the routing key is made up of words separated by
dots (<cite>.</cite>).  Words can be matched by the wild cards <cite>*</cite> and <cite>#</cite>,
where <cite>*</cite> matches one exact word, and <cite>#</cite> matches one or many words.</p>
<p>For example, <cite>*.stock.#</cite> matches the routing keys <cite>usd.stock</cite> and
<cite>euro.stock.db</cite> but not <cite>stock.nasdaq</cite>.</p>
</div></blockquote>
</li>
</ul>
<p>We create three queues, <cite>video</cite>, <cite>image</cite> and <cite>lowpri</cite> that binds to
the <cite>tasks</cite> exchange.  For the queues we use the following binding keys:</p>
<div class="highlight-python"><pre>video: video.#
image: image.#
lowpri: misc.#</pre>
</div>
<p>Now we can send our tasks to different worker machines, by making the workers
listen to different queues:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">filename</span><span class="p">],</span>
<span class="gp">... </span>                              <span class="n">routing_key</span><span class="o">=</span><span class="s">&quot;video.compress&quot;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">filename</span><span class="p">,</span> <span class="mi">360</span><span class="p">],</span>
<span class="gp">... </span>                            <span class="n">routing_key</span><span class="o">=</span><span class="s">&quot;image.rotate&quot;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">filename</span><span class="p">,</span> <span class="n">selection</span><span class="p">],</span>
<span class="gp">... </span>                          <span class="n">routing_key</span><span class="o">=</span><span class="s">&quot;image.crop&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">routing_key</span><span class="o">=</span><span class="s">&quot;misc.recommend&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Later, if the crop task is consuming a lot of resources,
we can bind new workers to handle just the <cite>&#8220;image.crop&#8221;</cite> task,
by creating a new queue that binds to <cite>&#8220;image.crop</cite>&#8221;.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">To find out more about routing, please see <a class="reference internal" href="routing.html#guide-routing"><em>Routing Tasks</em></a>.</p>
</div>
</div>
<div class="section" id="amqp-options">
<span id="executing-amq-opts"></span><h2><a class="toc-backref" href="#id7">AMQP options</a><a class="headerlink" href="#amqp-options" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>mandatory</li>
</ul>
<p>This sets the delivery to be mandatory.  An exception will be raised
if there are no running workers able to take on the task.</p>
<p>Not supported by <tt class="xref py py-mod docutils literal"><span class="pre">amqplib</span></tt>.</p>
<ul class="simple">
<li>immediate</li>
</ul>
<p>Request immediate delivery. Will raise an exception
if the task cannot be routed to a worker immediately.</p>
<p>Not supported by <tt class="xref py py-mod docutils literal"><span class="pre">amqplib</span></tt>.</p>
<ul class="simple">
<li>priority</li>
</ul>
<p>A number between <cite>0</cite> and <cite>9</cite>, where <cite>0</cite> is the highest priority.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">RabbitMQ does not yet support AMQP priorities.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="../index.html">
  <img class="logo" src="http://cloud.github.com/downloads/ask/celery/celery_128.png" alt="Logo"/>
</a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="tasks.html"
                        title="previous chapter">Tasks</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="workers.html"
                        title="next chapter">Workers Guide</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/userguide/executing.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="workers.html" title="Workers Guide"
             >next</a> |</li>
        <li class="right" >
          <a href="tasks.html" title="Tasks"
             >previous</a> |</li>
        <li><a href="../index.html">Celery 2.5.0b1 documentation</a> &raquo;</li>
          <li><a href="index.html" >User Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2011, Ask Solem &amp; Contributors.
    </div>
  </body>
</html>